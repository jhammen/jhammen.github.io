<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>Jakarta Messaging Examples :: Jakarta EE Documentation</title>
    <meta name="generator" content="Antora 3.1.3">
    <link rel="stylesheet" href="../../../../_/css/site.css">
    <script>var uiRootPath = '../../../../_'</script>
    <script>!function (theme) {
        if (theme === 'dark') document.documentElement.classList.add('theme-dark')
      }(localStorage && localStorage.getItem('theme') || (matchMedia('(prefers-color-scheme: dark)') && 'dark'))
    </script>
      </head>
  <body class="article">
<header class="header">
  <nav class="navbar">
    <div class="navbar-brand">
      <a id="site-title" class="navbar-item" href="../../../..">Jakarta EE Documentation</a>
      <button class="navbar-burger" data-target="topbar-nav">
        <span></span>
        <span></span>
        <span></span>
      </button>
    </div>
    <div id="topbar-nav" class="navbar-menu">
      <div class="navbar-end">
<!--
        <a class="navbar-item" href="#">Home</a>
        <div class="navbar-item has-dropdown is-hoverable">
          <a class="navbar-link" href="#">Products</a>
          <div class="navbar-dropdown">
            <a class="navbar-item" href="#">Product A</a>
            <a class="navbar-item" href="#">Product B</a>
            <a class="navbar-item" href="#">Product C</a>
          </div>
        </div>
        <div class="navbar-item has-dropdown is-hoverable">
          <a class="navbar-link" href="#">Services</a>
          <div class="navbar-dropdown">
            <a class="navbar-item" href="#">Service A</a>
            <a class="navbar-item" href="#">Service B</a>
            <a class="navbar-item" href="#">Service C</a>
          </div>
        </div>
 -->
        <div class="navbar-item">
          <span class="control">
            <a class="button is-primary" href="../../../../jakartaee-tutorial/10/jakarta-ee-tutorial.pdf">Download</a>
          </span>
        </div>
      </div>
      <div class="navbar-theme-switcher">
        <span class="switch" title="Switch between Light and Dark Theme">
          <input id="theme-switcher-checkbox" type="checkbox" />
          <label for="theme-switcher-checkbox">Dark Theme</label>
        </span>
      </div>
    </div>
  </nav>
</header>
<div class="body">
<div class="nav-container" data-component="jakartaee-tutorial" data-version="10">
  <aside class="nav">
    <div class="panels">
<div class="nav-panel-menu is-active" data-panel="menu">
  <nav class="nav-menu">
    <h3 class="title"><a href="../../index.html">Jakarta EE Tutorial</a></h3>
<ul class="nav-list">
  <li class="nav-item" data-depth="0">
    <button class="nav-item-toggle"></button>
    <span class="nav-text">Introduction</span>
<ul class="nav-list">
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="../../index.html">Preface</a>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="0">
    <button class="nav-item-toggle"></button>
    <span class="nav-text">Jakarta EE Core Profile</span>
<ul class="nav-list">
  <li class="nav-item" data-depth="1">
    <button class="nav-item-toggle"></button>
    <span class="nav-text">Jakarta CDI Lite</span>
<ul class="nav-list">
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../../cdi/cdi-basic/cdi-basic.html">Introduction to Jakarta Contexts and Dependency Injection</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../../cdi/cdi-basicexamples/cdi-basicexamples.html">Running the Basic Contexts and Dependency Injection Examples</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../../supporttechs/interceptors/interceptors.html">Using Jakarta EE Interceptors</a>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="1">
    <button class="nav-item-toggle"></button>
    <span class="nav-text">Jakarta REST</span>
<ul class="nav-list">
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../../websvcs/jaxrs/jaxrs.html">Building RESTful Web Services with Jakarta REST</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../../websvcs/jaxrs-client/jaxrs-client.html">Accessing REST Resources with the Jakarta REST Client API</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../../websvcs/jaxrs-advanced/jaxrs-advanced.html">Jakarta REST: Advanced Topics and an Example</a>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="1">
    <button class="nav-item-toggle"></button>
    <span class="nav-text">Jakarta JSON</span>
<ul class="nav-list">
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../../web/jsonb/jsonb.html">JSON Binding</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../../web/jsonp/jsonp.html">JSON Processing</a>
  </li>
</ul>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="0">
    <button class="nav-item-toggle"></button>
    <span class="nav-text">Jakarta EE Web Profile</span>
<ul class="nav-list">
  <li class="nav-item" data-depth="1">
    <button class="nav-item-toggle"></button>
    <span class="nav-text">Jakarta CDI Full</span>
<ul class="nav-list">
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../../cdi/cdi-adv/cdi-adv.html">Jakarta Contexts and Dependency Injection: Advanced Topics</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../../cdi/cdi-bootstrap-se8/cdi-bootstrap-se8.html">Bootstrapping a CDI Container in Java SE</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../../cdi/cdi-adv-examples/cdi-adv-examples.html">Running the Advanced Contexts and Dependency Injection Examples</a>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="1">
    <button class="nav-item-toggle"></button>
    <span class="nav-text">Jakarta Validation</span>
<ul class="nav-list">
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../../beanvalidation/bean-validation/bean-validation.html">Introduction to Jakarta Bean Validation</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../../beanvalidation/bean-validation-advanced/bean-validation-advanced.html">Bean Validation: Advanced Topics</a>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="../../security/security.html">Jakarta Security</a>
  </li>
  <li class="nav-item" data-depth="1">
    <button class="nav-item-toggle"></button>
    <span class="nav-text">Jakarta Servlets</span>
<ul class="nav-list">
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../../web/webapp/webapp.html">Getting Started with Web Applications</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../../web/servlets/servlets.html">Jakarta Servlet Technology</a>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="1">
    <button class="nav-item-toggle"></button>
    <span class="nav-text">Jakarta Faces</span>
<ul class="nav-list">
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../../web/faces-intro/faces-intro.html">Jakarta Faces Technology</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../../web/faces-facelets/faces-facelets.html">Introduction to Facelets</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../../web/faces-page/faces-page.html">Using Jakarta Faces Technology in Web Pages</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../../web/faces-page-core/faces-page-core.html">Using Converters, Listeners, and Validators</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../../web/faces-develop/faces-develop.html">Developing with Jakarta Faces Technology</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../../web/faces-ajax/faces-ajax.html">Using Ajax with Jakarta Faces Technology</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../../web/faces-advanced-cc/faces-advanced-cc.html">Composite Components: Advanced Topics and an Example</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../../web/faces-custom/faces-custom.html">Creating Custom UI Components and Other Custom Objects</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../../web/faces-configure/faces-configure.html">Configuring Jakarta Faces Applications</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../../web/faces-ws/faces-ws.html">Using WebSockets with Jakarta Faces Technology</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../../web/webi18n/webi18n.html">Internationalizing and Localizing Web Applications</a>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="../../web/websocket/websocket.html">Jakarta WebSocket</a>
  </li>
  <li class="nav-item" data-depth="1">
    <button class="nav-item-toggle"></button>
    <span class="nav-text">Jakarta Persistence</span>
<ul class="nav-list">
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../../persist/persistence-intro/persistence-intro.html">Introduction to Jakarta Persistence</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../../persist/persistence-basicexamples/persistence-basicexamples.html">Running the Persistence Examples</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../../persist/persistence-querylanguage/persistence-querylanguage.html">The Jakarta Persistence Query Language</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../../persist/persistence-criteria/persistence-criteria.html">Using the Criteria API to Create Queries</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../../persist/persistence-string-queries/persistence-string-queries.html">Creating and Using String-Based Criteria Queries</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../../persist/persistence-locking/persistence-locking.html">Controlling Concurrent Access to Entity Data with Locking</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../../persist/persistence-entitygraphs/persistence-entitygraphs.html">Creating Fetch Plans with Entity Graphs</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../../persist/persistence-cache/persistence-cache.html">Using a Second-Level Cache with Jakarta Persistence Applications</a>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="1">
    <button class="nav-item-toggle"></button>
    <span class="nav-text">Jakarta Enterprise Beans Lite</span>
<ul class="nav-list">
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../../entbeans/ejb-intro/ejb-intro.html">Enterprise Beans</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../../entbeans/ejb-gettingstarted/ejb-gettingstarted.html">Getting Started with Enterprise Beans</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../../entbeans/ejb-basicexamples/ejb-basicexamples.html">Running the Enterprise Bean Examples</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../../entbeans/ejb-async/ejb-async.html">Using Asynchronous Method Invocation in Session Beans</a>
  </li>
</ul>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="0">
    <button class="nav-item-toggle"></button>
    <span class="nav-text">Jakarta EE Platform</span>
<ul class="nav-list">
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="../mail-api/mail-api.html">Jakarta Mail</a>
  </li>
  <li class="nav-item" data-depth="1">
    <button class="nav-item-toggle"></button>
    <span class="nav-text">Jakarta Messaging</span>
<ul class="nav-list">
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../jms-concepts/jms-concepts.html">Jakarta Messaging Concepts</a>
  </li>
  <li class="nav-item is-current-page" data-depth="2">
    <a class="nav-link" href="jms-examples.html">Jakarta Messaging Examples</a>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="../../supporttechs/batch-processing/batch-processing.html">Jakarta Batch</a>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="0">
    <button class="nav-item-toggle"></button>
    <span class="nav-text">Advanced</span>
<ul class="nav-list">
  <li class="nav-item" data-depth="1">
    <button class="nav-item-toggle"></button>
    <span class="nav-text">Web Profile</span>
<ul class="nav-list">
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../../security/security-authentication/security-authentication.html">Jakarta Authentication</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../../security/security-authorization/security-authorization.html">Jakarta Authorization</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../../supporttechs/transactions/transactions.html">Jakarta Transactions</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../../supporttechs/concurrency-utilities/concurrency-utilities.html">Jakarta Concurrency</a>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="1">
    <button class="nav-item-toggle"></button>
    <span class="nav-text">Full Profile</span>
<ul class="nav-list">
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../../supporttechs/connectors/connectors.html">Jakarta Connectors</a>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="1">
    <button class="nav-item-toggle"></button>
    <span class="nav-text">Optional Components</span>
<ul class="nav-list">
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../../web/faces-el/faces-el.html">Jakarta Expression Language</a>
  </li>
  <li class="nav-item" data-depth="2">
    <span class="nav-text">Jakarta XML Binding</span>
  </li>
</ul>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="0">
    <button class="nav-item-toggle"></button>
    <span class="nav-text">Archived</span>
<ul class="nav-list">
  <li class="nav-item" data-depth="1">
    <button class="nav-item-toggle"></button>
    <span class="nav-text">Web Profile</span>
<ul class="nav-list">
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../../web/jakarta-pages/jakarta-pages.html">Jakarta Pages</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../../web/jakarta-tags/jakarta-tags.html">Jakarta Tags</a>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="1">
    <button class="nav-item-toggle"></button>
    <span class="nav-text">Full Profile</span>
<ul class="nav-list">
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../../websvcs/xml-websvcs/xml-websvcs.html">XML Web Services</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../../entbeans/ejb-full/ejb-full.html">Jakarta Enterprise Beans Full</a>
  </li>
</ul>
  </li>
</ul>
  </li>
</ul>
  </nav>
</div>
<div class="nav-panel-explore" data-panel="explore">
  <div class="context">
    <span class="title">Jakarta EE Tutorial</span>
    <span class="version">10</span>
  </div>
  <ul class="components">
    <li class="component is-current">
      <a class="title" href="../../index.html">Jakarta EE Tutorial</a>
      <ul class="versions">
        <li class="version is-current is-latest">
          <a href="../../index.html">10</a>
        </li>
      </ul>
    </li>
  </ul>
</div>
    </div>
  </aside>
</div>
<main class="article">
<div class="toolbar" role="navigation">
<button class="nav-toggle"></button>
<nav class="breadcrumbs" aria-label="breadcrumbs">
  <ul>
    <li><a href="../../index.html">Jakarta EE Tutorial</a></li>
    <li>Jakarta EE Platform</li>
    <li>Jakarta Messaging</li>
    <li><a href="jms-examples.html">Jakarta Messaging Examples</a></li>
  </ul>
</nav>
  <div class="edit-this-page"><a href="file:///home/john/workspace/virtua/jakartaee-tutorial/src/main/antora/modules/messaging/pages/jms-examples/jms-examples.adoc">Edit this Page</a></div>
</div>
  <div class="content">
<aside class="toc sidebar" data-title="Contents" data-levels="2">
  <div class="toc-menu"></div>
</aside>
<article class="doc">
<h1 class="page">Jakarta Messaging Examples</h1>
<div id="preamble">
<div class="sectionbody">
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>We are working on a fresh, updated Jakarta EE Tutorial. This section hasn&#8217;t yet been updated.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>This chapter provides examples that show how to use Jakarta Messaging in various kinds of Jakarta EE applications.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_building_and_running_jakarta_messaging_examples"><a class="anchor" href="#_building_and_running_jakarta_messaging_examples"></a>Building and Running Jakarta Messaging Examples</h2>
<div class="sectionbody">
<div class="paragraph">
<p>The examples are in the <code><em>tut-install</em>/examples/jms/</code> directory.</p>
</div>
<div class="paragraph">
<p>To build and run each example:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Use NetBeans IDE or Maven to compile, package, and in some cases deploy the example.</p>
</li>
<li>
<p>Use NetBeans IDE, Maven, or the <code>appclient</code> command to run the application client, or use the browser to run the web application examples.</p>
</li>
</ol>
</div>
<div class="paragraph">
<p>Before you deploy or run the examples, you need to create resources for them.
Some examples have a <code>glassfish-resources.xml</code> file that is used to create resources for that example and others.
You can use the <code>asadmin</code> command to create the resources.</p>
</div>
<div class="paragraph">
<p>To use the <code>asadmin</code> and <code>appclient</code> commands, you need to put the GlassFish Server <code>bin</code> directories in your command path, as described in <a href="../../intro/usingexamples/usingexamples.html#_glassfish_server_installation_tips" class="xref page">GlassFish Server Installation Tips</a>.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_overview_of_the_jakarta_messaging_examples"><a class="anchor" href="#_overview_of_the_jakarta_messaging_examples"></a>Overview of the Jakarta Messaging Examples</h2>
<div class="sectionbody">
<div class="paragraph">
<p>The following tables list the examples used in this chapter, describe what they do, and link to the section that describes them fully.
The example directory for each example is relative to the <code><em>tut-install</em>/examples/jms/</code> directory.</p>
</div>
<table class="tableblock frame-all grid-all" style="width: 80%;">
<caption class="title">Jakarta Messaging Examples That Show the Use of Jakarta EE Application Clients</caption>
<colgroup>
<col style="width: 25%;">
<col style="width: 75%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Example Directory</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>simple/producer</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Using an application client to send messages; see <a href="../../web/websocket/websocket.html#_sending_messages" class="xref page">Sending Messages</a></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>simple/synchconsumer</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Using an application client to receive messages synchronously; see <a href="#_receiving_messages_synchronously">Receiving Messages Synchronously</a></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>simple/asynchconsumer</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Using an application client to receive messages asynchronously; see <a href="#_using_a_message_listener_for_asynchronous_message_delivery">Using a Message Listener for Asynchronous Message Delivery</a></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>simple/messagebrowser</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Using an application client to use a <code>QueueBrowser</code> to browse a queue; see <a href="#_browsing_messages_on_a_queue">Browsing Messages on a Queue</a></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>simple/clientackconsumer</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Using an application client to acknowledge messages received synchronously; see <a href="#_acknowledging_messages">Acknowledging Messages</a></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>durablesubscriptionexample</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Using an application client to create a durable subscription on a topic; see <a href="#_using_durable_subscriptions">Using Durable Subscriptions</a></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>transactedexample</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Using an application client to send and receive messages in local transactions (also uses request-reply messaging); see <a href="#_using_local_transactions">Using Local Transactions</a></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>shared/sharedconsumer</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Using an application client to create shared nondurable topic subscriptions; see <a href="#_using_shared_nondurable_subscriptions">Using Shared Nondurable Subscriptions</a></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>shared/shareddurableconsumer</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Using an application client to create shared durable topic subscriptions; see <a href="#_using_shared_durable_subscriptions">Using Shared Durable Subscriptions</a></p></td>
</tr>
</tbody>
</table>
<table class="tableblock frame-all grid-all" style="width: 80%;">
<caption class="title">Jakarta Messaging Examples That Show the Use of Jakarta EE Web and Enterprise Bean Components</caption>
<colgroup>
<col style="width: 25%;">
<col style="width: 75%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Example Directory</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>websimplemessage</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Using managed beans to send messages and to receive messages synchronously; see <a href="#_sending_and_receiving_messages_using_a_simple_web_application">Sending and Receiving Messages Using a Simple Web Application</a></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>simplemessage</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Using an application client to send messages, and using a message-driven bean to receive messages asynchronously; see <a href="#_receiving_messages_asynchronously_using_a_message_driven_bean">Receiving Messages Asynchronously Using a Message-Driven Bean</a></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>clientsessionmdb</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Using a session bean to send messages, and using a message-driven bean to receive messages; see <a href="#_sending_messages_from_a_session_bean_to_an_mdb">Sending Messages from a Session Bean to an MDB</a></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>clientmdbentity</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Using an application client, two message-driven beans, and JPA persistence to create a simple HR application; see <a href="#_using_an_entity_to_join_messages_from_two_mdbs">Using an Entity to Join Messages from Two MDBs</a></p></td>
</tr>
</tbody>
</table>
</div>
</div>
<div class="sect1">
<h2 id="_writing_simple_jakarta_messaging_applications"><a class="anchor" href="#_writing_simple_jakarta_messaging_applications"></a>Writing Simple Jakarta Messaging Applications</h2>
<div class="sectionbody">
<div class="paragraph">
<p>This section shows how to create, package, and run simple Messaging clients that are packaged as application clients.</p>
</div>
<div class="sect2">
<h3 id="_overview_of_writing_simple_jakarta_messaging_application"><a class="anchor" href="#_overview_of_writing_simple_jakarta_messaging_application"></a>Overview of Writing Simple Jakarta Messaging Application</h3>
<div class="paragraph">
<p>The clients demonstrate the basic tasks a Jakarta Messaging application must perform:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Creating a <code>JMSContext</code></p>
</li>
<li>
<p>Creating message producers and consumers</p>
</li>
<li>
<p>Sending and receiving messages</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Each example uses two clients: one that sends messages and one that receives them.
You can run the clients in two terminal windows.</p>
</div>
<div class="paragraph">
<p>When you write a Messaging client to run in an enterprise bean application, you use many of the same methods in much the same sequence as for an application client.
However, there are some significant differences.
<a href="../jms-concepts/jms-concepts.html#_using_jakarta_messaging_in_jakarta_ee_applications" class="xref page">Using Jakarta Messaging in Jakarta EE Applications</a> describes these differences, and this chapter provides examples that illustrate them.</p>
</div>
<div class="paragraph">
<p>The examples for this section are in the <code><em>tut-install</em>/examples/jms/simple/</code> directory, under the following subdirectories:</p>
</div>
<div class="paragraph">
<p><code>producer/</code><br>
<code>synchconsumer/</code><br>
<code>asynchconsumer/</code><br>
<code>messagebrowser/</code><br>
<code>clientackconsumer/</code><br></p>
</div>
<div class="paragraph">
<p>Before running the examples, you need to start GlassFish Server and create administered objects.</p>
</div>
</div>
<div class="sect2">
<h3 id="_starting_the_jakarta_messaging_provider"><a class="anchor" href="#_starting_the_jakarta_messaging_provider"></a>Starting the Jakarta Messaging Provider</h3>
<div class="paragraph">
<p>When you use GlassFish Server, your Messaging provider is GlassFish Server.
Start the server as described in <a href="../../intro/usingexamples/usingexamples.html#_starting_and_stopping_glassfish_server" class="xref page">Starting and Stopping GlassFish Server</a>.</p>
</div>
</div>
<div class="sect2">
<h3 id="_creating_jakarta_messaging_administered_objects"><a class="anchor" href="#_creating_jakarta_messaging_administered_objects"></a>Creating Jakarta Messaging Administered Objects</h3>
<div class="paragraph">
<p>This example uses the following Jakarta Messaging administered objects:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>A connection factory</p>
</li>
<li>
<p>Two destination resources: a topic and a queue</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Before you run the applications, you can use the <code>asadmin add-resources</code> command to create needed Messaging resources, specifying as the argument a file named <code>glassfish-resources.xml</code>.
This file can be created in any project using NetBeans IDE, although you can also create it by hand.
A file for the needed resources is present in the <code>jms/simple/producer/src/main/setup/</code> directory.</p>
</div>
<div class="paragraph">
<p>The Jakarta Messaging examples use a connection factory with the logical JNDI lookup name <code>java:comp/DefaultJMSConnectionFactory</code>, which is preconfigured in GlassFish Server.</p>
</div>
<div class="paragraph">
<p>You can also use the <code>asadmin create-jms-resource</code> command to create resources, the <code>asadmin list-jms-resources</code> command to display their names, and the <code>asadmin delete-jms-resource</code> command to remove them.</p>
</div>
<div class="sect3">
<h4 id="_to_create_resources_for_the_simple_examples"><a class="anchor" href="#_to_create_resources_for_the_simple_examples"></a>To Create Resources for the Simple Examples</h4>
<div class="paragraph">
<p>A <code>glassfish-resources.xml</code> file in one of the Maven projects can create all the resources needed for the simple examples.</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Make sure that GlassFish Server has been started (see <a href="../../intro/usingexamples/usingexamples.html#_starting_and_stopping_glassfish_server" class="xref page">Starting and Stopping GlassFish Server</a>).</p>
</li>
<li>
<p>In a command window, go to the <code>Producer</code> example.</p>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-shell hljs" data-lang="shell">cd tut-install/jms/simple/producer</code></pre>
</div>
</div>
</li>
<li>
<p>Create the resources using the <code>asadmin add-resources</code> command:</p>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-shell hljs" data-lang="shell">asadmin add-resources src/main/setup/glassfish-resources.xml</code></pre>
</div>
</div>
</li>
<li>
<p>Verify the creation of the resources:</p>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-shell hljs" data-lang="shell">asadmin list-jms-resources</code></pre>
</div>
</div>
<div class="paragraph">
<p>The command lists the two destinations and connection factory specified in the <code>glassfish-resources.xml</code> file in addition to the platform default connection factory:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-shell hljs" data-lang="shell">jms/MyQueue
jms/MyTopic
jms/__defaultConnectionFactory
Command list-jms-resources executed successfully.</code></pre>
</div>
</div>
<div class="paragraph">
<p>In GlassFish Server, the Jakarta EE <code>java:comp/DefaultJMSConnectionFactory</code> resource is mapped to a connection factory named <code>jms/__defaultConnectionFactory</code>.</p>
</div>
</li>
</ol>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_building_all_the_simple_examples"><a class="anchor" href="#_building_all_the_simple_examples"></a>Building All the Simple Examples</h3>
<div class="paragraph">
<p>To run the simple examples using GlassFish Server, package each example in an application client JAR file.
The application client JAR file requires a manifest file, located in the <code>src/main/java/META-INF/</code> directory for each example, along with the <code>.class</code> file.</p>
</div>
<div class="paragraph">
<p>The <code>pom.xml</code> file for each example specifies a plugin that creates an application client JAR file.
You can build the examples using either NetBeans IDE or Maven.</p>
</div>
<div class="sect3">
<h4 id="_to_build_all_the_simple_examples_using_netbeans_ide"><a class="anchor" href="#_to_build_all_the_simple_examples_using_netbeans_ide"></a>To Build All the Simple Examples Using NetBeans IDE</h4>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>From the <strong>File</strong> menu, choose <strong>Open Project</strong>.</p>
</li>
<li>
<p>In the <strong>Open Project</strong> dialog box, navigate to:</p>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-asciidoc hljs" data-lang="asciidoc">tut-install/examples/jms</code></pre>
</div>
</div>
</li>
<li>
<p>Expand the <code>jms</code> node and select the <code>simple</code> folder.</p>
</li>
<li>
<p>Click <strong>Open Project</strong> to open all the simple examples.</p>
</li>
<li>
<p>In the <strong>Projects</strong> tab, right-click the <code>simple</code> project and select <strong>Build</strong> to build all the examples.</p>
<div class="paragraph">
<p>This command places the application client JAR files in the <code>target</code> directories for the examples.</p>
</div>
</li>
</ol>
</div>
</div>
<div class="sect3">
<h4 id="_to_build_all_the_simple_examples_using_maven"><a class="anchor" href="#_to_build_all_the_simple_examples_using_maven"></a>To Build All the Simple Examples Using Maven</h4>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>In a terminal window, go to the <code>simple</code> directory:</p>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-shell hljs" data-lang="shell">cd tut-install/jms/simple/</code></pre>
</div>
</div>
</li>
<li>
<p>Enter the following command to build all the projects:</p>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-shell hljs" data-lang="shell">mvn install</code></pre>
</div>
</div>
<div class="paragraph">
<p>This command places the application client JAR files in the <code>target</code> directories for the examples.</p>
</div>
</li>
</ol>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_sending_messages"><a class="anchor" href="#_sending_messages"></a>Sending Messages</h3>
<div class="paragraph">
<p>This section describes how to use a client to send messages.
The <code>Producer.java</code> client will send messages in all of these examples.</p>
</div>
<div class="sect3">
<h4 id="_general_steps_performed_in_the_example"><a class="anchor" href="#_general_steps_performed_in_the_example"></a>General Steps Performed in the Example</h4>
<div class="paragraph">
<p>General steps this example performs are as follows.</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Inject resources for the administered objects used by the example.</p>
</li>
<li>
<p>Accept and verify command-line arguments.
You can use this example to send any number of messages to either a queue or a topic, so you specify the destination type and the number of messages on the command line when you run the program.</p>
</li>
<li>
<p>Create a <code>JMSContext</code>, then send the specified number of text messages in the form of strings, as described in <a href="../jms-concepts/jms-concepts.html#_message_bodies" class="xref page">Message Bodies</a>.</p>
</li>
<li>
<p>Send a final message of type <code>Message</code> to indicate that the consumer should expect no more messages.</p>
</li>
<li>
<p>Catch any exceptions.</p>
</li>
</ol>
</div>
</div>
<div class="sect3">
<h4 id="_the_producer_java_client"><a class="anchor" href="#_the_producer_java_client"></a>The Producer.java Client</h4>
<div class="paragraph">
<p>The sending client, <code>Producer.java</code>, performs the following steps.</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Injects resources for a connection factory, queue, and topic:</p>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">@Resource(lookup = "java:comp/DefaultJMSConnectionFactory")
private static ConnectionFactory connectionFactory;
@Resource(lookup = "jms/MyQueue")
private static Queue queue;
@Resource(lookup = "jms/MyTopic")
private static Topic topic;</code></pre>
</div>
</div>
</li>
<li>
<p>Retrieves and verifies command-line arguments that specify the destination type and the number of arguments:</p>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">final int NUM_MSGS;
String destType = args[0];
System.out.println("Destination type is " + destType);
if ( ! ( destType.equals("queue") || destType.equals("topic") ) ) {
    System.err.println("Argument must be \"queue\" or " + "\"topic\"");
    System.exit(1);
}
if (args.length == 2){
    NUM_MSGS = (new Integer(args[1])).intValue();
} else {
    NUM_MSGS = 1;
}</code></pre>
</div>
</div>
</li>
<li>
<p>Assigns either the queue or the topic to a destination object, based on the specified destination type:</p>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">Destination dest = null;
try {
    if (destType.equals("queue")) {
        dest = (Destination) queue;
    } else {
        dest = (Destination) topic;
    }
} catch (Exception e) {
    System.err.println("Error setting destination: " + e.toString());
    System.exit(1);
}</code></pre>
</div>
</div>
</li>
<li>
<p>Within a <code>try-with-resources</code> block, creates a <code>JMSContext</code>:</p>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">try (JMSContext context = connectionFactory.createContext();) { ... }</code></pre>
</div>
</div>
</li>
<li>
<p>Sets the message count to zero, then creates a <code>JMSProducer</code> and sends one or more messages to the destination and increments the count.
Messages in the form of strings are of the <code>TextMessage</code> message type:</p>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">    int count = 0;
    for (int i = 0; i &lt; NUM_MSGS; i++) {
        String message = "This is message " + (i + 1)
                + " from producer";
        // Comment out the following line to send many messages
        System.out.println("Sending message: " + message);
        context.createProducer().send(dest, message);
        count += 1;
    }
    System.out.println("Text messages sent: " + count);</code></pre>
</div>
</div>
</li>
<li>
<p>Sends an empty control message to indicate the end of the message stream:</p>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">    context.createProducer().send(dest, context.createMessage());</code></pre>
</div>
</div>
<div class="paragraph">
<p>Sending an empty message of no specified type is a convenient way for an application to indicate to the consumer that the final message has arrived.</p>
</div>
</li>
<li>
<p>Catches and handles any exceptions.
The end of the <code>try-with-resources</code> block automatically causes the <code>JMSContext</code> to be closed:</p>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">} catch (Exception e) {
    System.err.println("Exception occurred: " + e.toString());
    System.exit(1);
}
System.exit(0);</code></pre>
</div>
</div>
</li>
</ol>
</div>
</div>
<div class="sect3">
<h4 id="_to_run_the_producer_client"><a class="anchor" href="#_to_run_the_producer_client"></a>To Run the Producer Client</h4>
<div class="paragraph">
<p>You can run the client using the <code>appclient</code> command.
The <code>Producer</code> client takes one or two command-line arguments: a destination type and, optionally, a number of messages.
If you do not specify a number of messages, the client sends one message.</p>
</div>
<div class="paragraph">
<p>You will use the client to send three messages to a queue.</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Make sure that GlassFish Server has been started (see <a href="../../intro/usingexamples/usingexamples.html#_starting_and_stopping_glassfish_server" class="xref page">Starting and Stopping GlassFish Server</a>) and that you have created resources and built the simple Jakarta Messaging examples (see <a href="#_creating_jakarta_messaging_administered_objects">Creating Jakarta Messaging Administered Objects</a> and <a href="#_building_all_the_simple_examples">Building All the Simple Examples</a>).</p>
</li>
<li>
<p>In a terminal window, go to the <code>producer</code> directory:</p>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-shell hljs" data-lang="shell">cd producer</code></pre>
</div>
</div>
</li>
<li>
<p>Run the <code>Producer</code> program, sending three messages to the queue:</p>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-shell hljs" data-lang="shell">appclient -client target/producer.jar queue 3</code></pre>
</div>
</div>
<div class="paragraph">
<p>The output of the program looks like this (along with some additional output):</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-shell hljs" data-lang="shell">Destination type is queue
Sending message: This is message 1 from producer
Sending message: This is message 2 from producer
Sending message: This is message 3 from producer
Text messages sent: 3</code></pre>
</div>
</div>
<div class="paragraph">
<p>The messages are now in the queue, waiting to be received.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
When you run an application client, the command may take a long time to complete.
</td>
</tr>
</table>
</div>
</li>
</ol>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_receiving_messages_synchronously"><a class="anchor" href="#_receiving_messages_synchronously"></a>Receiving Messages Synchronously</h3>
<div class="paragraph">
<p>This section describes the receiving client, which uses the <code>receive</code> method to consume messages synchronously.
This section then explains how to run the clients using GlassFish Server.</p>
</div>
<div class="sect3">
<h4 id="_the_synchconsumer_java_client"><a class="anchor" href="#_the_synchconsumer_java_client"></a>The SynchConsumer.java Client</h4>
<div class="paragraph">
<p>The receiving client, <code>SynchConsumer.java</code>, performs the following steps.</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Injects resources for a connection factory, queue, and topic.</p>
</li>
<li>
<p>Assigns either the queue or the topic to a destination object, based on the specified destination type.</p>
</li>
<li>
<p>Within a <code>try-with-resources</code> block, creates a <code>JMSContext</code>.</p>
</li>
<li>
<p>Creates a <code>JMSConsumer</code>, starting message delivery:</p>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">consumer = context.createConsumer(dest);</code></pre>
</div>
</div>
</li>
<li>
<p>Receives the messages sent to the destination until the end-of-message-stream control message is received:</p>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">int count = 0;
while (true) {
    Message m = consumer.receive(1000);
    if (m != null) {
        if (m instanceof TextMessage) {
            System.out.println(
                    "Reading message: " + m.getBody(String.class));
            count += 1;
        } else {
            break;
        }
    }
}
System.out.println("Messages received: " + count);</code></pre>
</div>
</div>
<div class="paragraph">
<p>Because the control message is not a <code>TextMessage</code>, the receiving client terminates the <code>while</code> loop and stops receiving messages after the control message arrives.</p>
</div>
</li>
<li>
<p>Catches and handles any exceptions.
The end of the <code>try-with-resources</code> block automatically causes the <code>JMSContext</code> to be closed.</p>
</li>
</ol>
</div>
<div class="paragraph">
<p>The <code>SynchConsumer</code> client uses an indefinite <code>while</code> loop to receive messages, calling <code>receive</code> with a timeout argument.</p>
</div>
</div>
<div class="sect3">
<h4 id="_to_run_the_synchconsumer_and_producer_clients"><a class="anchor" href="#_to_run_the_synchconsumer_and_producer_clients"></a>To Run the SynchConsumer and Producer Clients</h4>
<div class="paragraph">
<p>You can run the client using the <code>appclient</code> command.
The <code>SynchConsumer</code> client takes one command-line argument, the destination type.</p>
</div>
<div class="paragraph">
<p>These steps show how to receive and send messages synchronously using both a queue and a topic.
The steps assume you already ran the <code>Producer</code> client and have three messages waiting in the queue.</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>In the same terminal window where you ran <code>Producer</code>, go to the <code>synchconsumer</code> directory:</p>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-shell hljs" data-lang="shell">cd ../synchconsumer</code></pre>
</div>
</div>
</li>
<li>
<p>Run the <code>SynchConsumer</code> client, specifying the queue:</p>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-shell hljs" data-lang="shell">appclient -client target/synchconsumer.jar queue</code></pre>
</div>
</div>
<div class="paragraph">
<p>The output of the client looks like this (along with some additional output):</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-shell hljs" data-lang="shell">Destination type is queue
Reading message: This is message 1 from producer
Reading message: This is message 2 from producer
Reading message: This is message 3 from producer
Messages received: 3</code></pre>
</div>
</div>
</li>
<li>
<p>Now try running the clients in the opposite order.
Run the <code>SynchConsumer</code> client:</p>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-shell hljs" data-lang="shell">appclient -client target/synchconsumer.jar queue</code></pre>
</div>
</div>
<div class="paragraph">
<p>The client displays the destination type and then waits for messages.</p>
</div>
</li>
<li>
<p>Open a new terminal window and run the <code>Producer</code> client:</p>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-shell hljs" data-lang="shell">cd tut-install/jms/simple/producer
appclient -client target/producer.jar queue 3</code></pre>
</div>
</div>
<div class="paragraph">
<p>When the messages have been sent, the <code>SynchConsumer</code> client receives them and exits.</p>
</div>
</li>
<li>
<p>Now run the <code>Producer</code> client using a topic instead of a queue:</p>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-shell hljs" data-lang="shell">appclient -client target/producer.jar topic 3</code></pre>
</div>
</div>
<div class="paragraph">
<p>The output of the client looks like this (along with some additional output):</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-shell hljs" data-lang="shell">Destination type is topic
Sending message: This is message 1 from producer
Sending message: This is message 2 from producer
Sending message: This is message 3 from producer
Text messages sent: 3</code></pre>
</div>
</div>
</li>
<li>
<p>Now, in the other terminal window, run the <code>SynchConsumer</code> client using the topic:</p>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-shell hljs" data-lang="shell">appclient -client target/synchconsumer.jar topic</code></pre>
</div>
</div>
<div class="paragraph">
<p>The result, however, is different.
Because you are using a subscription on a topic, messages that were sent before you created the subscription on the topic will not be added to the subscription and delivered to the consumer.
(See <a href="../jms-concepts/jms-concepts.html#_publishsubscribe_messaging_style" class="xref page">Publish/Subscribe Messaging Style</a> and <a href="../jms-concepts/jms-concepts.html#_consuming_messages_from_topics" class="xref page">Consuming Messages from Topics</a> for details.)
Instead of receiving the messages, the client waits for messages to arrive.</p>
</div>
</li>
<li>
<p>Leave the <code>SynchConsumer</code> client running and run the <code>Producer</code> client again:</p>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-shell hljs" data-lang="shell">appclient -client target/producer.jar topic 3</code></pre>
</div>
</div>
<div class="paragraph">
<p>Now the <code>SynchConsumer</code> client receives the messages:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-shell hljs" data-lang="shell">Destination type is topic
Reading message: This is message 1 from producer
Reading message: This is message 2 from producer
Reading message: This is message 3 from producer
Messages received: 3</code></pre>
</div>
</div>
<div class="paragraph">
<p>Because these messages were sent after the consumer was started, the client receives them.</p>
</div>
</li>
</ol>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_using_a_message_listener_for_asynchronous_message_delivery"><a class="anchor" href="#_using_a_message_listener_for_asynchronous_message_delivery"></a>Using a Message Listener for Asynchronous Message Delivery</h3>
<div class="paragraph">
<p>This section describes the receiving clients in an example that uses a message listener for asynchronous message delivery.
This section then explains how to compile and run the clients using GlassFish Server.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
In the Jakarta EE platform, message listeners can be used only in application clients, as in this example.
To allow asynchronous message delivery in a web or enterprise bean application, you use a message-driven bean, shown in later examples in this chapter.
</td>
</tr>
</table>
</div>
<div class="sect3">
<h4 id="_writing_the_asynchconsumer_java_and_textlistener_java_clients"><a class="anchor" href="#_writing_the_asynchconsumer_java_and_textlistener_java_clients"></a>Writing the AsynchConsumer.java and TextListener.java Clients</h4>
<div class="paragraph">
<p>The sending client is <code>Producer.java</code>, the same client used in <a href="#_receiving_messages_synchronously">Receiving Messages Synchronously</a>.</p>
</div>
<div class="paragraph">
<p>An asynchronous consumer normally runs indefinitely.
This one runs until the user types the character <code>q</code> or <code>Q</code> to stop the client.</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>The client, <code>AsynchConsumer.java</code>, performs the following steps.</p>
<div class="olist loweralpha">
<ol class="loweralpha" type="a">
<li>
<p>Injects resources for a connection factory, queue, and topic.</p>
</li>
<li>
<p>Assigns either the queue or the topic to a destination object, based on the specified destination type.</p>
</li>
<li>
<p>In a <code>try-with-resources</code> block, creates a <code>JMSContext</code>.</p>
</li>
<li>
<p>Creates a <code>JMSConsumer</code>.</p>
</li>
<li>
<p>Creates an instance of the <code>TextListener</code> class and registers it as the message listener for the <code>JMSConsumer</code>:</p>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">listener = new TextListener();
consumer.setMessageListener(listener);</code></pre>
</div>
</div>
</li>
<li>
<p>Listens for the messages sent to the destination, stopping when the user types the character <code>q</code> or <code>Q</code> (it uses a <code>java.io.InputStreamReader</code> to do this).</p>
</li>
<li>
<p>Catches and handles any exceptions.
The end of the <code>try-with-resources</code> block automatically causes the <code>JMSContext</code> to be closed, thus stopping delivery of messages to the message listener.</p>
</li>
</ol>
</div>
</li>
<li>
<p>The message listener, <code>TextListener.java</code>, follows these steps:</p>
<div class="olist loweralpha">
<ol class="loweralpha" type="a">
<li>
<p>When a message arrives, the <code>onMessage</code> method is called automatically.</p>
</li>
<li>
<p>If the message is a <code>TextMessage</code>, the <code>onMessage</code> method displays its content as a string value.
If the message is not a text message, it reports this fact:</p>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">public void onMessage(Message m) {
    try {
        if (m instanceof TextMessage) {
            System.out.println(
                    "Reading message: " + m.getBody(String.class));
        } else {
             System.out.println("Message is not a TextMessage");
        }
    } catch (JMSException | JMSRuntimeException e) {
        System.err.println("JMSException in onMessage(): " + e.toString());
    }
}</code></pre>
</div>
</div>
</li>
</ol>
</div>
</li>
</ol>
</div>
<div class="paragraph">
<p>For this example, you will use the same connection factory and destinations you created in <a href="#_to_create_resources_for_the_simple_examples">To Create Resources for the Simple Examples</a>.</p>
</div>
<div class="paragraph">
<p>The steps assume that you have already built and packaged all the examples using NetBeans IDE or Maven.</p>
</div>
</div>
<div class="sect3">
<h4 id="_to_run_the_asynchconsumer_and_producer_clients"><a class="anchor" href="#_to_run_the_asynchconsumer_and_producer_clients"></a>To Run the AsynchConsumer and Producer Clients</h4>
<div class="paragraph">
<p>You will need two terminal windows, as you did in <a href="#_receiving_messages_synchronously">Receiving Messages Synchronously</a>.</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>In the terminal window where you ran the <code>SynchConsumer</code> client, go to the <code>asynchconsumer</code> example directory:</p>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-shell hljs" data-lang="shell">cd tut-install/jms/simple/asynchconsumer</code></pre>
</div>
</div>
</li>
<li>
<p>Run the <code>AsynchConsumer</code> client, specifying the <code>topic</code> destination type:</p>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-shell hljs" data-lang="shell">appclient -client target/asynchconsumer.jar topic</code></pre>
</div>
</div>
<div class="paragraph">
<p>The client displays the following lines (along with some additional output) and then waits for messages:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-shell hljs" data-lang="shell">Destination type is topic
To end program, enter Q or q, then &lt;return&gt;</code></pre>
</div>
</div>
</li>
<li>
<p>In the terminal window where you ran the <code>Producer</code> client previously, run the client again, sending three messages:</p>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-shell hljs" data-lang="shell">appclient -client target/producer.jar topic 3</code></pre>
</div>
</div>
<div class="paragraph">
<p>The output of the client looks like this (along with some additional output):</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-shell hljs" data-lang="shell">Destination type is topic
Sending message: This is message 1 from producer
Sending message: This is message 2 from producer
Sending message: This is message 3 from producer
Text messages sent: 3</code></pre>
</div>
</div>
<div class="paragraph">
<p>In the other window, the <code>AsynchConsumer</code> client displays the following (along with some additional output):</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-shell hljs" data-lang="shell">Destination type is topic
To end program, enter Q or q, then &lt;return&gt;
Reading message: This is message 1 from producer
Reading message: This is message 2 from producer
Reading message: This is message 3 from producer
Message is not a TextMessage</code></pre>
</div>
</div>
<div class="paragraph">
<p>The last line appears because the client has received the non-text control message sent by the <code>Producer</code> client.</p>
</div>
</li>
<li>
<p>Enter <code>Q</code> or <code>q</code> and press Return to stop the <code>AsynchConsumer</code> client.</p>
</li>
<li>
<p>Now run the clients using a queue.</p>
<div class="paragraph">
<p>In this case, as with the synchronous example, you can run the <code>Producer</code> client first, because there is no timing dependency between the sender and receiver:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-shell hljs" data-lang="shell">appclient -client target/producer.jar queue 3</code></pre>
</div>
</div>
<div class="paragraph">
<p>The output of the client looks like this:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-shell hljs" data-lang="shell">Destination type is queue
Sending message: This is message 1 from producer
Sending message: This is message 2 from producer
Sending message: This is message 3 from producer
Text messages sent: 3</code></pre>
</div>
</div>
</li>
<li>
<p>In the other window, run the <code>AsynchConsumer</code> client:</p>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-shell hljs" data-lang="shell">appclient -client target/asynchconsumer.jar queue</code></pre>
</div>
</div>
<div class="paragraph">
<p>The output of the client looks like this (along with some additional output):</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-shell hljs" data-lang="shell">Destination type is queue
To end program, enter Q or q, then &lt;return&gt;
Reading message: This is message 1 from producer
Reading message: This is message 2 from producer
Reading message: This is message 3 from producer
Message is not a TextMessage</code></pre>
</div>
</div>
</li>
<li>
<p>Enter <code>Q</code> or <code>q</code> and press Return to stop the client.</p>
</li>
</ol>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_browsing_messages_on_a_queue"><a class="anchor" href="#_browsing_messages_on_a_queue"></a>Browsing Messages on a Queue</h3>
<div class="paragraph">
<p>This section describes an example that creates a <code>QueueBrowser</code> object to examine messages on a queue, as described in <a href="../jms-concepts/jms-concepts.html#_jakarta_messaging_queue_browsers" class="xref page">Jakarta Messaging Queue Browsers</a>.
This section then explains how to compile, package, and run the example using GlassFish Server.</p>
</div>
<div class="sect3">
<h4 id="_the_messagebrowser_java_client"><a class="anchor" href="#_the_messagebrowser_java_client"></a>The MessageBrowser.java Client</h4>
<div class="paragraph">
<p>To create a <code>QueueBrowser</code> for a queue, you call the <code>JMSContext.createBrowser</code> method with the queue as the argument.
You obtain the messages in the queue as an <code>Enumeration</code> object.
You can then iterate through the <code>Enumeration</code> object and display the contents of each message.</p>
</div>
<div class="paragraph">
<p>The <code>MessageBrowser.java</code> client performs the following steps.</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Injects resources for a connection factory and a queue.</p>
</li>
<li>
<p>In a <code>try-with-resources</code> block, creates a <code>JMSContext</code>.</p>
</li>
<li>
<p>Creates a <code>QueueBrowser</code>:</p>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">QueueBrowser browser = context.createBrowser(queue);</code></pre>
</div>
</div>
</li>
<li>
<p>Retrieves the <code>Enumeration</code> that contains the messages:</p>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">Enumeration msgs = browser.getEnumeration();</code></pre>
</div>
</div>
</li>
<li>
<p>Verifies that the <code>Enumeration</code> contains messages, then displays the contents of the messages:</p>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">if ( !msgs.hasMoreElements() ) {
    System.out.println("No messages in queue");
} else {
    while (msgs.hasMoreElements()) {
        Message tempMsg = (Message)msgs.nextElement();
        System.out.println("Message: " + tempMsg);
    }
}</code></pre>
</div>
</div>
</li>
<li>
<p>Catches and handles any exceptions.
The end of the <code>try-with-resources</code> block automatically causes the <code>JMSContext</code> to be closed.</p>
</li>
</ol>
</div>
<div class="paragraph">
<p>Dumping the message contents to standard output retrieves the message body and properties in a format that depends on the implementation of the <code>toString</code> method.
In GlassFish Server, the message format looks something like this:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-shell hljs" data-lang="shell">Text:   This is message 3 from producer
Class:                  com.sun.messaging.jmq.jmsclient.TextMessageImpl
getJMSMessageID():      ID:8-10.152.23.26(bf:27:4:e:e7:ec)-55645-1363100335526
getJMSTimestamp():      1129061034355
getJMSCorrelationID():  null
JMSReplyTo:             null
JMSDestination:         PhysicalQueue
getJMSDeliveryMode():   PERSISTENT
getJMSRedelivered():    false
getJMSType():           null
getJMSExpiration():     0
getJMSPriority():       4
Properties:             {JMSXDeliveryCount=0}</code></pre>
</div>
</div>
<div class="paragraph">
<p>Instead of displaying the message contents this way, you can call some of the <code>Message</code> interface&#8217;s getter methods to retrieve the parts of the message you want to see.</p>
</div>
<div class="paragraph">
<p>For this example, you will use the connection factory and queue you created for <a href="#_receiving_messages_synchronously">Receiving Messages Synchronously</a>.
It is assumed that you have already built and packaged all the examples.</p>
</div>
</div>
<div class="sect3">
<h4 id="_to_run_the_queuebrowser_client"><a class="anchor" href="#_to_run_the_queuebrowser_client"></a>To Run the QueueBrowser Client</h4>
<div class="paragraph">
<p>To run the <code>MessageBrowser</code> example using the <code>appclient</code> command, follow these steps.</p>
</div>
<div class="paragraph">
<p>You also need the <code>Producer</code> example to send the message to the queue, and one of the consumer clients to consume the messages after you inspect them.</p>
</div>
<div class="paragraph">
<p>To run the clients, you need two terminal windows.</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>In a terminal window, go to the <code>producer</code> directory:</p>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-shell hljs" data-lang="shell">cd tut-install/examples/jms/simple/producer/</code></pre>
</div>
</div>
</li>
<li>
<p>Run the <code>Producer</code> client, sending one message to the queue, along with the non-text control message:</p>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-shell hljs" data-lang="shell">appclient -client target/producer.jar queue</code></pre>
</div>
</div>
<div class="paragraph">
<p>The output of the client looks like this (along with some additional output):</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-shell hljs" data-lang="shell">Destination type is queue
Sending message: This is message 1 from producer
Text messages sent: 1</code></pre>
</div>
</div>
</li>
<li>
<p>In another terminal window, go to the <code>messagebrowser</code> directory:</p>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-shell hljs" data-lang="shell">cd tut-install/jms/simple/messagebrowser</code></pre>
</div>
</div>
</li>
<li>
<p>Run the <code>MessageBrowser</code> client using the following command:</p>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-shell hljs" data-lang="shell">appclient -client target/messagebrowser.jar</code></pre>
</div>
</div>
<div class="paragraph">
<p>The output of the client looks something like this (along with some additional output):</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-shell hljs" data-lang="shell">Message:
Text:   This is message 1 from producer
Class:                  com.sun.messaging.jmq.jmsclient.TextMessageImpl
getJMSMessageID():      ID:9-10.152.23.26(bf:27:4:e:e7:ec)-55645-1363100335526
getJMSTimestamp():      1363100335526
getJMSCorrelationID():  null
JMSReplyTo:             null
JMSDestination:         PhysicalQueue
getJMSDeliveryMode():   PERSISTENT
getJMSRedelivered():    false
getJMSType():           null
getJMSExpiration():     0
getJMSPriority():       4
Properties:             {JMSXDeliveryCount=0}

Message:
Class:                  com.sun.messaging.jmq.jmsclient.MessageImpl
getJMSMessageID():      ID:10-10.152.23.26(bf:27:4:e:e7:ec)-55645-1363100335526
getJMSTimestamp():      1363100335526
getJMSCorrelationID():  null
JMSReplyTo:             null
JMSDestination:         PhysicalQueue
getJMSDeliveryMode():   PERSISTENT
getJMSRedelivered():    false
getJMSType():           null
getJMSExpiration():     0
getJMSPriority():       4
Properties:             {JMSXDeliveryCount=0}</code></pre>
</div>
</div>
<div class="paragraph">
<p>The first message is the <code>TextMessage</code>, and the second is the non-text control message.</p>
</div>
</li>
<li>
<p>Go to the <code>synchconsumer</code> directory.</p>
</li>
<li>
<p>Run the <code>SynchConsumer</code> client to consume the messages:</p>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-shell hljs" data-lang="shell">appclient -client target/synchconsumer.jar queue</code></pre>
</div>
</div>
<div class="paragraph">
<p>The output of the client looks like this (along with some additional output):</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-shell hljs" data-lang="shell">Destination type is queue
Reading message: This is message 1 from producer
Messages received: 1</code></pre>
</div>
</div>
</li>
</ol>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_running_multiple_consumers_on_the_same_destination"><a class="anchor" href="#_running_multiple_consumers_on_the_same_destination"></a>Running Multiple Consumers on the Same Destination</h3>
<div class="paragraph">
<p>To illustrate further the way point-to-point and publish/subscribe messaging works, you can use the <code>Producer</code> and <code>SynchConsumer</code> examples to send messages that are then consumed by two clients running simultaneously.</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Open three command windows.
In one, go to the <code>producer</code> directory.
In the other two, go to the <code>synchconsumer</code> directory.</p>
</li>
<li>
<p>In each of the <code>synchconsumer</code> windows, start running the client, receiving messages from a queue:</p>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-shell hljs" data-lang="shell">appclient -client target/synchconsumer.jar queue</code></pre>
</div>
</div>
<div class="paragraph">
<p>Wait until you see the "Destination type is queue" message in both windows.</p>
</div>
</li>
<li>
<p>In the <code>producer</code> window, run the client, sending 20 or so messages to the queue:</p>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-shell hljs" data-lang="shell">appclient -client target/producer.jar queue 20</code></pre>
</div>
</div>
</li>
<li>
<p>Look at the output in the <code>synchconsumer</code> windows.
In point-to-point messaging, each message can have only one consumer.
Therefore, each of the clients receives some of the messages.
One of the clients receives the non-text control message, reports the number of messages received, and exits.</p>
</li>
<li>
<p>In the window of the client that did not receive the non-text control message, enter Control-C to exit the program.</p>
</li>
<li>
<p>Next, run the <code>synchconsumer</code> clients using a topic.
In each window, run the following command:</p>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-shell hljs" data-lang="shell">appclient -client target/synchconsumer.jar topic</code></pre>
</div>
</div>
<div class="paragraph">
<p>Wait until you see the "Destination type is topic" message in both windows.</p>
</div>
</li>
<li>
<p>In the <code>producer</code> window, run the client, sending 20 or so messages to the topic:</p>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-shell hljs" data-lang="shell">appclient -client target/producer.jar topic 20</code></pre>
</div>
</div>
</li>
<li>
<p>Again, look at the output in the <code>synchconsumer</code> windows.
In publish/subscribe messaging, a copy of every message is sent to each subscription on the topic.
Therefore, each of the clients receives all 20 text messages as well as the non-text control message.</p>
</li>
</ol>
</div>
</div>
<div class="sect2">
<h3 id="_acknowledging_messages"><a class="anchor" href="#_acknowledging_messages"></a>Acknowledging Messages</h3>
<div class="paragraph">
<p>Jakarta Messaging provides two alternative ways for a consuming client to ensure that a message is not acknowledged until the application has finished processing the message:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Using a synchronous consumer in a <code>JMSContext</code> that has been configured to use the <code>CLIENT_ACKNOWLEDGE</code> setting</p>
</li>
<li>
<p>Using a message listener for asynchronous message delivery in a <code>JMSContext</code> that has been configured to use the default <code>AUTO_ACKNOWLEDGE</code> setting</p>
</li>
</ul>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
In the Jakarta EE platform, <code>CLIENT_ACKNOWLEDGE</code> sessions can be used only in application clients, as in this example.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>The <code>clientackconsumer</code> example demonstrates the first alternative, in which a synchronous consumer uses client acknowledgment.
The <code>asynchconsumer</code> example described in <a href="#_using_a_message_listener_for_asynchronous_message_delivery">Using a Message Listener for Asynchronous Message Delivery</a> demonstrates the second alternative.</p>
</div>
<div class="paragraph">
<p>For information about message acknowledgment, see <a href="../jms-concepts/jms-concepts.html#_controlling_message_acknowledgment" class="xref page">Controlling Message Acknowledgment</a>.</p>
</div>
<div class="paragraph">
<p>The following table describes four possible interactions between types of consumers and types of acknowledgment.</p>
</div>
<table class="tableblock frame-all grid-all" style="width: 99%;">
<caption class="title">Message Acknowledgment with Synchronous and Asynchronous Consumers</caption>
<colgroup>
<col style="width: 20%;">
<col style="width: 20%;">
<col style="width: 60%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Consumer Type</th>
<th class="tableblock halign-left valign-top">Acknowledgment Type</th>
<th class="tableblock halign-left valign-top">Behavior</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Synchronous</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Client</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Client acknowledges message after processing is complete</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Asynchronous</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Client</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Client acknowledges message after processing is complete</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Synchronous</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Auto</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Acknowledgment happens immediately after <code>receive</code> call; message cannot be redelivered if any subsequent processing steps fail</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Asynchronous</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Auto</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Message is automatically acknowledged when <code>onMessage</code> method returns</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p>The example is under the <code><em>tut-install</em>/examples/jms/simple/clientackconsumer/</code> directory.</p>
</div>
<div class="paragraph">
<p>The example client, <code>ClientAckConsumer.java</code>, creates a <code>JMSContext</code> that specifies client acknowledgment:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">try (JMSContext context =
      connectionFactory.createContext(JMSContext.CLIENT_ACKNOWLEDGE);) {
    ...
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>The client uses a <code>while</code> loop almost identical to that used by <code>SynchConsumer.java</code>, with the exception that after processing each message, it calls the <code>acknowledge</code> method on the <code>JMSContext</code>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">context.acknowledge();</code></pre>
</div>
</div>
<div class="paragraph">
<p>The example uses the following objects:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>The <code>jms/MyQueue</code> resource that you created for <a href="#_receiving_messages_synchronously">Receiving Messages Synchronously</a>.</p>
</li>
<li>
<p><code>java:comp/DefaultJMSConnectionFactory</code>, the platform default connection factory preconfigured with GlassFish Server</p>
</li>
</ul>
</div>
<div class="sect3">
<h4 id="_to_run_the_clientackconsumer_client"><a class="anchor" href="#_to_run_the_clientackconsumer_client"></a>To Run the ClientAckConsumer Client</h4>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>In a terminal window, go to the following directory:</p>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-asciidoc hljs" data-lang="asciidoc">tut-install/examples/jms/simple/producer/</code></pre>
</div>
</div>
</li>
<li>
<p>Run the <code>Producer</code> client, sending some messages to the queue:</p>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-shell hljs" data-lang="shell">appclient -client target/producer.jar queue 3</code></pre>
</div>
</div>
</li>
<li>
<p>In another terminal window, go to the following directory:</p>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-asciidoc hljs" data-lang="asciidoc">tut-install/examples/jms/simple/clientackconsumer/</code></pre>
</div>
</div>
</li>
<li>
<p>To run the client, use the following command:</p>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-shell hljs" data-lang="shell">appclient -client target/clientackconsumer.jar</code></pre>
</div>
</div>
<div class="paragraph">
<p>The client output looks like this (along with some additional output):</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-shell hljs" data-lang="shell">Created client-acknowledge JMSContext
Reading message: This is message 1 from producer
Acknowledging TextMessage
Reading message: This is message 2 from producer
Acknowledging TextMessage
Reading message: This is message 3 from producer
Acknowledging TextMessage
Acknowledging non-text control message</code></pre>
</div>
</div>
<div class="paragraph">
<p>The client acknowledges each message explicitly after processing it, just as a <code>JMSContext</code> configured to use <code>AUTO_ACKNOWLEDGE</code> does automatically after a <code>MessageListener</code> returns successfully from processing a message received asynchronously.</p>
</div>
</li>
</ol>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_writing_more_advanced_jakarta_messaging_applications"><a class="anchor" href="#_writing_more_advanced_jakarta_messaging_applications"></a>Writing More Advanced Jakarta Messaging Applications</h2>
<div class="sectionbody">
<div class="paragraph">
<p>The following examples show how to use some of the more advanced Jakarta Messaging features: durable subscriptions and transactions.</p>
</div>
<div class="sect2">
<h3 id="_using_durable_subscriptions"><a class="anchor" href="#_using_durable_subscriptions"></a>Using Durable Subscriptions</h3>
<div class="paragraph">
<p>The <code>durablesubscriptionexample</code> example shows how unshared durable subscriptions work.
It demonstrates that a durable subscription continues to exist and accumulate messages even when there is no active consumer on it.</p>
</div>
<div class="paragraph">
<p>The example consists of two modules, a <code>durableconsumer</code> application that creates a durable subscription and consumes messages, and an <code>unsubscriber</code> application that enables you to unsubscribe from the durable subscription after you have finished running the <code>durableconsumer</code> application.</p>
</div>
<div class="paragraph">
<p>For information on durable subscriptions, see <a href="../jms-concepts/jms-concepts.html#_creating_durable_subscriptions" class="xref page">Creating Durable Subscriptions</a>.</p>
</div>
<div class="paragraph">
<p>The main client, <code>DurableConsumer.java</code>, is under the <code><em>tut-install</em>/examples/jms/durablesubscriptionexample/durableconsumer</code> directory.</p>
</div>
<div class="paragraph">
<p>The example uses a connection factory, <code>jms/DurableConnectionFactory</code>, that has a client ID.</p>
</div>
<div class="paragraph">
<p>The <code>DurableConsumer</code> client creates a <code>JMSContext</code> using the connection factory.
It then stops the <code>JMSContext</code>, calls <code>createDurableConsumer</code> to create a durable subscription and a consumer on the topic by specifying a subscription name, registers a message listener, and starts the <code>JMSContext</code> again.
The subscription is created only if it does not already exist, so the example can be run repeatedly:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">try (JMSContext context = durableConnectionFactory.createContext();) {
    context.stop();
    consumer = context.createDurableConsumer(topic, "MakeItLast");
    listener = new TextListener();
    consumer.setMessageListener(listener);
    context.start();
    ...
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>To send messages to the topic, you run the <code>producer</code> client.</p>
</div>
<div class="paragraph">
<p>The <code>unsubscriber</code> example contains a very simple <code>Unsubscriber</code> client, which creates a <code>JMSContext</code> on the same connection factory and then calls the <code>unsubscribe</code> method, specifying the subscription name:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">try (JMSContext context = durableConnectionFactory.createContext();) {
    System.out.println("Unsubscribing from durable subscription");
    context.unsubscribe("MakeItLast");
    ...
}</code></pre>
</div>
</div>
<div class="sect3">
<h4 id="_to_create_resources_for_the_durable_subscription_example"><a class="anchor" href="#_to_create_resources_for_the_durable_subscription_example"></a>To Create Resources for the Durable Subscription Example</h4>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Make sure that GlassFish Server has been started (see <a href="../../intro/usingexamples/usingexamples.html#_starting_and_stopping_glassfish_server" class="xref page">Starting and Stopping GlassFish Server</a>).</p>
</li>
<li>
<p>In a command window, go to the <code>durableconsumer</code> example.</p>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-shell hljs" data-lang="shell">cd tut-install/jms/durablesubscriptionexample/durableconsumer</code></pre>
</div>
</div>
</li>
<li>
<p>Create the resources using the <code>asadmin add-resources</code> command:</p>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-shell hljs" data-lang="shell">asadmin add-resources src/main/setup/glassfish-resources.xml</code></pre>
</div>
</div>
<div class="paragraph">
<p>The command output reports the creation of a connector connection pool and a connector resource.</p>
</div>
</li>
<li>
<p>Verify the creation of the resources:</p>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-shell hljs" data-lang="shell">asadmin list-jms-resources</code></pre>
</div>
</div>
<div class="paragraph">
<p>In addition to the resources you created for the simple examples, the command lists the new connection factory:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-shell hljs" data-lang="shell">jms/MyQueue
jms/MyTopic
jms/__defaultConnectionFactory
jms/DurableConnectionFactory
Command list-jms-resources executed successfully.</code></pre>
</div>
</div>
</li>
</ol>
</div>
</div>
<div class="sect3">
<h4 id="_to_run_the_durable_subscription_example"><a class="anchor" href="#_to_run_the_durable_subscription_example"></a>To Run the Durable Subscription Example</h4>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>In a terminal window, go to the following directory:</p>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-asciidoc hljs" data-lang="asciidoc">tut-install/examples/jms/durablesubscriptionexample/</code></pre>
</div>
</div>
</li>
<li>
<p>Build the <code>durableconsumer</code> and <code>unsubscriber</code> examples:</p>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-shell hljs" data-lang="shell">mvn install</code></pre>
</div>
</div>
</li>
<li>
<p>Go to the <code>durableconsumer</code> directory:</p>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-shell hljs" data-lang="shell">cd durableconsumer</code></pre>
</div>
</div>
</li>
<li>
<p>To run the client, enter the following command:</p>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-shell hljs" data-lang="shell">appclient -client target/durableconsumer.jar</code></pre>
</div>
</div>
<div class="paragraph">
<p>The client creates the durable consumer and then waits for messages:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-shell hljs" data-lang="shell">Creating consumer for topic
Starting consumer
To end program, enter Q or q, then &lt;return&gt;</code></pre>
</div>
</div>
</li>
<li>
<p>In another terminal window, run the <code>Producer</code> client, sending some messages to the topic:</p>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-shell hljs" data-lang="shell">cd tut-install/examples/jms/simple/producer
appclient -client target/producer.jar topic 3</code></pre>
</div>
</div>
</li>
<li>
<p>After the <code>DurableConsumer</code> client receives the messages, enter <code>q</code> or <code>Q</code> to exit the program.
At this point, the client has behaved like any other asynchronous consumer.</p>
</li>
<li>
<p>Now, while the <code>DurableConsumer</code> client is not running, use the <code>Producer</code> client to send more messages:</p>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-shell hljs" data-lang="shell">appclient -client target/producer.jar topic 2</code></pre>
</div>
</div>
<div class="paragraph">
<p>If a durable subscription did not exist, these messages would be lost, because no consumer on the topic is currently running.
However, the durable subscription is still active, and it retains the messages.</p>
</div>
</li>
<li>
<p>Run the <code>DurableConsumer</code> client again.
It immediately receives the messages that were sent while it was inactive:</p>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-shell hljs" data-lang="shell">Creating consumer for topic
Starting consumer
To end program, enter Q or q, then &lt;return&gt;
Reading message: This is message 1 from producer
Reading message: This is message 2 from producer
Message is not a TextMessage</code></pre>
</div>
</div>
</li>
<li>
<p>Enter <code>q</code> or <code>Q</code> to exit the program.</p>
</li>
</ol>
</div>
</div>
<div class="sect3">
<h4 id="_to_run_the_unsubscriber_example"><a class="anchor" href="#_to_run_the_unsubscriber_example"></a>To Run the unsubscriber Example</h4>
<div class="paragraph">
<p>After you have finished running the <code>DurableConsumer</code> client, run the <code>unsubscriber</code> example to unsubscribe from the durable subscription.</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>In a terminal window, go to the following directory:</p>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-asciidoc hljs" data-lang="asciidoc">tut-install/examples/jms/durablesubscriptionexample/unsubscriber</code></pre>
</div>
</div>
</li>
<li>
<p>To run the <code>Unsubscriber</code> client, enter the following command:</p>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-shell hljs" data-lang="shell">appclient -client target/unsubscriber.jar</code></pre>
</div>
</div>
<div class="paragraph">
<p>The client reports that it is unsubscribing from the durable subscription.</p>
</div>
</li>
</ol>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_using_local_transactions"><a class="anchor" href="#_using_local_transactions"></a>Using Local Transactions</h3>
<div class="paragraph">
<p>The <code>transactedexample</code> example demonstrates the use of local transactions in a Messaging client application.
It also demonstrates the use of the request/reply messaging pattern described in <a href="../jms-concepts/jms-concepts.html#<em>creating_temporary_destinations" class="xref page">Creating Temporary Destinations</a>, although it uses permanent rather than temporary destinations.
The example consists of three modules, <code>genericsupplier</code>, <code>retailer</code>, and <code>vendor</code>, which can be found under the <code>_tut-install</em>/examples/jms/transactedexample/</code> directory.
The source code can be found in the <code>src/main/java/ee.jakarta.tutorial</code> trees for each module.
The <code>genericsupplier</code> and <code>retailer</code> modules each contain a single class, <code>genericsupplier/GenericSupplier.java</code> and <code>retailer/Retailer.java</code>, respectively.
The <code>vendor</code> module is more complex, containing four classes: <code>vendor/Vendor.java</code>, <code>vendor/VendorMessageListener.java</code>, <code>vendor/Order.java</code>, and <code>vendor/SampleUtilities.java</code>.</p>
</div>
<div class="paragraph">
<p>The example shows how to use a queue and a topic in a single transaction as well as how to pass a <code>JMSContext</code> to a message listener&#8217;s constructor function.
The example represents a highly simplified e-commerce application in which the following actions occur.</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>A retailer (<code>retailer/src/main/java/ee/jakarta/tutorial/retailer/Retailer.java</code>) sends a <code>MapMessage</code> to a vendor order queue, ordering a quantity of computers, and waits for the vendor&#8217;s reply:</p>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">outMessage = context.createMapMessage();
outMessage.setString("Item", "Computer(s)");
outMessage.setInt("Quantity", quantity);
outMessage.setJMSReplyTo(retailerConfirmQueue);
context.createProducer().send(vendorOrderQueue, outMessage);
System.out.println("Retailer: ordered " + quantity + " computer(s)");
orderConfirmReceiver = context.createConsumer(retailerConfirmQueue);</code></pre>
</div>
</div>
</li>
<li>
<p>The vendor (<code>vendor/src/main/java/ee/jakarta/tutorial/retailer/Vendor.java</code>) receives the retailer&#8217;s order message and sends an order message to the supplier order topic in one transaction.
This Jakarta Messaging transaction uses a single session, so you can combine a receive from a queue with a send to a topic.
Here is the code that uses the same session to create a consumer for a queue:</p>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">vendorOrderReceiver = session.createConsumer(vendorOrderQueue);</code></pre>
</div>
</div>
<div class="paragraph">
<p>The following code receives the incoming message, sends an outgoing message, and commits the <code>JMSContext</code>.
The message processing has been removed to keep the sequence simple:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">inMessage = vendorOrderReceiver.receive();
// Process the incoming message and format the outgoing
// message
...
context.createProducer().send(supplierOrderTopic, orderMessage);
...
context.commit();</code></pre>
</div>
</div>
<div class="paragraph">
<p>For simplicity, there are only two suppliers, one for CPUs and one for hard drives.</p>
</div>
</li>
<li>
<p>Each supplier (<code>genericsupplier/src/main/java/ee/jakarta/tutorial/retailer/GenericSupplier.java</code>) receives the order from the order topic, checks its inventory, and then sends the items ordered to the queue named in the order message&#8217;s <code>JMSReplyTo</code> field.
If it does not have enough of the item in stock, the supplier sends what it has.
The synchronous receive from the topic and the send to the queue take place in one Jakarta Messaging transaction:</p>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">receiver = context.createConsumer(SupplierOrderTopic);
...
inMessage = receiver.receive();
if (inMessage instanceof MapMessage) {
    orderMessage = (MapMessage) inMessage;
} ...
// Process message
outMessage = context.createMapMessage();
// Add content to message
context.createProducer().send(
         (Queue) orderMessage.getJMSReplyTo(),
         outMessage);
// Display message contents
context.commit();</code></pre>
</div>
</div>
</li>
<li>
<p>The vendor receives the suppliers' replies from its confirmation queue and updates the state of the order.
Messages are processed by an asynchronous message listener, <code>VendorMessageListener</code>; this step shows the use of Jakarta Messaging transactions with a message listener:</p>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">MapMessage component = (MapMessage) message;
...
int orderNumber = component.getInt("VendorOrderNumber");
Order order = Order.getOrder(orderNumber).processSubOrder(component);
context.commit();</code></pre>
</div>
</div>
</li>
<li>
<p>When all outstanding replies are processed for a given order, the vendor message listener sends a message notifying the retailer whether it can fulfill the order:</p>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">Queue replyQueue = (Queue) order.order.getJMSReplyTo();
MapMessage retailerConfirmMessage = context.createMapMessage();
// Format the message
context.createProducer().send(replyQueue, retailerConfirmMessage);
context.commit();</code></pre>
</div>
</div>
</li>
<li>
<p>The retailer receives the message from the vendor:</p>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">inMessage = (MapMessage) orderConfirmReceiver.receive();</code></pre>
</div>
</div>
<div class="paragraph">
<p>The retailer then places a second order for twice as many computers as in the first order, so these steps are executed twice.</p>
</div>
</li>
</ol>
</div>
<div class="paragraph">
<p><a href="#_transactions_messaging_client_example">Figure 1, &#8220;Transactions: Messaging Client Example&#8221;</a> illustrates these steps.</p>
</div>
<div id="_transactions_messaging_client_example" class="imageblock">
<div class="content">
<img src="../../common/_images/jakartaeett_dt_034.svg" alt="Diagram of steps in transaction example">
</div>
<div class="title">Figure 1. Transactions: Messaging Client Example</div>
</div>
<div class="paragraph">
<p>All the messages use the <code>MapMessage</code> message type.
Synchronous receives are used for all message reception except when the vendor processes the replies of the suppliers.
These replies are processed asynchronously and demonstrate how to use transactions within a message listener.</p>
</div>
<div class="paragraph">
<p>At random intervals, the <code>Vendor</code> client throws an exception to simulate a database problem and cause a rollback.</p>
</div>
<div class="paragraph">
<p>All clients except <code>Retailer</code> use transacted contexts.</p>
</div>
<div class="paragraph">
<p>The example uses three queues named <code>jms/AQueue</code>, <code>jms/BQueue</code>, and <code>jms/CQueue</code>, and one topic named <code>jms/OTopic</code>.</p>
</div>
<div class="sect3">
<h4 id="_to_create_resources_for_the_transactedexample_example"><a class="anchor" href="#_to_create_resources_for_the_transactedexample_example"></a>To Create Resources for the transactedexample Example</h4>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Make sure that GlassFish Server has been started (see <a href="../../intro/usingexamples/usingexamples.html#_starting_and_stopping_glassfish_server" class="xref page">Starting and Stopping GlassFish Server</a>).</p>
</li>
<li>
<p>In a command window, go to the <code>genericsupplier</code> example:</p>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-shell hljs" data-lang="shell">cd tut-install/jms/transactedexample/genericsupplier</code></pre>
</div>
</div>
</li>
<li>
<p>Create the resources using the <code>asadmin add-resources</code> command:</p>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-shell hljs" data-lang="shell">asadmin add-resources src/main/setup/glassfish-resources.xml</code></pre>
</div>
</div>
</li>
<li>
<p>Verify the creation of the resources:</p>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-shell hljs" data-lang="shell">asadmin list-jms-resources</code></pre>
</div>
</div>
<div class="paragraph">
<p>In addition to the resources you created for the simple examples and the durable subscription example, the command lists the four new destinations:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-shell hljs" data-lang="shell">jms/MyQueue
jms/MyTopic
jms/AQueue
jms/BQueue
jms/CQueue
jms/OTopic
jms/__defaultConnectionFactory
jms/DurableConnectionFactory
Command list-jms-resources executed successfully.</code></pre>
</div>
</div>
</li>
</ol>
</div>
</div>
<div class="sect3">
<h4 id="_to_run_the_transactedexample_clients"><a class="anchor" href="#_to_run_the_transactedexample_clients"></a>To Run the transactedexample Clients</h4>
<div class="paragraph">
<p>You will need four terminal windows to run the clients.
Make sure that you start the clients in the correct order.</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>In a terminal window, go to the following directory:</p>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-asciidoc hljs" data-lang="asciidoc">tut-install/examples/jms/transactedexample/</code></pre>
</div>
</div>
</li>
<li>
<p>To build and package all the modules, enter the following command:</p>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-shell hljs" data-lang="shell">mvn install</code></pre>
</div>
</div>
</li>
<li>
<p>Go to the <code>genericsupplier</code> directory:</p>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-shell hljs" data-lang="shell">cd genericsupplier</code></pre>
</div>
</div>
</li>
<li>
<p>Use the following command to start the CPU supplier client:</p>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-shell hljs" data-lang="shell">appclient -client target/genericsupplier.jar CPU</code></pre>
</div>
</div>
<div class="paragraph">
<p>After some initial output, the client reports the following:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-shell hljs" data-lang="shell">Starting CPU supplier</code></pre>
</div>
</div>
</li>
<li>
<p>In a second terminal window, go to the <code>genericsupplier</code> directory:</p>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-shell hljs" data-lang="shell">cd tut-install/examples/jms/transactedexample/genericsupplier</code></pre>
</div>
</div>
</li>
<li>
<p>Use the following command to start the hard drive supplier client:</p>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-shell hljs" data-lang="shell">appclient -client target/genericsupplier.jar HD</code></pre>
</div>
</div>
<div class="paragraph">
<p>After some initial output, the client reports the following:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-shell hljs" data-lang="shell">Starting Hard Drive supplier</code></pre>
</div>
</div>
</li>
<li>
<p>In a third terminal window, go to the <code>vendor</code> directory:</p>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-shell hljs" data-lang="shell">cd tut-install/examples/jms/transactedexample/vendor</code></pre>
</div>
</div>
</li>
<li>
<p>Use the following command to start the <code>Vendor</code> client:</p>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-shell hljs" data-lang="shell">appclient -client target/vendor.jar</code></pre>
</div>
</div>
<div class="paragraph">
<p>After some initial output, the client reports the following:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-shell hljs" data-lang="shell">Starting vendor</code></pre>
</div>
</div>
</li>
<li>
<p>In another terminal window, go to the <code>retailer</code> directory:</p>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-shell hljs" data-lang="shell">cd tut-install/examples/jms/transactedexample/retailer</code></pre>
</div>
</div>
</li>
<li>
<p><a id="_transactedexample_step_10"></a> Use a command like the following to run the <code>Retailer</code> client.
The argument specifies the number of computers to order:</p>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-shell hljs" data-lang="shell">appclient -client target/retailer.jar 4</code></pre>
</div>
</div>
<div class="paragraph">
<p>After some initial output, the <code>Retailer</code> client reports something like the following.
In this case, the first order is filled, but the second is not:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-shell hljs" data-lang="shell">Retailer: Quantity to be ordered is 4
Retailer: Ordered 4 computer(s)
Retailer: Order filled
Retailer: Placing another order
Retailer: Ordered 8 computer(s)
Retailer: Order not filled</code></pre>
</div>
</div>
<div class="paragraph">
<p>The <code>Vendor</code> client reports something like the following, stating in this case that it is able to send all the computers in the first order, but not in the second:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-shell hljs" data-lang="shell">Vendor: Retailer ordered 4 Computer(s)
Vendor: Ordered 4 CPU(s) and hard drive(s)
  Vendor: Committed transaction 1
Vendor: Completed processing for order 1
Vendor: Sent 4 computer(s)
  Vendor: committed transaction 2
Vendor: Retailer ordered 8 Computer(s)
Vendor: Ordered 8 CPU(s) and hard drive(s)
  Vendor: Committed transaction 1
Vendor: Completed processing for order 2
Vendor: Unable to send 8 computer(s)
  Vendor: Committed transaction 2</code></pre>
</div>
</div>
<div class="paragraph">
<p>The CPU supplier reports something like the following.
In this case, it is able to send all the CPUs for both orders:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-shell hljs" data-lang="shell">CPU Supplier: Vendor ordered 4 CPU(s)
CPU Supplier: Sent 4 CPU(s)
  CPU Supplier: Committed transaction
CPU Supplier: Vendor ordered 8 CPU(s)
CPU Supplier: Sent 8 CPU(s)
  CPU Supplier: Committed transaction</code></pre>
</div>
</div>
<div class="paragraph">
<p>The hard drive supplier reports something like the following.
In this case, it has a shortage of hard drives for the second order:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-shell hljs" data-lang="shell">Hard Drive Supplier: Vendor ordered 4 Hard Drive(s)
Hard Drive Supplier: Sent 4 Hard Drive(s)
  Hard Drive Supplier: Committed transaction
Hard Drive Supplier: Vendor ordered 8 Hard Drive(s)
Hard Drive Supplier: Sent 1 Hard Drive(s)
  Hard Drive Supplier: Committed transaction</code></pre>
</div>
</div>
</li>
<li>
<p>Repeat <a href="#_transactedexample_step_10">Step 10</a> as many times as you wish.
Occasionally, the vendor will report an exception that causes a rollback:</p>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-shell hljs" data-lang="shell">Vendor: JMSException occurred: jakarta.jms.JMSException: Simulated
database concurrent access exception
  Vendor: Rolled back transaction 1</code></pre>
</div>
</div>
</li>
<li>
<p>After you finish running the clients, you can delete the destination resources by using the following commands:</p>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-shell hljs" data-lang="shell">asadmin delete-jms-resource jms/AQueue
asadmin delete-jms-resource jms/BQueue
asadmin delete-jms-resource jms/CQueue
asadmin delete-jms-resource jms/OTopic</code></pre>
</div>
</div>
</li>
</ol>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_writing_high_performance_and_scalable_jakarta_messaging_applications"><a class="anchor" href="#_writing_high_performance_and_scalable_jakarta_messaging_applications"></a>Writing High Performance and Scalable Jakarta Messaging Applications</h2>
<div class="sectionbody">
<div class="paragraph">
<p>This section describes how to use Jakarta Messaging to write applications that can handle high volumes of messages robustly.
These examples use both nondurable and durable shared consumers.</p>
</div>
<div class="sect2">
<h3 id="_using_shared_nondurable_subscriptions"><a class="anchor" href="#_using_shared_nondurable_subscriptions"></a>Using Shared Nondurable Subscriptions</h3>
<div class="paragraph">
<p>This section describes the receiving clients in an example that shows how to use a shared consumer to distribute messages sent to a topic among different consumers.
This section then explains how to compile and run the clients using GlassFish Server.</p>
</div>
<div class="paragraph">
<p>You may wish to compare this example to the results of <a href="#_running_multiple_consumers_on_the_same_destination">Running Multiple Consumers on the Same Destination</a> using an unshared consumer.
In that example, messages are distributed among the consumers on a queue, but each consumer on the topic receives all the messages because each consumer on the topic is using a separate topic subscription.</p>
</div>
<div class="paragraph">
<p>In this example, however, messages are distributed among multiple consumers on a topic, because all the consumers are sharing the same subscription.
Each message added to the topic subscription is received by only one consumer, similarly to the way in which each message added to a queue is received by only one consumer.</p>
</div>
<div class="paragraph">
<p>A topic may have multiple subscriptions.
Each message sent to the topic will be added to each topic subscription.
However, if there are multiple consumers on a particular subscription, each message added to that subscription will be delivered to only one of those consumers.</p>
</div>
<div class="sect3">
<h4 id="_writing_the_clients_for_the_shared_consumer_example"><a class="anchor" href="#_writing_the_clients_for_the_shared_consumer_example"></a>Writing the Clients for the Shared Consumer Example</h4>
<div class="paragraph">
<p>The sending client is <code>Producer.java</code>, the same client used in previous examples.</p>
</div>
<div class="paragraph">
<p>The receiving client is <code>SharedConsumer.java</code>.
It is very similar to <code>AsynchConsumer.java</code>, except that it always uses a topic.
It performs the following steps.</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Injects resources for a connection factory and topic.</p>
</li>
<li>
<p>In a <code>try-with-resources</code> block, creates a <code>JMSContext</code>.</p>
</li>
<li>
<p>Creates a consumer on a shared nondurable subscription, specifying a subscription name:</p>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">consumer = context.createSharedConsumer(topic, "SubName");</code></pre>
</div>
</div>
</li>
<li>
<p>Creates an instance of the <code>TextListener</code> class and registers it as the message listener for the shared consumer.</p>
</li>
<li>
<p>Listens for the messages published to the destination, stopping when the user types the character <code>q</code> or <code>Q</code>.</p>
</li>
<li>
<p>Catches and handles any exceptions.
The end of the <code>try-with-resources</code> block automatically causes the <code>JMSContext</code> to be closed.</p>
</li>
</ol>
</div>
<div class="paragraph">
<p>The <code>TextListener.java</code> class is identical to the one for the <code>asynchconsumer</code> example.</p>
</div>
<div class="paragraph">
<p>For this example, you will use the default connection factory and the topic you created in <a href="#_to_create_resources_for_the_simple_examples">To Create Resources for the Simple Examples</a>.</p>
</div>
</div>
<div class="sect3">
<h4 id="_to_run_the_sharedconsumer_and_producer_clients"><a class="anchor" href="#_to_run_the_sharedconsumer_and_producer_clients"></a>To Run the SharedConsumer and Producer Clients</h4>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Make sure that GlassFish Server has been started (see <a href="../../intro/usingexamples/usingexamples.html#_starting_and_stopping_glassfish_server" class="xref page">Starting and Stopping GlassFish Server</a>).</p>
</li>
<li>
<p>Open three command windows.
In the first, go to the <code>simple/producer/</code> directory:</p>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-shell hljs" data-lang="shell">cd tut-install/examples/jms/simple/producer/</code></pre>
</div>
</div>
</li>
<li>
<p>In the second and third command windows, go to the <code>shared/sharedconsumer/</code> directory:</p>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-shell hljs" data-lang="shell">cd tut-install/examples/jms/shared/sharedconsumer/</code></pre>
</div>
</div>
</li>
<li>
<p>In one of the <code>sharedconsumer</code> windows, build the example:</p>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-shell hljs" data-lang="shell">mvn install</code></pre>
</div>
</div>
</li>
<li>
<p>In each of the two <code>sharedconsumer</code> windows, start running the client.
You do not need to specify a <code>topic</code> argument:</p>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-shell hljs" data-lang="shell">appclient -client target/sharedconsumer.jar</code></pre>
</div>
</div>
<div class="paragraph">
<p>Wait until you see the following output in both windows:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-shell hljs" data-lang="shell">Waiting for messages on topic
To end program, enter Q or q, then &lt;return&gt;</code></pre>
</div>
</div>
</li>
<li>
<p>In the <code>producer</code> window, run the client, specifying the topic and a number of messages:</p>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-shell hljs" data-lang="shell">appclient -client target/producer.jar topic 20</code></pre>
</div>
</div>
<div class="paragraph">
<p>Each consumer client receives some of the messages.
Only one of the clients receives the non-text message that signals the end of the message stream.</p>
</div>
</li>
<li>
<p>Enter <code>Q</code> or <code>q</code> and press Return to stop each client and see a report of the number of text messages received.</p>
</li>
</ol>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_using_shared_durable_subscriptions"><a class="anchor" href="#_using_shared_durable_subscriptions"></a>Using Shared Durable Subscriptions</h3>
<div class="paragraph">
<p>The <code>shareddurableconsumer</code> client shows how to use shared durable subscriptions.
It shows how shared durable subscriptions combine the advantages of durable subscriptions (the subscription remains active when the client is not) with those of shared consumers (the message load can be divided among multiple clients).</p>
</div>
<div class="paragraph">
<p>The example is much more similar to the <code>sharedconsumer</code> example than to the <code>DurableConsumer.java</code> client.
It uses two classes, <code>SharedDurableConsumer.java</code> and <code>TextListener.java</code>, which can be found under the <code><em>tut-install</em>/examples/jms/shared/shareddurableconsumer/</code> directory.</p>
</div>
<div class="paragraph">
<p>The client uses <code>java:comp/DefaultJMSConnectionFactory</code>, the connection factory that does not have a client identifier, as is recommended for shared durable subscriptions.
It uses the <code>createSharedDurableConsumer</code> method with a subscription name to establish the subscription:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">consumer = context.createSharedDurableConsumer(topic, "MakeItLast");</code></pre>
</div>
</div>
<div class="paragraph">
<p>You run the example in combination with the <code>Producer.java</code> client.</p>
</div>
<div class="sect3">
<h4 id="_to_run_the_shareddurableconsumer_and_producer_clients"><a class="anchor" href="#_to_run_the_shareddurableconsumer_and_producer_clients"></a>To Run the SharedDurableConsumer and Producer Clients</h4>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>In a terminal window, go to the following directory:</p>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-asciidoc hljs" data-lang="asciidoc">tut-install/examples/jms/shared/shareddurableconsumer</code></pre>
</div>
</div>
</li>
<li>
<p>To compile and package the client, enter the following command:</p>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-shell hljs" data-lang="shell">mvn install</code></pre>
</div>
</div>
</li>
<li>
<p>Run the client first to establish the durable subscription:</p>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-shell hljs" data-lang="shell">appclient -client target/shareddurableconsumer.jar</code></pre>
</div>
</div>
</li>
<li>
<p>The client displays the following and pauses:</p>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-shell hljs" data-lang="shell">Waiting for messages on topic
To end program, enter Q or q, then &lt;return&gt;</code></pre>
</div>
</div>
</li>
<li>
<p>In the <code>shareddurableconsumer</code> window, enter <code>q</code> or <code>Q</code> to exit the program.
The subscription remains active, although the client is not running.</p>
</li>
<li>
<p>Open another terminal window and go to the <code>producer</code> example directory:</p>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-shell hljs" data-lang="shell">cd tut-install/examples/jms/simple/producer</code></pre>
</div>
</div>
</li>
<li>
<p>Run the <code>producer</code> example, sending a number of messages to the topic:</p>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-shell hljs" data-lang="shell">appclient -client target/producer.jar topic 6</code></pre>
</div>
</div>
</li>
<li>
<p>After the producer has sent the messages, open a third terminal window and go to the <code>shareddurableconsumer</code> directory.</p>
</li>
<li>
<p>Run the client in both the first and third terminal windows.
Whichever client starts first will receive all the messages that were sent when there was no active subscriber:</p>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-shell hljs" data-lang="shell">appclient -client target/shareddurableconsumer.jar</code></pre>
</div>
</div>
</li>
<li>
<p>With both <code>shareddurableconsumer</code> clients still running, go to the <code>producer</code> window and send a larger number of messages to the topic:</p>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-shell hljs" data-lang="shell">appclient -client target/producer.jar topic 25</code></pre>
</div>
</div>
<div class="paragraph">
<p>Now the messages will be shared by the two consumer clients.
If you continue sending groups of messages to the topic, each client receives some of the messages.
If you exit one of the clients and send more messages, the other client will receive all the messages.</p>
</div>
</li>
</ol>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_sending_and_receiving_messages_using_a_simple_web_application"><a class="anchor" href="#_sending_and_receiving_messages_using_a_simple_web_application"></a>Sending and Receiving Messages Using a Simple Web Application</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Web applications can use Jakarta Messaging to send and receive messages, as noted in <a href="../jms-concepts/jms-concepts.html#_using_jakarta_ee_components_to_produce_and_to_synchronously_receive_messages" class="xref page">Using Jakarta EE Components to Produce and to Synchronously Receive Messages</a>. This section describes the components of a very simple web application that uses Jakarta Messaging.</p>
</div>
<div class="paragraph">
<p>This section assumes that you are familiar with the basics of Jakarta Faces technology, described in the <a href="../../web/faces-intro/faces-intro.html#_introduction_to_jakarta_faces_technology" class="xref page">Introduction to Jakarta Faces Technology</a></p>
</div>
<div class="paragraph">
<p>The example, <code>websimplemessage</code>, is under the <code><em>tut-install</em>/jms/examples/</code> directory.
It uses sending and receiving Facelets pages as well as corresponding backing beans.
When a user enters a message in the text field of the sending page and clicks a button, the backing bean for the page sends the message to a queue and displays it on the page.
When the user goes to the receiving page and clicks another button, the backing bean for that page receives the message synchronously and displays it.</p>
</div>
<div class="imageblock">
<div class="content">
<img src="../../common/_images/jakartaeett_dt_035.svg" alt="Diagram showing a web application in which a managed bean sends a message to a queue, and another managed bean receives the message from the queue.">
</div>
<div class="title">Figure 2. The websimplemessage Application</div>
</div>
<div class="sect2">
<h3 id="_the_websimplemessage_facelets_pages"><a class="anchor" href="#_the_websimplemessage_facelets_pages"></a>The websimplemessage Facelets Pages</h3>
<div class="paragraph">
<p>The Facelets pages for the example are as follows.</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>sender.xhtml</code>, which provides a labeled <code>h:InputText</code> tag where the user enters the message, along with two command buttons.
When the user clicks the Send Message button, the <code>senderBean.sendMessage</code> method is called to send the message to the queue and display its contents.
When the user clicks the Go to Receive Page button, the <code>receiver.xhtml</code> page appears.</p>
</li>
<li>
<p><code>receiver.xhtml</code>, which also provides two command buttons.
When the user clicks the Receive Message button, the <code>receiverBean.getMessage</code> method is called to fetch the message from the queue and display its contents.
When the user clicks the Send Another Message button, the sender.xhtml page appears again.</p>
</li>
</ul>
</div>
</div>
<div class="sect2">
<h3 id="_the_websimplemessage_managed_beans"><a class="anchor" href="#_the_websimplemessage_managed_beans"></a>The websimplemessage Managed Beans</h3>
<div class="paragraph">
<p>The two managed beans for the example are as follows.</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>SenderBean.java</code>, a CDI managed bean with one property, <code>messageText</code>, and one business method, <code>sendMessage</code>.
The class is annotated with <code>@JMSDestinationDefinition</code> to create a component-private queue:</p>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">@JMSDestinationDefinition(
        name = "java:comp/jms/webappQueue",
        interfaceName = "jakarta.jms.Queue",
        destinationName = "PhysicalWebappQueue")
@Named
@RequestScoped
public class SenderBean { ... }</code></pre>
</div>
</div>
<div class="paragraph">
<p>The <code>sendMessage</code> method injects a <code>JMSContext</code> (using the default connection factory) and the queue, creates a producer, sends the message the user typed on the Facelets page, and creates a <code>FacesMessage</code> to display on the Facelets page:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">@Inject
private JMSContext context;
@Resource(lookup = "java:comp/jms/webappQueue")
private Queue queue;
private String messageText;
...
public void sendMessage() {
    try {
        String text = "Message from producer: " + messageText;
        context.createProducer().send(queue, text);

        FacesMessage facesMessage =
                new FacesMessage("Sent message: " + text);
        FacesContext.getCurrentInstance().addMessage(null, facesMessage);
    } catch (Throwable t) {
        logger.log(Level.SEVERE,
                "SenderBean.sendMessage: Exception: {0}",
                t.toString());
    }
}</code></pre>
</div>
</div>
</li>
<li>
<p><code>ReceiverBean.java</code>, a CDI managed bean with one business method, <code>getMessage</code>.
The method injects a <code>JMSContext</code> (using the default connection factory) and the queue that was defined in <code>SenderBean</code>, creates a consumer, receives the message, and creates a <code>FacesMessage</code> to display on the Facelets page:</p>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">@Inject
private JMSContext context;
@Resource(lookup = "java:comp/jms/webappQueue")
private Queue queue;
...
public void getMessage() {
    try {
        JMSConsumer receiver = context.createConsumer(queue);
        String text = receiver.receiveBody(String.class);

        if (text != null) {
            FacesMessage facesMessage =
                    new FacesMessage("Reading message: " + text);
            FacesContext.getCurrentInstance().addMessage(null, facesMessage);
        } else {
            FacesMessage facesMessage =
                    new FacesMessage("No message received after 1 second");
            FacesContext.getCurrentInstance().addMessage(null, facesMessage);
        }
    } catch (Throwable t) {
        logger.log(Level.SEVERE,
                "ReceiverBean.getMessage: Exception: {0}",
                t.toString());
    }
}</code></pre>
</div>
</div>
</li>
</ul>
</div>
</div>
<div class="sect2">
<h3 id="_running_the_websimplemessage_example"><a class="anchor" href="#_running_the_websimplemessage_example"></a>Running the websimplemessage Example</h3>
<div class="paragraph">
<p>You can use either NetBeans IDE or Maven to build, package, deploy, and run the <code>websimplemessage</code> application.</p>
</div>
<div class="sect3">
<h4 id="_creating_resources_for_the_websimplemessage_example"><a class="anchor" href="#_creating_resources_for_the_websimplemessage_example"></a>Creating Resources for the websimplemessage Example</h4>
<div class="paragraph">
<p>This example uses an annotation-defined queue and the preconfigured default connection factory <code>java:comp/DefaultJMSConnectionFactory</code>.</p>
</div>
</div>
<div class="sect3">
<h4 id="_to_package_and_deploy_websimplemessage_using_netbeans_ide"><a class="anchor" href="#_to_package_and_deploy_websimplemessage_using_netbeans_ide"></a>To Package and Deploy websimplemessage Using NetBeans IDE</h4>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Make sure that GlassFish Server has been started (see <a href="../../intro/usingexamples/usingexamples.html#_starting_and_stopping_glassfish_server" class="xref page">Starting and Stopping GlassFish Server</a>).</p>
</li>
<li>
<p>From the <strong>File</strong> menu, choose <strong>Open Project</strong>.</p>
</li>
<li>
<p>In the <strong>Open Project</strong> dialog box, navigate to:</p>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-asciidoc hljs" data-lang="asciidoc">tut-install/examples/jms</code></pre>
</div>
</div>
</li>
<li>
<p>Select the <code>websimplemessage</code> folder.</p>
</li>
<li>
<p>Click <strong>Open Project</strong>.</p>
</li>
<li>
<p>In the <strong>Projects</strong> tab, right-click the <code>websimplemessage</code> project and select <strong>Build</strong>.</p>
<div class="paragraph">
<p>This command builds and deploys the project.</p>
</div>
</li>
</ol>
</div>
</div>
<div class="sect3">
<h4 id="_to_package_and_deploy_websimplemessage_using_maven"><a class="anchor" href="#_to_package_and_deploy_websimplemessage_using_maven"></a>To Package and Deploy websimplemessage Using Maven</h4>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Make sure that GlassFish Server has been started (see <a href="../../intro/usingexamples/usingexamples.html#_starting_and_stopping_glassfish_server" class="xref page">Starting and Stopping GlassFish Server</a>).</p>
</li>
<li>
<p>In a terminal window, go to:</p>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-asciidoc hljs" data-lang="asciidoc">tut-install/examples/jms/websimplemessage/</code></pre>
</div>
</div>
</li>
<li>
<p>To compile the source files and package and deploy the application, use the following command:</p>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-shell hljs" data-lang="shell">mvn install</code></pre>
</div>
</div>
</li>
</ol>
</div>
</div>
<div class="sect3">
<h4 id="_to_run_the_websimplemessage_example"><a class="anchor" href="#_to_run_the_websimplemessage_example"></a>To Run the websimplemessage Example</h4>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>In a web browser, enter the following URL:</p>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-asciidoc hljs" data-lang="asciidoc">http://localhost:8080/websimplemessage</code></pre>
</div>
</div>
</li>
<li>
<p>Enter a message in the text field and click Send Message.</p>
<div class="paragraph">
<p>If, for example, you enter "Hello, Duke", the following appears below the buttons:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-asciidoc hljs" data-lang="asciidoc">Sent message: Message from producer: Hello, Duke</code></pre>
</div>
</div>
</li>
<li>
<p>Click Go to Receive Page.</p>
</li>
<li>
<p>Click Receive Message.</p>
<div class="paragraph">
<p>The following appears below the buttons:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-asciidoc hljs" data-lang="asciidoc">Reading message: Message from producer: Hello, Duke</code></pre>
</div>
</div>
</li>
<li>
<p>Click Send Another Message to return to the sending page.</p>
</li>
<li>
<p>After you have finished running the application, undeploy it using either the Services tab of NetBeans IDE or the <code>mvn cargo:undeploy</code> command.</p>
</li>
</ol>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_receiving_messages_asynchronously_using_a_message_driven_bean"><a class="anchor" href="#_receiving_messages_asynchronously_using_a_message_driven_bean"></a>Receiving Messages Asynchronously Using a Message-Driven Bean</h2>
<div class="sectionbody">
<div class="paragraph">
<p>If you are writing an application to run in the Jakarta EE application client container or on the Java SE platform, and you want to receive messages asynchronously, you need to define a class that implements the <code>MessageListener</code> interface, create a <code>JMSConsumer</code>, and call the method <code>setMessageListener</code>.</p>
</div>
<div class="paragraph">
<p>If you&#8217;re writing an application to run in the Jakarta EE web or enterprise bean container and want it to receive messages asynchronously, you also need to need to define a class that implements the <code>MessageListener</code> interface.
However, instead of creating a <code>JMSConsumer</code> and calling the method <code>setMessageListener</code>, you must configure your message listener class to be a message-driven bean.
The application server will then take care of the rest.</p>
</div>
<div class="paragraph">
<p>Message-driven beans can implement any messaging type.
Most commonly, however, they implement the Jakarta Messaging technology.</p>
</div>
<div class="paragraph">
<p>This section describes a simple message-driven bean example.
Before proceeding, you should read the basic conceptual information in the section <a href="../../entbeans/ejb-intro/ejb-intro.html#_what_is_a_message_driven_bean" class="xref page">What Is a Message-Driven Bean?</a> as well as <a href="../jms-concepts/jms-concepts.html#_using_message_driven_beans_to_receive_messages_asynchronously" class="xref page">Using Message-Driven Beans to Receive Messages Asynchronously</a>.</p>
</div>
<div class="sect2">
<h3 id="_overview_of_the_simplemessage_example"><a class="anchor" href="#_overview_of_the_simplemessage_example"></a>Overview of the simplemessage Example</h3>
<div class="paragraph">
<p>The <code>simplemessage</code> application has the following components:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>SimpleMessageClient</code>: An application client that sends several messages to a queue</p>
</li>
<li>
<p><code>SimpleMessageBean</code>: A message-driven bean that asynchronously processes the messages that are sent to the queue</p>
</li>
</ul>
</div>
<div class="paragraph">
<p><a href="#_the_simplemessage_application">Figure 3, &#8220;The simplemessage Application&#8221;</a> illustrates the structure of this application.
The application client sends messages to the queue, which was created administratively using the Administration Console.
The Messaging provider (in this case, GlassFish Server) delivers the messages to the instances of the message-driven bean, which then processes the messages.</p>
</div>
<div id="_the_simplemessage_application" class="imageblock">
<div class="content">
<img src="../../common/_images/jakartaeett_dt_036.svg" alt="Diagram of application showing an application client sending a message to a queue, and the message being delivered to a message-driven bean">
</div>
<div class="title">Figure 3. The simplemessage Application</div>
</div>
<div class="paragraph">
<p>The source code for this application is in the <code><em>tut-install</em>/examples/jms/simplemessage/</code> directory.</p>
</div>
</div>
<div class="sect2">
<h3 id="_the_simplemessage_application_client"><a class="anchor" href="#_the_simplemessage_application_client"></a>The simplemessage Application Client</h3>
<div class="paragraph">
<p>The <code>SimpleMessageClient</code> sends messages to the queue that the <code>SimpleMessageBean</code> listens to.
The client starts by injecting the connection factory and queue resources:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">@Resource(lookup = "java:comp/DefaultJMSConnectionFactory")
private static ConnectionFactory connectionFactory;

@Resource(lookup = "jms/MyQueue")
private static Queue queue;</code></pre>
</div>
</div>
<div class="paragraph">
<p>Next, the client creates the <code>JMSContext</code> in a <code>try-with-resources</code> block:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">String text;
final int NUM_MSGS = 3;

try (JMSContext context = connectionFactory.createContext();) { ... }</code></pre>
</div>
</div>
<div class="paragraph">
<p>Finally, the client sends several text messages to the queue:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">for (int i = 0; i &lt; NUM_MSGS; i++) {
    text = "This is message " + (i + 1);
    System.out.println("Sending message: " + text);
    context.createProducer().send(queue, text);
}</code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_the_simplemessage_message_driven_bean_class"><a class="anchor" href="#_the_simplemessage_message_driven_bean_class"></a>The simplemessage Message-Driven Bean Class</h3>
<div class="paragraph">
<p>The code for the <code>SimpleMessageBean</code> class illustrates the requirements of a message-driven bean class described in <a href="../jms-concepts/jms-concepts.html#_using_message_driven_beans_to_receive_messages_asynchronously" class="xref page">Using Message-Driven Beans to Receive Messages Asynchronously</a>.</p>
</div>
<div class="paragraph">
<p>The first few lines of the <code>SimpleMessageBean</code> class use the <code>@MessageDriven</code> annotation&#8217;s <code>activationConfig</code> attribute to specify configuration properties:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">@MessageDriven(activationConfig = {
    @ActivationConfigProperty(propertyName = "destinationLookup",
            propertyValue = "jms/MyQueue"),
    @ActivationConfigProperty(propertyName = "destinationType",
            propertyValue = "jakarta.jms.Queue")
})</code></pre>
</div>
</div>
<div class="paragraph">
<p>See <a href="../jms-concepts/jms-concepts.html#_activationconfigproperty_settings_for_message_driven_beans" class="xref page">null</a> for a list of the available properties.</p>
</div>
<div class="paragraph">
<p>See <a href="#_sending_messages_from_a_session_bean_to_an_mdb">Sending Messages from a Session Bean to an MDB</a> for examples of the <code>subscriptionDurability</code>, <code>clientId</code>, <code>subscriptionName</code>, and <code>messageSelector</code> properties.</p>
</div>
<div class="sect3">
<h4 id="_the_onmessage_method"><a class="anchor" href="#_the_onmessage_method"></a>The onMessage Method</h4>
<div class="paragraph">
<p>When the queue receives a message, the enterprise bean container invokes the message listener method or methods.
For a bean that uses Jakarta Messaging, this is the <code>onMessage</code> method of the <code>MessageListener</code> interface.</p>
</div>
<div class="paragraph">
<p>In the <code>SimpleMessageBean</code> class, the <code>onMessage</code> method casts the incoming message to a <code>TextMessage</code> and displays the text:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">public void onMessage(Message inMessage) {

    try {
        if (inMessage instanceof TextMessage) {
            logger.log(Level.INFO,
                    "MESSAGE BEAN: Message received: {0}",
                    inMessage.getBody(String.class));
        } else {
            logger.log(Level.WARNING,
                    "Message of wrong type: {0}",
                    inMessage.getClass().getName());
        }
    } catch (JMSException e) {
        logger.log(Level.SEVERE,
                "SimpleMessageBean.onMessage: JMSException: {0}",
                e.toString());
        mdc.setRollbackOnly();
    }
}</code></pre>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_running_the_simplemessage_example"><a class="anchor" href="#_running_the_simplemessage_example"></a>Running the simplemessage Example</h3>
<div class="paragraph">
<p>You can use either NetBeans IDE or Maven to build, deploy, and run the <code>simplemessage</code> example.</p>
</div>
<div class="sect3">
<h4 id="_creating_resources_for_the_simplemessage_example"><a class="anchor" href="#_creating_resources_for_the_simplemessage_example"></a>Creating Resources for the simplemessage Example</h4>
<div class="paragraph">
<p>This example uses the queue named <code>jms/MyQueue</code> and the preconfigured default connection factory <code>java:comp/DefaultJMSConnectionFactory</code>.</p>
</div>
<div class="paragraph">
<p>If you have run the simple Jakarta Messaging examples in <a href="#_writing_simple_jakarta_messaging_applications">Writing Simple Jakarta Messaging Applications</a> and have not deleted the resources, you already have the queue.
Otherwise, follow the instructions in <a href="#_to_create_resources_for_the_simple_examples">To Create Resources for the Simple Examples</a> to create it.</p>
</div>
<div class="paragraph">
<p>For more information on creating Messaging resources, see <a href="#_creating_jakarta_messaging_administered_objects">Creating Jakarta Messaging Administered Objects</a>.</p>
</div>
</div>
<div class="sect3">
<h4 id="_to_run_the_simplemessage_example_using_netbeans_ide"><a class="anchor" href="#_to_run_the_simplemessage_example_using_netbeans_ide"></a>To Run the simplemessage Example Using NetBeans IDE</h4>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Make sure that GlassFish Server has been started (see <a href="../../intro/usingexamples/usingexamples.html#_starting_and_stopping_glassfish_server" class="xref page">Starting and Stopping GlassFish Server</a>).</p>
</li>
<li>
<p>From the <strong>File</strong> menu, choose <strong>Open Project</strong>.</p>
</li>
<li>
<p>In the <strong>Open Project</strong> dialog box, navigate to:</p>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-asciidoc hljs" data-lang="asciidoc">tut-install/examples/jms/simplemessage</code></pre>
</div>
</div>
</li>
<li>
<p>Select the <code>simplemessage</code> folder.</p>
</li>
<li>
<p>Make sure that the <strong>Open Required Projects</strong> check box is selected, then click <strong>Open Project</strong>.</p>
</li>
<li>
<p>In the <strong>Projects</strong> tab, right-click the <code>simplemessage</code> project and select <strong>Build</strong>.
(If NetBeans IDE suggests that you run a priming build, click the box to do so.)</p>
<div class="paragraph">
<p>This command packages the application client and the message-driven bean, then creates a file named <code>simplemessage.ear</code> in the <code>simplemessage-ear/target/</code> directory.
It then deploys the <code>simplemessage-ear</code> module, retrieves the client stubs, and runs the application client.</p>
</div>
<div class="paragraph">
<p>The output in the output window looks like this (preceded by application client container output):</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-asciidoc hljs" data-lang="asciidoc">Sending message: This is message 1
Sending message: This is message 2
Sending message: This is message 3
To see if the bean received the messages,
 check &lt;install_dir&gt;/domains/domain1/logs/server.log.</code></pre>
</div>
</div>
<div class="paragraph">
<p>In the server log file, lines similar to the following appear:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-asciidoc hljs" data-lang="asciidoc">MESSAGE BEAN: Message received: This is message 1
MESSAGE BEAN: Message received: This is message 2
MESSAGE BEAN: Message received: This is message 3</code></pre>
</div>
</div>
<div class="paragraph">
<p>The received messages may appear in a different order from the order in which they were sent.</p>
</div>
</li>
<li>
<p>After you have finished running the application, undeploy it using the <strong>Services</strong> tab.</p>
</li>
</ol>
</div>
</div>
<div class="sect3">
<h4 id="_to_run_the_simplemessage_example_using_maven"><a class="anchor" href="#_to_run_the_simplemessage_example_using_maven"></a>To Run the simplemessage Example Using Maven</h4>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Make sure that GlassFish Server has been started (see <a href="../../intro/usingexamples/usingexamples.html#_starting_and_stopping_glassfish_server" class="xref page">Starting and Stopping GlassFish Server</a>).</p>
</li>
<li>
<p>In a terminal window, go to:</p>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-asciidoc hljs" data-lang="asciidoc">tut-install/examples/jms/simplemessage/</code></pre>
</div>
</div>
</li>
<li>
<p>To compile the source files and package the application, use the following command:</p>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-shell hljs" data-lang="shell">mvn install</code></pre>
</div>
</div>
<div class="paragraph">
<p>This target packages the application client and the message-driven bean, then creates a file named <code>simplemessage.ear</code> in the <code>simplemessage-ear/target/</code> directory.
It then deploys the <code>simplemessage-ear</code> module, retrieves the client stubs, and runs the application client.</p>
</div>
<div class="paragraph">
<p>The output in the terminal window looks like this (preceded by application client container output):</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-asciidoc hljs" data-lang="asciidoc">Sending message: This is message 1
Sending message: This is message 2
Sending message: This is message 3
To see if the bean received the messages,
 check &lt;install_dir&gt;/domains/domain1/logs/server.log.</code></pre>
</div>
</div>
<div class="paragraph">
<p>In the server log file, lines similar to the following appear:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-asciidoc hljs" data-lang="asciidoc">MESSAGE BEAN: Message received: This is message 1
MESSAGE BEAN: Message received: This is message 2
MESSAGE BEAN: Message received: This is message 3</code></pre>
</div>
</div>
<div class="paragraph">
<p>The received messages may appear in a different order from the order in which they were sent.</p>
</div>
</li>
<li>
<p>After you have finished running the application, undeploy it using the <code>mvn cargo:undeploy</code> command.</p>
</li>
</ol>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_sending_messages_from_a_session_bean_to_an_mdb"><a class="anchor" href="#_sending_messages_from_a_session_bean_to_an_mdb"></a>Sending Messages from a Session Bean to an MDB</h2>
<div class="sectionbody">
<div class="paragraph">
<p>This section explains how to write, compile, package, deploy, and run an application that uses Jakarta Messaging in conjunction with a session bean.
The application contains the following components:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>An application client that invokes a session bean</p>
</li>
<li>
<p>A session bean that publishes several messages to a topic</p>
</li>
<li>
<p>A message-driven bean that receives and processes the messages using a durable topic subscription and a message selector</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>You will find the source files for this section in the <code><em>tut-install</em>/examples/jms/clientsessionmdb/</code> directory.
Path names in this section are relative to this directory.</p>
</div>
<div class="sect2">
<h3 id="_writing_the_application_components_for_the_clientsessionmdb_example"><a class="anchor" href="#_writing_the_application_components_for_the_clientsessionmdb_example"></a>Writing the Application Components for the clientsessionmdb Example</h3>
<div class="paragraph">
<p>This application demonstrates how to send messages from an enterprise bean (in this case, a session bean) rather than from an application client, as in the example in <a href="#_receiving_messages_asynchronously_using_a_message_driven_bean">Receiving Messages Asynchronously Using a Message-Driven Bean</a>.
<a href="#_an_enterprise_bean_application_client_to_session_bean_to_message_driven_bean">Figure 4, &#8220;An Enterprise Bean Application: Client to Session Bean to Message-Driven Bean&#8221;</a> illustrates the structure of this application.
Sending messages from an enterprise bean is very similar to sending messages from a managed bean, which was shown in <a href="#_sending_and_receiving_messages_using_a_simple_web_application">Sending and Receiving Messages Using a Simple Web Application</a>.</p>
</div>
<div id="_an_enterprise_bean_application_client_to_session_bean_to_message_driven_bean" class="imageblock">
<div class="content">
<img src="../../common/_images/jakartaeett_dt_037.svg" alt="Diagram of application showing an application client calling a session bean, which sends messages that are processed by a message-driven bean">
</div>
<div class="title">Figure 4. An Enterprise Bean Application: Client to Session Bean to Message-Driven Bean</div>
</div>
<div class="paragraph">
<p>The Publisher enterprise bean in this example is the enterprise-application equivalent of a wire-service news feed that categorizes news events into six news categories.
The message-driven bean could represent a newsroom, where the sports desk, for example, would set up a subscription for all news events pertaining to sports.</p>
</div>
<div class="paragraph">
<p>The application client in the example injects the Publisher enterprise bean&#8217;s remote home interface and then calls the bean&#8217;s business method.
The enterprise bean creates 18 text messages.
For each message, it sets a <code>String</code> property randomly to one of six values representing the news categories and then publishes the message to a topic.
The message-driven bean uses a message selector for the property to limit which of the published messages will be delivered to it.</p>
</div>
<div class="sect3">
<h4 id="_coding_the_application_client_myappclient_java"><a class="anchor" href="#_coding_the_application_client_myappclient_java"></a>Coding the Application Client: MyAppClient.java</h4>
<div class="paragraph">
<p>The application client, <code>MyAppClient.java</code>, found under <code>clientsessionmdb-app-client</code>, performs no Messaging operations and so is simpler than the client in <a href="#_receiving_messages_asynchronously_using_a_message_driven_bean">Receiving Messages Asynchronously Using a Message-Driven Bean</a>.
The client uses dependency injection to obtain the Publisher enterprise bean&#8217;s business interface:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">@EJB(name="PublisherRemote")
private static PublisherRemote publisher;</code></pre>
</div>
</div>
<div class="paragraph">
<p>The client then calls the bean&#8217;s business method twice.</p>
</div>
</div>
<div class="sect3">
<h4 id="_coding_the_publisher_session_bean"><a class="anchor" href="#_coding_the_publisher_session_bean"></a>Coding the Publisher Session Bean</h4>
<div class="paragraph">
<p>The Publisher bean is a stateless session bean that has one business method.
The Publisher bean uses a remote interface rather than a local interface because it is accessed from the application client.</p>
</div>
<div class="paragraph">
<p>The remote interface, <code>PublisherRemote.java</code>, found under <code>clientsessionmdb-ejb</code>, declares a single business method, <code>publishNews</code>.</p>
</div>
<div class="paragraph">
<p>The bean class, <code>PublisherBean.java</code>, also found under <code>clientsessionmdb-ejb</code>, implements the <code>publishNews</code> method and its helper method <code>chooseType</code>.
The bean class injects <code>SessionContext</code> and <code>Topic</code> resources (the topic is defined in the message-driven bean).
It then injects a <code>JMSContext</code>, which uses the preconfigured default connection factory unless you specify otherwise.
The bean class begins as follows:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">@Stateless
@Remote({
    PublisherRemote.class
})
public class PublisherBean implements PublisherRemote {

    @Resource
    private SessionContext sc;
    @Resource(lookup = "java:module/jms/newsTopic")
    private Topic topic;
    @Inject
    private JMSContext context;
    ...
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>The business method <code>publishNews</code> creates a <code>JMSProducer</code> and publishes the messages.</p>
</div>
</div>
<div class="sect3">
<h4 id="_coding_the_message_driven_bean_messagebean_java"><a class="anchor" href="#_coding_the_message_driven_bean_messagebean_java"></a>Coding the Message-Driven Bean: MessageBean.java</h4>
<div class="paragraph">
<p>The message-driven bean class, <code>MessageBean.java</code>, found under <code>clientsessionmdb-ejb</code>, is almost identical to the one in <a href="#_receiving_messages_asynchronously_using_a_message_driven_bean">Receiving Messages Asynchronously Using a Message-Driven Bean</a>.
However, the <code>@MessageDriven</code> annotation is different, because instead of a queue, the bean is using a topic, a durable subscription, and a message selector.
The bean defines a topic for the use of the application; the definition uses the <code>java:module</code> scope because both the session bean and the message-driven bean are in the same module.
Because the destination is defined in the message-driven bean, the <code>@MessageDriven</code> annotation uses the <code>destinationLookup</code> activation config property.
(See <a href="../jms-concepts/jms-concepts.html#_creating_resources_for_jakarta_ee_applications" class="xref page">Creating Resources for Jakarta EE Applications</a> for more information.)
The annotation also sets the activation config properties <code>messageSelector</code>, <code>subscriptionDurability</code>, <code>clientId</code>, and <code>subscriptionName</code>, as follows:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">@JMSDestinationDefinition(
        name = "java:module/jms/newsTopic",
        interfaceName = "jakarta.jms.Topic",
        destinationName = "PhysicalNewsTopic")
@MessageDriven(activationConfig = {
    @ActivationConfigProperty(propertyName = "destinationLookup",
            propertyValue = "java:module/jms/newsTopic"),
    @ActivationConfigProperty(propertyName = "destinationType",
            propertyValue = "jakarta.jms.Topic"),
    @ActivationConfigProperty(propertyName = "messageSelector",
            propertyValue = "NewsType = 'Sports' OR NewsType = 'Opinion'"),
    @ActivationConfigProperty(propertyName = "subscriptionDurability",
            propertyValue = "Durable"),
    @ActivationConfigProperty(propertyName = "clientId",
            propertyValue = "MyID"),
    @ActivationConfigProperty(propertyName = "subscriptionName",
            propertyValue = "MySub")
})</code></pre>
</div>
</div>
<div class="paragraph">
<p>The topic is the one defined in the <code>PublisherBean</code>.
The message selector in this case represents both the sports and opinion desks, just to demonstrate the syntax of message selectors.</p>
</div>
<div class="paragraph">
<p>The Jakarta Messaging resource adapter uses these properties to create a connection factory for the message-driven bean that allows the bean to use a durable subscription.</p>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_running_the_clientsessionmdb_example"><a class="anchor" href="#_running_the_clientsessionmdb_example"></a>Running the clientsessionmdb Example</h3>
<div class="paragraph">
<p>You can use either NetBeans IDE or Maven to build, deploy, and run the <code>simplemessage</code> example.</p>
</div>
<div class="paragraph">
<p>This example uses an annotation-defined topic and the preconfigured default connection factory <code>java:comp/DefaultJMSConnectionFactory</code>, so you do not have to create resources for it.</p>
</div>
<div class="sect3">
<h4 id="_to_run_clientsessionmdb_using_netbeans_ide"><a class="anchor" href="#_to_run_clientsessionmdb_using_netbeans_ide"></a>To Run clientsessionmdb Using NetBeans IDE</h4>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Make sure that GlassFish Server has been started (see <a href="../../intro/usingexamples/usingexamples.html#_starting_and_stopping_glassfish_server" class="xref page">Starting and Stopping GlassFish Server</a>).</p>
</li>
<li>
<p>From the <strong>File</strong> menu, choose <strong>Open Project</strong>.</p>
</li>
<li>
<p>In the <strong>Open Project</strong> dialog box, navigate to:</p>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-asciidoc hljs" data-lang="asciidoc">tut-install/examples/jms/clientsessionmdb</code></pre>
</div>
</div>
</li>
<li>
<p>Select the <code>clientsessionmdb</code> folder.</p>
</li>
<li>
<p>Make sure that the <strong>Open Required Projects</strong> check box is selected, then click <strong>Open Project</strong>.</p>
</li>
<li>
<p>In the <strong>Projects</strong> tab, right-click the <code>clientsessionmdb</code> project and select <strong>Build</strong>.
(If NetBeans IDE suggests that you run a priming build, click the box to do so.)</p>
<div class="paragraph">
<p>This command creates the following:</p>
</div>
<div class="olist loweralpha">
<ol class="loweralpha" type="a">
<li>
<p>An application client JAR file that contains the client class file and the session bean&#8217;s remote interface, along with a manifest file that specifies the main class and places the Jakarta Enterprise Beans JAR file in its classpath</p>
</li>
<li>
<p>An enterprise bean JAR file that contains both the session bean and the message-driven bean</p>
</li>
<li>
<p>An application EAR file that contains the two JAR files</p>
<div class="paragraph">
<p>The <code>clientsessionmdb.ear</code> file is created in the <code>clientsessionmdb-ear/target/</code> directory.</p>
</div>
<div class="paragraph">
<p>The command then deploys the EAR file, retrieves the client stubs, and runs the client.</p>
</div>
<div class="paragraph">
<p>The client displays these lines:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-asciidoc hljs" data-lang="asciidoc">To view the bean output,
 check &lt;install_dir&gt;/domains/domain1/logs/server.log.</code></pre>
</div>
</div>
<div class="paragraph">
<p>The output from the enterprise beans appears in the server log file.
The Publisher session bean sends two sets of 18 messages numbered 0 through 17.
Because of the message selector, the message-driven bean receives only the messages whose <code>NewsType</code> property is <code>Sports</code> or <code>Opinion</code>.</p>
</div>
</li>
</ol>
</div>
</li>
<li>
<p>Use the <strong>Services</strong> tab to undeploy the application after you have finished running it.</p>
</li>
</ol>
</div>
</div>
<div class="sect3">
<h4 id="_to_run_clientsessionmdb_using_maven"><a class="anchor" href="#_to_run_clientsessionmdb_using_maven"></a>To Run clientsessionmdb Using Maven</h4>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Make sure that GlassFish Server has been started (see <a href="../../intro/usingexamples/usingexamples.html#_starting_and_stopping_glassfish_server" class="xref page">Starting and Stopping GlassFish Server</a>).</p>
</li>
<li>
<p>Go to the following directory:</p>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-asciidoc hljs" data-lang="asciidoc">tut-install/examples/jms/clientsessionmdb/</code></pre>
</div>
</div>
</li>
<li>
<p>To compile the source files and package, deploy, and run the application, enter the following command:</p>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-shell hljs" data-lang="shell">mvn install</code></pre>
</div>
</div>
<div class="paragraph">
<p>This command creates the following:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>An application client JAR file that contains the client class file and the session bean&#8217;s remote interface, along with a manifest file that specifies the main class and places the enterprise bean JAR file in its classpath</p>
</li>
<li>
<p>An enterprise bean JAR file that contains both the session bean and the message-driven bean</p>
</li>
<li>
<p>An application EAR file that contains the two JAR files</p>
<div class="paragraph">
<p>The <code>clientsessionmdb.ear</code> file is created in the <code>clientsessionmdb-ear/target/</code> directory.</p>
</div>
<div class="paragraph">
<p>The command then deploys the EAR file, retrieves the client stubs, and runs the client.</p>
</div>
<div class="paragraph">
<p>The client displays these lines:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-asciidoc hljs" data-lang="asciidoc">To view the bean output,
 check &lt;install_dir&gt;/domains/domain1/logs/server.log.</code></pre>
</div>
</div>
<div class="paragraph">
<p>The output from the enterprise beans appears in the server log file.
The Publisher session bean sends two sets of 18 messages numbered 0 through 17.
Because of the message selector, the message-driven bean receives only the messages whose <code>NewsType</code> property is <code>Sports</code> or <code>Opinion</code>.</p>
</div>
</li>
</ul>
</div>
</li>
<li>
<p>Undeploy the application after you have finished running it:</p>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-shell hljs" data-lang="shell">mvn cargo:undeploy</code></pre>
</div>
</div>
</li>
</ol>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_using_an_entity_to_join_messages_from_two_mdbs"><a class="anchor" href="#_using_an_entity_to_join_messages_from_two_mdbs"></a>Using an Entity to Join Messages from Two MDBs</h2>
<div class="sectionbody">
<div class="paragraph">
<p>This section explains how to write, compile, package, deploy, and run an application that uses the Jakarta Messaging with an entity.
The application uses the following components:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>An application client that both sends and receives messages</p>
</li>
<li>
<p>Two message-driven beans</p>
</li>
<li>
<p>An entity class</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>You will find the source files for this section in the <code><em>tut-install</em>/examples/jms/clientmdbentity/</code> directory.
Path names in this section are relative to this directory.</p>
</div>
<div class="sect2">
<h3 id="_overview_of_the_clientmdbentity_example_application"><a class="anchor" href="#_overview_of_the_clientmdbentity_example_application"></a>Overview of the clientmdbentity Example Application</h3>
<div class="paragraph">
<p>This application simulates, in a simplified way, the work flow of a company&#8217;s human resources (HR) department when it processes a new hire.
This application also demonstrates how to use the Jakarta EE platform to accomplish a task that many Messaging applications need to perform.</p>
</div>
<div class="paragraph">
<p>A messaging client must often wait for several messages from various sources.
It then uses the information in all these messages to assemble a message that it then sends to another destination.
The common term for this design pattern (which is not specific to Jakarta Messaging) is joining messages.
Such a task must be transactional, with all the receives and the send as a single transaction.
If not all the messages are received successfully, the transaction can be rolled back.
For an application client example that illustrates this task, see <a href="#_using_local_transactions">Using Local Transactions</a>.</p>
</div>
<div class="paragraph">
<p>A message-driven bean can process only one message at a time in a transaction.
To provide the ability to join messages, an application can have the message-driven bean store the interim information in a Jakarta Persistence entity.
The entity can then determine whether all the information has been received; when it has, the entity can report this back to one of the message-driven beans, which then creates and sends the message to the other destination.
After it has completed its task, the entity can be removed.</p>
</div>
<div class="paragraph">
<p>The basic steps of the application are as follows.</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>The HR department&#8217;s application client generates an employee ID for each new hire and then publishes a message (M1) containing the new hire&#8217;s name, employee ID, and position.
It publishes the message to a topic because the message needs to be consumed by two message-driven beans.
The client then creates a temporary queue, <code>ReplyQueue</code>, with a message listener that waits for a reply to the message.
(See <a href="../jms-concepts/jms-concepts.html#_creating_temporary_destinations" class="xref page">Creating Temporary Destinations</a> for more information.)</p>
</li>
<li>
<p>Two message-driven beans process each message: One bean, <code>OfficeMDB</code>, assigns the new hire&#8217;s office number, and the other bean, <code>EquipmentMDB</code>, assigns the new hire&#8217;s equipment.
The first bean to process the message creates and persists an entity named <code>SetupOffice</code>, then calls a business method of the entity to store the information it has generated.
The second bean locates the existing entity and calls another business method to add its information.</p>
</li>
<li>
<p>When both the office and the equipment have been assigned, the entity business method returns a value of <code>true</code> to the message-driven bean that called the method.
The message-driven bean then sends to the reply queue a message (M2) describing the assignments.
Then it removes the entity.
The application client&#8217;s message listener retrieves the information.</p>
</li>
</ol>
</div>
<div class="paragraph">
<p><a href="#_an_enterprise_bean_application_client_to_message_driven_beans_to_entity">Figure 5, &#8220;An Enterprise Bean Application: Client to Message-Driven Beans to Entity&#8221;</a> illustrates the structure of this application.
Of course, an actual HR application would have more components; other beans could set up payroll and benefits records, schedule orientation, and so on.</p>
</div>
<div class="paragraph">
<p><a href="#_an_enterprise_bean_application_client_to_message_driven_beans_to_entity">Figure 5, &#8220;An Enterprise Bean Application: Client to Message-Driven Beans to Entity&#8221;</a> assumes that <code>OfficeMDB</code> is the first message-driven bean to consume the message from the client.
<code>OfficeMDB</code> then creates and persists the <code>SetupOffice</code> entity and stores the office information.
<code>EquipmentMDB</code> then finds the entity, stores the equipment information, and learns that the entity has completed its work.
<code>EquipmentMDB</code> then sends the message to the reply queue and removes the entity.</p>
</div>
<div id="_an_enterprise_bean_application_client_to_message_driven_beans_to_entity" class="imageblock">
<div class="content">
<img src="../../common/_images/jakartaeett_dt_038.svg" alt="Diagram of application showing an application client, two message-driven beans, and an entity, as well as the associated topic and queue">
</div>
<div class="title">Figure 5. An Enterprise Bean Application: Client to Message-Driven Beans to Entity</div>
</div>
</div>
<div class="sect2">
<h3 id="_writing_the_application_components_for_the_clientmdbentity_example"><a class="anchor" href="#_writing_the_application_components_for_the_clientmdbentity_example"></a>Writing the Application Components for the clientmdbentity Example</h3>
<div class="paragraph">
<p>Writing the components of the application involves coding the application client, the message-driven beans, and the entity class.</p>
</div>
<div class="sect3">
<h4 id="_coding_the_application_client_humanresourceclient_java"><a class="anchor" href="#_coding_the_application_client_humanresourceclient_java"></a>Coding the Application Client: HumanResourceClient.java</h4>
<div class="paragraph">
<p>The application client, <code>HumanResourceClient.java</code>, found under <code>clientmdbentity-app-client</code>, performs the following steps:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Defines a topic for the application, using the <code>java:app</code> namespace because the topic is used in both the application client and the Jakarta Enterprise Beans module</p>
</li>
<li>
<p>Injects <code>ConnectionFactory</code> and <code>Topic</code> resources</p>
</li>
<li>
<p>Creates a <code>TemporaryQueue</code> to receive notification of processing that occurs, based on new-hire events it has published</p>
</li>
<li>
<p>Creates a <code>JMSConsumer</code> for the <code>TemporaryQueue</code>, sets the <code>JMSConsumer</code>'s message listener, and starts the connection</p>
</li>
<li>
<p>Creates a <code>MapMessage</code></p>
</li>
<li>
<p>Creates five new employees with randomly generated names, positions, and ID numbers (in sequence) and publishes five messages containing this information</p>
</li>
</ol>
</div>
<div class="paragraph">
<p>The message listener, <code>HRListener</code>, waits for messages that contain the assigned office and equipment for each employee.
When a message arrives, the message listener displays the information received and determines whether all five messages have arrived.
When they have, the message listener notifies the <code>main</code> method, which then exits.</p>
</div>
</div>
<div class="sect3">
<h4 id="_coding_the_message_driven_beans_for_the_clientmdbentity_example"><a class="anchor" href="#_coding_the_message_driven_beans_for_the_clientmdbentity_example"></a>Coding the Message-Driven Beans for the clientmdbentity Example</h4>
<div class="paragraph">
<p>This example uses two message-driven beans, both under <code>clientmdbentity-ejb</code>:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>EquipmentMDB.java</code></p>
</li>
<li>
<p><code>OfficeMDB.java</code></p>
</li>
</ul>
</div>
<div class="paragraph">
<p>The beans take the following steps.</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>They inject a <code>MessageDrivenContext</code> resource, an <code>EntityManager</code>, and a <code>JMSContext</code>.</p>
</li>
<li>
<p>The <code>onMessage</code> method retrieves the information in the message.
The <code>EquipmentMDB</code>'s <code>onMessage</code> method chooses equipment, based on the new hire&#8217;s position; the <code>OfficeMDB</code>'s <code>onMessage</code> method randomly generates an office number.</p>
</li>
<li>
<p>After a slight delay to simulate real world processing hitches, the <code>onMessage</code> method calls a helper method, <code>compose</code>.</p>
</li>
<li>
<p>The <code>compose</code> method takes the following steps.</p>
<div class="olist loweralpha">
<ol class="loweralpha" type="a">
<li>
<p>It either creates and persists the <code>SetupOffice</code> entity or finds it by primary key.</p>
</li>
<li>
<p>It uses the entity to store the equipment or the office information in the database, calling either the <code>doEquipmentList</code> or the <code>doOfficeNumber</code> business method.</p>
</li>
<li>
<p>If the business method returns <code>true</code>, meaning that all of the information has been stored, it retrieves the reply destination information from the message, creates a <code>JMSProducer</code>, and sends a reply message that contains the information stored in the entity.</p>
</li>
<li>
<p>It removes the entity.</p>
</li>
</ol>
</div>
</li>
</ol>
</div>
</div>
<div class="sect3">
<h4 id="_coding_the_entity_class_for_the_clientmdbentity_example"><a class="anchor" href="#_coding_the_entity_class_for_the_clientmdbentity_example"></a>Coding the Entity Class for the clientmdbentity Example</h4>
<div class="paragraph">
<p>The <code>SetupOffice.java</code> class, also under <code>clientmdbentity-ejb</code>, is an entity class.
The entity and the message-driven beans are packaged together in an enterprise bean JAR file.
The entity class is declared as follows:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">@Entity
public class SetupOffice implements Serializable { ... }</code></pre>
</div>
</div>
<div class="paragraph">
<p>The class contains a no-argument constructor and a constructor that takes two arguments, the employee ID and name.
It also contains getter and setter methods for the employee ID, name, office number, and equipment list.
The getter method for the employee ID has the <code>@Id</code> annotation to indicate that this field is the primary key:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">@Id
public String getEmployeeId() {
    return id;
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>The class also implements the two business methods, <code>doEquipmentList</code> and <code>doOfficeNumber</code>, and their helper method, <code>checkIfSetupComplete</code>.</p>
</div>
<div class="paragraph">
<p>The message-driven beans call the business methods and the getter methods.</p>
</div>
<div class="paragraph">
<p>The <code>persistence.xml</code> file for the entity specifies the most basic settings:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-xml hljs" data-lang="xml">&lt;?xml version="1.0" encoding="UTF-8"?&gt;
&lt;persistence version="3.0"
             xmlns="https://jakarta.ee/xml/ns/persistence"
             xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
             xsi:schemaLocation="https://jakarta.ee/xml/ns/persistence
               https://jakarta.ee/xml/ns/persistence/persistence_3_0.xsd"&gt;
  &lt;persistence-unit name="clientmdbentity-ejbPU" transaction-type="JTA"&gt;
    &lt;provider&gt;org.eclipse.persistence.jpa.PersistenceProvider&lt;/provider&gt;
    &lt;jta-data-source&gt;java:comp/DefaultDataSource&lt;/jta-data-source&gt;
    &lt;properties&gt;
      &lt;property name="eclipselink.ddl-generation"
                value="drop-and-create-tables"/&gt;
    &lt;/properties&gt;
  &lt;/persistence-unit&gt;
&lt;/persistence&gt;</code></pre>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_running_the_clientmdbentity_example"><a class="anchor" href="#_running_the_clientmdbentity_example"></a>Running the clientmdbentity Example</h3>
<div class="paragraph">
<p>You can use either NetBeans IDE or Maven to build, deploy, and run the <code>clientmdbentity</code> example.</p>
</div>
<div class="paragraph">
<p>Because the example defines its own application-private topic and uses the preconfigured default connection factory <code>java:comp/DefaultJMSConnectionFactory</code> and the preconfigured default JDBC resource <code>java:comp/DefaultDataSource</code>, you do not need to create resources for it.</p>
</div>
<div class="sect3">
<h4 id="_to_run_clientmdbentity_using_netbeans_ide"><a class="anchor" href="#_to_run_clientmdbentity_using_netbeans_ide"></a>To Run clientmdbentity Using NetBeans IDE</h4>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Make sure that GlassFish Server has been started (see <a href="../../intro/usingexamples/usingexamples.html#_starting_and_stopping_glassfish_server" class="xref page">Starting and Stopping GlassFish Server</a>), as well as the database server (see <a href="../../intro/usingexamples/usingexamples.html#_starting_and_stopping_apache_derby" class="xref page">Starting and Stopping Apache Derby</a>).</p>
</li>
<li>
<p>From the <strong>File</strong> menu, choose <strong>Open Project</strong>.</p>
</li>
<li>
<p>In the <strong>Open Project</strong> dialog box, navigate to:</p>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-asciidoc hljs" data-lang="asciidoc">tut-install/examples/jms/clientmdbentity</code></pre>
</div>
</div>
</li>
<li>
<p>Select the <code>clientmdbentity</code> folder.</p>
</li>
<li>
<p>Click <strong>Open Project</strong>.</p>
</li>
<li>
<p>In the <strong>Projects</strong> tab, right-click the <code>clientmdbentity</code> project and select <strong>Build</strong>.</p>
<div class="paragraph">
<p>This command creates the following:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>An application client JAR file that contains the client class and listener class files, along with a manifest file that specifies the main class</p>
</li>
<li>
<p>An enterprise bean JAR file that contains the message-driven beans and the entity class, along with the <code>persistence.xml</code> file</p>
</li>
<li>
<p>An application EAR file that contains the two JAR files along with an <code>application.xml</code> file</p>
<div class="paragraph">
<p>The <code>clientmdbentity.ear</code> file is created in the <code>clientmdbentity-ear/target/</code> directory.</p>
</div>
<div class="paragraph">
<p>The command then deploys the EAR file, retrieves the client stubs, and runs the application client.</p>
</div>
</li>
</ul>
</div>
</li>
</ol>
</div>
</div>
<div class="sect3">
<h4 id="_to_run_clientmdbentity_using_maven"><a class="anchor" href="#_to_run_clientmdbentity_using_maven"></a>To Run clientmdbentity Using Maven</h4>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Make sure that GlassFish Server has been started (see <a href="../../intro/usingexamples/usingexamples.html#_starting_and_stopping_glassfish_server" class="xref page">Starting and Stopping GlassFish Server</a>), as well as the database server (see <a href="../../intro/usingexamples/usingexamples.html#_starting_and_stopping_apache_derby" class="xref page">Starting and Stopping Apache Derby</a>).</p>
</li>
<li>
<p>Go to the following directory:</p>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-asciidoc hljs" data-lang="asciidoc">tut-install/examples/jms/clientmdbentity/</code></pre>
</div>
</div>
</li>
<li>
<p>To compile the source files and package, deploy, and run the application, enter the following command:</p>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-shell hljs" data-lang="shell">mvn install</code></pre>
</div>
</div>
<div class="paragraph">
<p>This command creates the following:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>An application client JAR file that contains the client class and listener class files, along with a manifest file that specifies the main class</p>
</li>
<li>
<p>An enterprise bean JAR file that contains the message-driven beans and the entity class, along with the <code>persistence.xml</code> file</p>
</li>
<li>
<p>An application EAR file that contains the two JAR files along with an <code>application.xml</code> file</p>
<div class="paragraph">
<p>The command then deploys the application, retrieves the client stubs, and runs the application client.</p>
</div>
</li>
</ul>
</div>
</li>
</ol>
</div>
</div>
<div class="sect3">
<h4 id="_viewing_the_application_output"><a class="anchor" href="#_viewing_the_application_output"></a>Viewing the Application Output</h4>
<div class="paragraph">
<p>The output in the NetBeans IDE output window or in the terminal window looks something like this (preceded by application client container output and Maven output):</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-asciidoc hljs" data-lang="asciidoc">SENDER: Setting hire ID to 50, name Bill Tudor, position Programmer
SENDER: Setting hire ID to 51, name Carol Jones, position Senior Programmer
SENDER: Setting hire ID to 52, name Mark Wilson, position Manager
SENDER: Setting hire ID to 53, name Polly Wren, position Senior Programmer
SENDER: Setting hire ID to 54, name Joe Lawrence, position Director
Waiting for 5 message(s)
New hire event processed:
  Employee ID: 52
  Name: Mark Wilson
  Equipment: Tablet
  Office number: 294
Waiting for 4 message(s)
New hire event processed:
  Employee ID: 53
  Name: Polly Wren
  Equipment: Laptop
  Office number: 186
Waiting for 3 message(s)
New hire event processed:
  Employee ID: 54
  Name: Joe Lawrence
  Equipment: Mobile Phone
  Office number: 135
Waiting for 2 message(s)
New hire event processed:
  Employee ID: 50
  Name: Bill Tudor
  Equipment: Desktop System
  Office number: 200
Waiting for 1 message(s)
New hire event processed:
  Employee ID: 51
  Name: Carol Jones
  Equipment: Laptop
  Office number: 262</code></pre>
</div>
</div>
<div class="paragraph">
<p>The output from the message-driven beans and the entity class appears in the server log.</p>
</div>
<div class="paragraph">
<p>For each employee, the application first creates the entity and then finds it.
You may see runtime errors in the server log, and transaction rollbacks may occur.
The errors occur if both of the message-driven beans discover at the same time that the entity does not yet exist, so they both try to create it.
The first attempt succeeds, but the second fails because the bean already exists.
After the rollback, the second message-driven bean tries again and succeeds in finding the entity.
Container-managed transactions allow the application to run correctly, in spite of these errors, with no special programming.</p>
</div>
<div class="paragraph">
<p>To undeploy the application after you have finished running it, use the Services tab or issue the <code>mvn cargo:undeploy</code> command.</p>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_using_netbeans_ide_to_create_jakarta_messaging_resources"><a class="anchor" href="#_using_netbeans_ide_to_create_jakarta_messaging_resources"></a>Using NetBeans IDE to Create Jakarta Messaging Resources</h2>
<div class="sectionbody">
<div class="paragraph">
<p>When you write your own Messaging applications, you will need to create resources for them.
This section explains how to use NetBeans IDE to create <code>src/main/setup/glassfish-resources.xml</code> files similar to those used in the examples in this chapter.
It also explains how to use NetBeans IDE to delete the resources.</p>
</div>
<div class="paragraph">
<p>You can also create, list, and delete Jakarta Messaging resources using the Administration Console or the <code>asadmin create-jms-resource</code>, <code>asadmin list-jms-resources</code>, and <code>asadmin delete-jms-resources</code> commands.
For information, consult the GlassFish Server documentation or enter <code>asadmin help</code> command-name.</p>
</div>
<div class="sect2">
<h3 id="_to_create_jakarta_messaging_resources_using_netbeans_ide"><a class="anchor" href="#_to_create_jakarta_messaging_resources_using_netbeans_ide"></a>To Create Jakarta Messaging Resources Using NetBeans IDE</h3>
<div class="paragraph">
<p>Follow these steps to create a Jakarta Messaging resource in GlassFish Server using NetBeans IDE.
Repeat these steps for each resource you need.</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Right-click the project for which you want to create resources and select <strong>New</strong>, then select <strong>Other</strong>.</p>
</li>
<li>
<p>In the <strong>New File</strong> wizard, under <strong>Categories</strong>, select <strong>GlassFish</strong>.</p>
</li>
<li>
<p>Under <strong>File Types</strong>, select <strong>JMS Resource</strong>.</p>
</li>
<li>
<p>On the General Attributes - JMS Resource page, in the JNDI Name field, enter the name of the resource.</p>
<div class="paragraph">
<p>By convention, Messaging resource names begin with <code>jms/</code>.</p>
</div>
</li>
<li>
<p>Select the option for the resource type.</p>
<div class="paragraph">
<p>Normally, this is either <code>jakarta.jms.Queue</code>, <code>jakarta.jms.Topic</code>, or <code>jakarta.jms.ConnectionFactory</code>.</p>
</div>
</li>
<li>
<p>Click <strong>Next</strong>.</p>
</li>
<li>
<p>On the JMS Properties page, for a queue or topic, enter a name for a physical queue in the Value field for the Name property.</p>
<div class="paragraph">
<p>You can enter any value for this required field.</p>
</div>
<div class="paragraph">
<p>Connection factories have no required properties.
In a few situations, you may need to specify a property.</p>
</div>
</li>
<li>
<p>Click <strong>Finish</strong>.</p>
<div class="paragraph">
<p>A file named <code>glassfish-resources.xml</code> is created in your Maven project, in a directory named <code>src/main/setup/</code>.
In the Projects tab, you can find it under the Other Sources node.
You will need to run the <code>asadmin add-resources</code> command to create the resources in GlassFish Server.</p>
</div>
</li>
</ol>
</div>
</div>
<div class="sect2">
<h3 id="_to_delete_jakarta_messaging_resources_using_netbeans_ide"><a class="anchor" href="#_to_delete_jakarta_messaging_resources_using_netbeans_ide"></a>To Delete Jakarta Messaging Resources Using NetBeans IDE</h3>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>In the <strong>Services</strong> tab, expand the <strong>Servers</strong> node, then expand the <strong>GlassFish Server</strong> node.</p>
</li>
<li>
<p>Expand the <strong>Resources</strong> node, then expand the <strong>Connector Resources</strong> node.</p>
</li>
<li>
<p>Expand the <strong>Admin Object Resources</strong> node.</p>
</li>
<li>
<p>Right-click any destination you want to remove and select <strong>Unregister</strong>.</p>
</li>
<li>
<p>Expand the <strong>Connector Connection Pools</strong> node.</p>
</li>
<li>
<p>Right-click the connection pool that corresponds to the connection factory you removed and select <strong>Unregister</strong>.</p>
<div class="paragraph">
<p>When you remove a connector connection pool, the associated connector resource is also deleted.
This action removes the connection factory.</p>
</div>
</li>
</ol>
</div>
</div>
</div>
</div>
</article>
  </div>
</main>
</div>
<footer class="footer">
  <p>This page was built using the Antora default UI.</p>
  <p>The source code for this UI is licensed under the terms of the MPL-2.0 license.</p>
</footer>
<script id="site-script" src="../../../../_/js/site.js" data-ui-root-path="../../../../_"></script>
<script async src="../../../../_/js/vendor/highlight.js"></script>
  </body>
</html>
