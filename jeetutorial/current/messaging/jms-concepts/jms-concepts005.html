<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>Untitled :: Jakarta EE Documentation</title>
    <meta name="generator" content="Antora 3.1.3">
    <link rel="stylesheet" href="../../../../_/css/site.css">
    <script>var uiRootPath = '../../../../_'</script>
    <script>!function (theme) {
        if (theme === 'dark') document.documentElement.classList.add('theme-dark')
      }(localStorage && localStorage.getItem('theme') || (matchMedia('(prefers-color-scheme: dark)') && 'dark'))
    </script>
      </head>
  <body class="article">
<header class="header">
  <nav class="navbar">
    <div class="navbar-brand">
      <a id="site-title" class="navbar-item" href="../../../..">Jakarta EE Documentation</a>
      <button class="navbar-burger" data-target="topbar-nav">
        <span></span>
        <span></span>
        <span></span>
      </button>
    </div>
    <div id="topbar-nav" class="navbar-menu">
      <div class="navbar-end">
<!--
        <a class="navbar-item" href="#">Home</a>
        <div class="navbar-item has-dropdown is-hoverable">
          <a class="navbar-link" href="#">Products</a>
          <div class="navbar-dropdown">
            <a class="navbar-item" href="#">Product A</a>
            <a class="navbar-item" href="#">Product B</a>
            <a class="navbar-item" href="#">Product C</a>
          </div>
        </div>
        <div class="navbar-item has-dropdown is-hoverable">
          <a class="navbar-link" href="#">Services</a>
          <div class="navbar-dropdown">
            <a class="navbar-item" href="#">Service A</a>
            <a class="navbar-item" href="#">Service B</a>
            <a class="navbar-item" href="#">Service C</a>
          </div>
        </div>
 -->
        <div class="navbar-item">
          <span class="control">
            <a class="button is-primary" href="../../../../jakartaee-tutorial/10/jakarta-ee-tutorial.pdf">Download</a>
          </span>
        </div>
      </div>
      <div class="navbar-theme-switcher">
        <span class="switch" title="Switch between Light and Dark Theme">
          <input id="theme-switcher-checkbox" type="checkbox" />
          <label for="theme-switcher-checkbox">Dark Theme</label>
        </span>
      </div>
    </div>
  </nav>
</header>
<div class="body">
<div class="nav-container" data-component="jakartaee-tutorial" data-version="10">
  <aside class="nav">
    <div class="panels">
<div class="nav-panel-menu is-active" data-panel="menu">
  <nav class="nav-menu">
    <h3 class="title"><a href="../../index.html">Jakarta EE Tutorial</a></h3>
<ul class="nav-list">
  <li class="nav-item" data-depth="0">
    <button class="nav-item-toggle"></button>
    <span class="nav-text">Introduction</span>
<ul class="nav-list">
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="../../index.html">Preface</a>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="0">
    <button class="nav-item-toggle"></button>
    <span class="nav-text">Jakarta EE Core Profile</span>
<ul class="nav-list">
  <li class="nav-item" data-depth="1">
    <button class="nav-item-toggle"></button>
    <span class="nav-text">Jakarta CDI Lite</span>
<ul class="nav-list">
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../../cdi/cdi-basic/cdi-basic.html">Introduction to Jakarta Contexts and Dependency Injection</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../../cdi/cdi-basicexamples/cdi-basicexamples.html">Running the Basic Contexts and Dependency Injection Examples</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../../supporttechs/interceptors/interceptors.html">Using Jakarta EE Interceptors</a>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="1">
    <button class="nav-item-toggle"></button>
    <span class="nav-text">Jakarta REST</span>
<ul class="nav-list">
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../../websvcs/jaxrs/jaxrs.html">Building RESTful Web Services with Jakarta REST</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../../websvcs/jaxrs-client/jaxrs-client.html">Accessing REST Resources with the Jakarta REST Client API</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../../websvcs/jaxrs-advanced/jaxrs-advanced.html">Jakarta REST: Advanced Topics and an Example</a>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="1">
    <button class="nav-item-toggle"></button>
    <span class="nav-text">Jakarta JSON</span>
<ul class="nav-list">
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../../web/jsonb/jsonb.html">JSON Binding</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../../web/jsonp/jsonp.html">JSON Processing</a>
  </li>
</ul>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="0">
    <button class="nav-item-toggle"></button>
    <span class="nav-text">Jakarta EE Web Profile</span>
<ul class="nav-list">
  <li class="nav-item" data-depth="1">
    <button class="nav-item-toggle"></button>
    <span class="nav-text">Jakarta CDI Full</span>
<ul class="nav-list">
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../../cdi/cdi-adv/cdi-adv.html">Jakarta Contexts and Dependency Injection: Advanced Topics</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../../cdi/cdi-bootstrap-se8/cdi-bootstrap-se8.html">Bootstrapping a CDI Container in Java SE</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../../cdi/cdi-adv-examples/cdi-adv-examples.html">Running the Advanced Contexts and Dependency Injection Examples</a>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="1">
    <button class="nav-item-toggle"></button>
    <span class="nav-text">Jakarta Validation</span>
<ul class="nav-list">
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../../beanvalidation/bean-validation/bean-validation.html">Introduction to Jakarta Bean Validation</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../../beanvalidation/bean-validation-advanced/bean-validation-advanced.html">Bean Validation: Advanced Topics</a>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="../../security/security.html">Jakarta Security</a>
  </li>
  <li class="nav-item" data-depth="1">
    <button class="nav-item-toggle"></button>
    <span class="nav-text">Jakarta Servlets</span>
<ul class="nav-list">
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../../web/webapp/webapp.html">Getting Started with Web Applications</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../../web/servlets/servlets.html">Jakarta Servlet Technology</a>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="1">
    <button class="nav-item-toggle"></button>
    <span class="nav-text">Jakarta Faces</span>
<ul class="nav-list">
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../../web/faces-intro/faces-intro.html">Jakarta Faces Technology</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../../web/faces-facelets/faces-facelets.html">Introduction to Facelets</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../../web/faces-page/faces-page.html">Using Jakarta Faces Technology in Web Pages</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../../web/faces-page-core/faces-page-core.html">Using Converters, Listeners, and Validators</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../../web/faces-develop/faces-develop.html">Developing with Jakarta Faces Technology</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../../web/faces-ajax/faces-ajax.html">Using Ajax with Jakarta Faces Technology</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../../web/faces-advanced-cc/faces-advanced-cc.html">Composite Components: Advanced Topics and an Example</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../../web/faces-custom/faces-custom.html">Creating Custom UI Components and Other Custom Objects</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../../web/faces-configure/faces-configure.html">Configuring Jakarta Faces Applications</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../../web/faces-ws/faces-ws.html">Using WebSockets with Jakarta Faces Technology</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../../web/webi18n/webi18n.html">Internationalizing and Localizing Web Applications</a>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="../../web/websocket/websocket.html">Jakarta WebSocket</a>
  </li>
  <li class="nav-item" data-depth="1">
    <button class="nav-item-toggle"></button>
    <span class="nav-text">Jakarta Persistence</span>
<ul class="nav-list">
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../../persist/persistence-intro/persistence-intro.html">Introduction to Jakarta Persistence</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../../persist/persistence-basicexamples/persistence-basicexamples.html">Running the Persistence Examples</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../../persist/persistence-querylanguage/persistence-querylanguage.html">The Jakarta Persistence Query Language</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../../persist/persistence-criteria/persistence-criteria.html">Using the Criteria API to Create Queries</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../../persist/persistence-string-queries/persistence-string-queries.html">Creating and Using String-Based Criteria Queries</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../../persist/persistence-locking/persistence-locking.html">Controlling Concurrent Access to Entity Data with Locking</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../../persist/persistence-entitygraphs/persistence-entitygraphs.html">Creating Fetch Plans with Entity Graphs</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../../persist/persistence-cache/persistence-cache.html">Using a Second-Level Cache with Jakarta Persistence Applications</a>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="1">
    <button class="nav-item-toggle"></button>
    <span class="nav-text">Jakarta Enterprise Beans Lite</span>
<ul class="nav-list">
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../../entbeans/ejb-intro/ejb-intro.html">Enterprise Beans</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../../entbeans/ejb-gettingstarted/ejb-gettingstarted.html">Getting Started with Enterprise Beans</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../../entbeans/ejb-basicexamples/ejb-basicexamples.html">Running the Enterprise Bean Examples</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../../entbeans/ejb-async/ejb-async.html">Using Asynchronous Method Invocation in Session Beans</a>
  </li>
</ul>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="0">
    <button class="nav-item-toggle"></button>
    <span class="nav-text">Jakarta EE Platform</span>
<ul class="nav-list">
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="../mail-api/mail-api.html">Jakarta Mail</a>
  </li>
  <li class="nav-item" data-depth="1">
    <button class="nav-item-toggle"></button>
    <span class="nav-text">Jakarta Messaging</span>
<ul class="nav-list">
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="jms-concepts.html">Jakarta Messaging Concepts</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../jms-examples/jms-examples.html">Jakarta Messaging Examples</a>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="../../supporttechs/batch-processing/batch-processing.html">Jakarta Batch</a>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="0">
    <button class="nav-item-toggle"></button>
    <span class="nav-text">Advanced</span>
<ul class="nav-list">
  <li class="nav-item" data-depth="1">
    <button class="nav-item-toggle"></button>
    <span class="nav-text">Web Profile</span>
<ul class="nav-list">
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../../security/security-authentication/security-authentication.html">Jakarta Authentication</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../../security/security-authorization/security-authorization.html">Jakarta Authorization</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../../supporttechs/transactions/transactions.html">Jakarta Transactions</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../../supporttechs/concurrency-utilities/concurrency-utilities.html">Jakarta Concurrency</a>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="1">
    <button class="nav-item-toggle"></button>
    <span class="nav-text">Full Profile</span>
<ul class="nav-list">
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../../supporttechs/connectors/connectors.html">Jakarta Connectors</a>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="1">
    <button class="nav-item-toggle"></button>
    <span class="nav-text">Optional Components</span>
<ul class="nav-list">
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../../web/faces-el/faces-el.html">Jakarta Expression Language</a>
  </li>
  <li class="nav-item" data-depth="2">
    <span class="nav-text">Jakarta XML Binding</span>
  </li>
</ul>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="0">
    <button class="nav-item-toggle"></button>
    <span class="nav-text">Archived</span>
<ul class="nav-list">
  <li class="nav-item" data-depth="1">
    <button class="nav-item-toggle"></button>
    <span class="nav-text">Web Profile</span>
<ul class="nav-list">
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../../web/jakarta-pages/jakarta-pages.html">Jakarta Pages</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../../web/jakarta-tags/jakarta-tags.html">Jakarta Tags</a>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="1">
    <button class="nav-item-toggle"></button>
    <span class="nav-text">Full Profile</span>
<ul class="nav-list">
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../../websvcs/xml-websvcs/xml-websvcs.html">XML Web Services</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../../entbeans/ejb-full/ejb-full.html">Jakarta Enterprise Beans Full</a>
  </li>
</ul>
  </li>
</ul>
  </li>
</ul>
  </nav>
</div>
<div class="nav-panel-explore" data-panel="explore">
  <div class="context">
    <span class="title">Jakarta EE Tutorial</span>
    <span class="version">10</span>
  </div>
  <ul class="components">
    <li class="component is-current">
      <a class="title" href="../../index.html">Jakarta EE Tutorial</a>
      <ul class="versions">
        <li class="version is-current is-latest">
          <a href="../../index.html">10</a>
        </li>
      </ul>
    </li>
  </ul>
</div>
    </div>
  </aside>
</div>
<main class="article">
<div class="toolbar" role="navigation">
<button class="nav-toggle"></button>
<nav class="breadcrumbs" aria-label="breadcrumbs">
</nav>
  <div class="edit-this-page"><a href="file:///home/john/workspace/virtua/jakartaee-tutorial/src/main/antora/modules/messaging/pages/jms-concepts/jms-concepts005.adoc">Edit this Page</a></div>
</div>
  <div class="content">
<aside class="toc sidebar" data-title="Contents" data-levels="2">
  <div class="toc-menu"></div>
</aside>
<article class="doc">
<div class="sect1">
<h2 id="_using_jakarta_messaging_in_jakarta_ee_applications"><a class="anchor" href="#_using_jakarta_messaging_in_jakarta_ee_applications"></a>Using Jakarta Messaging in Jakarta EE Applications</h2>
<div class="sectionbody">
<div class="paragraph">
<p>This section describes how using Jakarta Messaging in enterprise bean applications or web applications differs from using it in application clients.</p>
</div>
<div class="sect2">
<h3 id="_overview_of_using_jakarta_messaging"><a class="anchor" href="#_overview_of_using_jakarta_messaging"></a>Overview of Using Jakarta Messaging</h3>
<div class="paragraph">
<p>A general rule in the Jakarta EE platform specification applies to all Jakarta EE components that use Jakarta Messaging within enterprise bean or web containers: Application components in the web and enterprise bean containers must not attempt to create more than one active (not closed) <code>Session</code> object per connection.
Multiple <code>JMSContext</code> objects are permitted, however, since they combine a single connection and a single session.</p>
</div>
<div class="paragraph">
<p>This rule does not apply to application clients.
The application client container supports the creation of multiple sessions for each connection.</p>
</div>
</div>
<div class="sect2">
<h3 id="_creating_resources_for_jakarta_ee_applications"><a class="anchor" href="#_creating_resources_for_jakarta_ee_applications"></a>Creating Resources for Jakarta EE Applications</h3>
<div class="paragraph">
<p>You can use annotations to create application-specific connection factories and destinations for Jakarta EE enterprise bean or web components.
The resources you create in this way are visible only to the application for which you create them.</p>
</div>
<div class="paragraph">
<p>You can also use deployment descriptor elements to create these resources.
Elements specified in the deployment descriptor override elements specified in annotations.
See <a href="../../platform/packaging/packaging.html#_packaging_applications" class="xref page">Packaging Applications</a> for basic information about deployment descriptors.
You must use a deployment descriptor to create application-specific resources for application clients.</p>
</div>
<div class="paragraph">
<p>To create a destination, use a <code>@JMSDestinationDefinition</code> annotation like the following on a class:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">@JMSDestinationDefinition(
    name = "java:app/jms/myappTopic",
    interfaceName = "jakarta.jms.Topic",
    destinationName = "MyPhysicalAppTopic"
  )</code></pre>
</div>
</div>
<div class="paragraph">
<p>The <code>name</code>, <code>interfaceName</code>, and <code>destinationName</code> elements are required.
You can optionally specify a <code>description</code> element.
To create multiple destinations, enclose them in a <code>@JMSDestinationDefinitions</code> annotation, separated by commas.</p>
</div>
<div class="paragraph">
<p>To create a connection factory, use a <code>@JMSConnectionFactoryDefinition</code> annotation like the following on a class:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">@JMSConnectionFactoryDefinition(
    name="java:app/jms/MyConnectionFactory"
)</code></pre>
</div>
</div>
<div class="paragraph">
<p>The <code>name</code> element is required.
You can optionally specify a number of other elements, such as <code>clientId</code> if you want to use the connection factory for durable subscriptions, or <code>description</code>.
If you do not specify the <code>interfaceName</code> element, the default interface is <code>jakarta.jms.ConnectionFactory</code>.
To create multiple connection factories, enclose them in a <code>@JMSConnectionFactoryDefinitions</code> annotation, separated by commas.</p>
</div>
<div class="paragraph">
<p>You need to specify the annotation only once for a given application, in any of the components.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
If your application contains one or more message-driven beans, you may want to place the annotation on one of the message-driven beans.
If you place the annotation on a sending component such as an application client, you need to specify the <code>mappedName</code> element to look up the topic, instead of using the <code>destinationLookup</code> property of the activation configuration specification.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>When you inject the resource into a component, use the value of the <code>name</code> element in the definition annotation as the value of the <code>lookup</code> element in the <code>@Resource</code> annotation:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">@Resource(lookup = "java:app/jms/myappTopic")
private Topic topic;</code></pre>
</div>
</div>
<div class="paragraph">
<p>The following portable JNDI namespaces are available.
Which ones you can use depends on how your application is packaged.</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>java:global</code>: Makes the resource available to all deployed applications</p>
</li>
<li>
<p><code>java:app</code>: Makes the resource available to all components in all modules in a single application</p>
</li>
<li>
<p><code>java:module</code>: Makes the resource available to all components within a given module (for example, all enterprise beans within a Jakarta Enterprise Beans module)</p>
</li>
<li>
<p><code>java:comp</code>: Makes the resource available to a single component only (except in a web application, where it is equivalent to <code>java:module</code>)</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>See the API documentation for details on these annotations.
The examples in <a href="../jms-examples/jms-examples.html#_sending_and_receiving_messages_using_a_simple_web_application" class="xref page">Sending and Receiving Messages Using a Simple Web Application</a>, <a href="../jms-examples/jms-examples.html#_sending_messages_from_a_session_bean_to_an_mdb" class="xref page">Sending Messages from a Session Bean to an MDB</a>, and <a href="../jms-examples/jms-examples.html#_using_an_entity_to_join_messages_from_two_mdbs" class="xref page">Using an Entity to Join Messages from Two MDBs</a> all use the <code>@JMSDestinationDefinition</code> annotation.
The other JMS examples do not use these annotations.
The examples that consist only of application clients are not deployed in the application server and must therefore communicate with each other using administratively created resources that exist outside of individual applications.</p>
</div>
</div>
<div class="sect2">
<h3 id="_using_resource_injection_in_enterprise_bean_or_web_components"><a class="anchor" href="#_using_resource_injection_in_enterprise_bean_or_web_components"></a>Using Resource Injection in Enterprise Bean or Web Components</h3>
<div class="paragraph">
<p>You may use resource injection to inject both administered objects and <code>JMSContext</code> objects in Jakarta EE applications.</p>
</div>
<div class="sect3">
<h4 id="_injecting_a_connectionfactory_queue_or_topic"><a class="anchor" href="#_injecting_a_connectionfactory_queue_or_topic"></a>Injecting a ConnectionFactory, Queue, or Topic</h4>
<div class="paragraph">
<p>Normally, you use the <code>@Resource</code> annotation to inject a <code>ConnectionFactory</code>, <code>Queue</code>, or <code>Topic</code> into your Jakarta EE application.
These objects must be created administratively before you deploy your application.
You may want to use the default connection factory, whose JNDI name is <code>java:comp/DefaultJMSConnectionFactory</code>.</p>
</div>
<div class="paragraph">
<p>When you use resource injection in an application client component, you normally declare the Messaging resource static:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">@Resource(lookup = "java:comp/DefaultJMSConnectionFactory")
private static ConnectionFactory connectionFactory;

@Resource(lookup = "jms/MyQueue")
private static Queue queue;</code></pre>
</div>
</div>
<div class="paragraph">
<p>However, when you use this annotation in a session bean, a message-driven bean, or a web component, do not declare the resource static:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">@Resource(lookup = "java:comp/DefaultJMSConnectionFactory")
private ConnectionFactory connectionFactory;

@Resource(lookup = "jms/MyTopic")
private Topic topic;</code></pre>
</div>
</div>
<div class="paragraph">
<p>If you declare the resource static in these components, runtime errors will result.</p>
</div>
</div>
<div class="sect3">
<h4 id="_injecting_a_jmscontext_object"><a class="anchor" href="#_injecting_a_jmscontext_object"></a>Injecting a JMSContext Object</h4>
<div class="paragraph">
<p>To access a <code>JMSContext</code> object in an enterprise bean or web component, instead of injecting the <code>ConnectionFactory</code> resource and then creating a <code>JMSContext</code>, you can use the <code>@Inject</code> and <code>@JMSConnectionFactory</code> annotations to inject a <code>JMSContext</code>.
To use the default connection factory, use code like the following:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">@Inject
private JMSContext context1;</code></pre>
</div>
</div>
<div class="paragraph">
<p>To use your own connection factory, use code like the following:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">@Inject
@JMSConnectionFactory("jms/MyConnectionFactory")
private JMSContext context2;</code></pre>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_using_jakarta_ee_components_to_produce_and_to_synchronously_receive_messages"><a class="anchor" href="#_using_jakarta_ee_components_to_produce_and_to_synchronously_receive_messages"></a>Using Jakarta EE Components to Produce and to Synchronously Receive Messages</h3>
<div class="paragraph">
<p>An application that produces messages or synchronously receives them can use a Jakarta EE web or Jakarta Enterprise Beans component, such as a managed bean, a servlet, or a session bean, to perform these operations.
The example in <a href="../jms-examples/jms-examples.html#_sending_messages_from_a_session_bean_to_an_mdb" class="xref page">Sending Messages from a Session Bean to an MDB</a> uses a stateless session bean to send messages to a topic.
The example in <a href="../jms-examples/jms-examples.html#_sending_and_receiving_messages_using_a_simple_web_application" class="xref page">Sending and Receiving Messages Using a Simple Web Application</a> uses managed beans to produce and to consume messages.</p>
</div>
<div class="paragraph">
<p>Because a synchronous receive with no specified timeout ties up server resources, this mechanism usually is not the best application design for a web or Jakarta Enterprise Beans component.
Instead, use a synchronous receive that specifies a timeout value, or use a message-driven bean to receive messages asynchronously.
For details about synchronous receives, see <a href="jms-concepts.html#_jakarta_messaging_message_consumers" class="xref page">Jakarta Messaging Message Consumers</a>.</p>
</div>
<div class="paragraph">
<p>Using Jakarta Messaging in a Jakarta EE component is in many ways similar to using it in an application client.
The main differences are the areas of resource management and transactions.</p>
</div>
<div class="sect3">
<h4 id="_managing_jakarta_messaging_resources_in_web_and_jakarta_enterprise_beans_components"><a class="anchor" href="#_managing_jakarta_messaging_resources_in_web_and_jakarta_enterprise_beans_components"></a>Managing Jakarta Messaging Resources in Web and Jakarta Enterprise Beans Components</h4>
<div class="paragraph">
<p>The Jakarta Messaging resources are a connection and a session, usually combined in a <code>JMSContext</code> object.
In general, it is important to release Messaging resources when they are no longer being used.
Here are some useful practices to follow.</p>
</div>
<div class="ulist">
<ul>
<li>
<p>If you wish to maintain a Messaging resource only for the life span of a business method, use a <code>try</code>-with-resources statement to create the <code>JMSContext</code> so that it will be closed automatically at the end of the <code>try</code> block.</p>
</li>
<li>
<p>To maintain a Messaging resource for the duration of a transaction or request, inject the <code>JMSContext</code> as described in <a href="#_injecting_a_jmscontext_object">Injecting a JMSContext Object</a>.
This will also cause the resource to be released when it is no longer needed.</p>
</li>
<li>
<p>If you would like to maintain a Messaging resource for the life span of an enterprise bean instance, you can use a <code>@PostConstruct</code> callback method to create the resource and a <code>@PreDestroy</code> callback method to close the resource.
However, there is normally no need to do this, since application servers usually maintain a pool of connections.
If you use a stateful session bean and you wish to maintain the Messaging resource in a cached state, you must close the resource in a <code>@PrePassivate</code> callback method and set its value to <code>null</code>, and you must create it again in a <code>@PostActivate</code> callback method.</p>
</li>
</ul>
</div>
</div>
<div class="sect3">
<h4 id="_managing_transactions_in_session_beans"><a class="anchor" href="#_managing_transactions_in_session_beans"></a>Managing Transactions in Session Beans</h4>
<div class="paragraph">
<p>Instead of using local transactions, you use Jakarta transactions.
You can use either container-managed transactions or bean-managed transactions.
Normally, you use container-managed transactions for bean methods that perform sends or receives, allowing the enterprise bean container to handle transaction demarcation.
Because container-managed transactions are the default, you do not have to specify them.</p>
</div>
<div class="paragraph">
<p>You can use bean-managed transactions and the <code>jakarta.transaction.UserTransaction</code> interface&#8217;s transaction demarcation methods, but you should do so only if your application has special requirements and you are an expert in using transactions.
Usually, container-managed transactions produce the most efficient and correct behavior.
This tutorial does not provide any examples of bean-managed transactions.</p>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_using_message_driven_beans_to_receive_messages_asynchronously"><a class="anchor" href="#_using_message_driven_beans_to_receive_messages_asynchronously"></a>Using Message-Driven Beans to Receive Messages Asynchronously</h3>
<div class="paragraph">
<p>The sections <a href="../../entbeans/ejb-intro/ejb-intro.html#_what_is_a_message_driven_bean" class="xref page">What Is a Message-Driven Bean?</a> and <a href="jms-concepts.html#_how_does_jakarta_messaging_work_with_the_jakarta_ee_platform" class="xref page">How Does Jakarta Messaging Work with the Jakarta EE Platform?</a> describe how the Jakarta EE platform supports a special kind of enterprise bean, the message-driven bean, which allows Jakarta EE applications to process Jakarta Messaging messages asynchronously.
Other Jakarta EE web and Jakarta Enterprise Beans components allow you to send messages and to receive them synchronously but not asynchronously.</p>
</div>
<div class="paragraph">
<p>A message-driven bean is a message listener to which messages can be delivered from either a queue or a topic.
The messages can be sent by any Jakarta EE component (from an application client, another enterprise bean, or a web component) or from an application or a system that does not use Jakarta EE technology.</p>
</div>
<div class="paragraph">
<p>A message-driven bean class has the following requirements.</p>
</div>
<div class="ulist">
<ul>
<li>
<p>It must be annotated with the <code>@MessageDriven</code> annotation if it does not use a deployment descriptor.</p>
</li>
<li>
<p>The class must be defined as <code>public</code>, but not as <code>abstract</code> or <code>final</code>.</p>
</li>
<li>
<p>It must contain a public constructor with no arguments.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>It is recommended, but not required, that a message-driven bean class implement the message listener interface for the message type it supports.
A bean that supports Jakarta Messaging implements the <code>jakarta.jms.MessageListener</code> interface, which means that it must provide an <code>onMessage</code> method with the following signature:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">void onMessage(Message inMessage)</code></pre>
</div>
</div>
<div class="paragraph">
<p>The <code>onMessage</code> method is called by the bean&#8217;s container when a message has arrived for the bean to service.
This method contains the business logic that handles the processing of the message.
It is the message-driven bean&#8217;s responsibility to parse the message and perform the necessary business logic.</p>
</div>
<div class="paragraph">
<p>A message-driven bean differs from an application client&#8217;s message listener in the following ways.</p>
</div>
<div class="ulist">
<ul>
<li>
<p>In an application client, you must create a <code>JMSContext</code>, then create a <code>JMSConsumer</code>, then call <code>setMessageListener</code> to activate the listener.
For a message-driven bean, you need only define the class and annotate it, and the enterprise bean container creates it for you.</p>
</li>
<li>
<p>The bean class uses the <code>@MessageDriven</code> annotation, which typically contains an <code>activationConfig</code> element containing <code>@ActivationConfigProperty</code> annotations that specify properties used by the bean or the connection factory.
These properties can include the connection factory, a destination type, a durable subscription, a message selector, or an acknowledgment mode.
Some of the examples in <a href="../jms-examples/jms-examples.html#_jakarta_messaging_examples" class="xref page">Jakarta Messaging Examples</a> set these properties.
You can also set the properties in the deployment descriptor.</p>
</li>
<li>
<p>The application client container has only one instance of a <code>MessageListener</code>, which is called on a single thread at a time.
A message-driven bean, however, may have multiple instances, configured by the container, which may be called concurrently by multiple threads (although each instance is called by only one thread at a time).
Message-driven beans may therefore allow much faster processing of messages than message listeners.</p>
</li>
<li>
<p>You do not need to specify a message acknowledgment mode unless you use bean-managed transactions.
The message is consumed in the transaction in which the <code>onMessage</code> method is invoked.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p><a href="#_activationconfigproperty_settings_for_message_driven_beans">@ActivationConfigProperty Settings for Message-Driven Beans</a> lists the activation configuration properties defined by the Jakarta Messaging specification.</p>
</div>
<table id="_activationconfigproperty_settings_for_message_driven_beans" class="tableblock frame-all grid-all" style="width: 80%;">
<caption class="title">@ActivationConfigProperty Settings for Message-Driven Beans</caption>
<colgroup>
<col style="width: 25%;">
<col style="width: 75%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Property Name</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>acknowledgeMode</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Acknowledgment mode, used only for bean-managed transactions; the default is <code>Auto-acknowledge</code> (<code>Dups-ok-acknowledge</code> is also permitted)</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>destinationLookup</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The lookup name of the queue or topic from which the bean will receive messages</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>destinationType</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Either <code>jakarta.jms.Queue</code> or <code>jakarta.jms.Topic</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>subscriptionDurability</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">For durable subscriptions, set the value to <code>Durable</code>; see <a href="jms-concepts.html#_creating_durable_subscriptions" class="xref page">Creating Durable Subscriptions</a> for more information</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>clientId</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">For durable subscriptions, the client ID for the connection (optional)</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>subscriptionName</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">For durable subscriptions, the name of the subscription</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>messageSelector</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">A string that filters messages; see <a href="jms-concepts.html#_jakarta_messaging_message_selectors" class="xref page">Jakarta Messaging Message Selectors</a> for information</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>connectionFactoryLookup</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The lookup name of the connection factory to be used to connect to the Messaging provider from which the bean will receive messages</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p>For example, here is the message-driven bean used in <a href="../jms-examples/jms-examples.html#_receiving_messages_asynchronously_using_a_message_driven_bean" class="xref page">Receiving Messages Asynchronously Using a Message-Driven Bean</a>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">@MessageDriven(activationConfig = {
    @ActivationConfigProperty(propertyName = "destinationLookup",
            propertyValue = "jms/MyQueue"),
    @ActivationConfigProperty(propertyName = "destinationType",
            propertyValue = "jakarta.jms.Queue")
})
public class SimpleMessageBean implements MessageListener {

    @Resource
    private MessageDrivenContext mdc;
    static final Logger logger = Logger.getLogger("SimpleMessageBean");

    public SimpleMessageBean() {
    }

    @Override
    public void onMessage(Message inMessage) {

        try {
            if (inMessage instanceof TextMessage) {
                logger.log(Level.INFO,
                        "MESSAGE BEAN: Message received: {0}",
                        inMessage.getBody(String.class));
            } else {
                logger.log(Level.WARNING,
                        "Message of wrong type: {0}",
                        inMessage.getClass().getName());
            }
        } catch (JMSException e) {
            logger.log(Level.SEVERE,
                    "SimpleMessageBean.onMessage: JMSException: {0}",
                    e.toString());
            mdc.setRollbackOnly();
        }
    }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>If Jakarta Messaging is integrated with the application server using a resource adapter, the Messaging resource adapter handles these tasks for the enterprise bean container.</p>
</div>
<div class="paragraph">
<p>The bean class commonly injects a <code>MessageDrivenContext</code> resource, which provides some additional methods you can use for transaction management (<code>setRollbackOnly</code>, for example):</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">    @Resource
    private MessageDrivenContext mdc;</code></pre>
</div>
</div>
<div class="paragraph">
<p>A message-driven bean never has a local or remote interface.
Instead, it has only a bean class.</p>
</div>
<div class="paragraph">
<p>A message-driven bean is similar in some ways to a stateless session bean: Its instances are relatively short-lived and retain no state for a specific client.
The instance variables of the message-driven bean instance can contain some state across the handling of client messages: for example, an open database connection, or an object reference to an enterprise bean object.</p>
</div>
<div class="paragraph">
<p>Like a stateless session bean, a message-driven bean can have many interchangeable instances running at the same time.
The container can pool these instances to allow streams of messages to be processed concurrently.
The container attempts to deliver messages in chronological order when that would not impair the concurrency of message processing, but no guarantees are made as to the exact order in which messages are delivered to the instances of the message-driven bean class.
If message order is essential to your application, you may want to configure your application server to use just one instance of the message-driven bean.</p>
</div>
<div class="paragraph">
<p>For details on the lifecycle of a message-driven bean, see <a href="../../entbeans/ejb-intro/ejb-intro.html#_the_lifecycle_of_a_message_driven_bean" class="xref page">The Lifecycle of a Message-Driven Bean</a>.</p>
</div>
</div>
<div class="sect2">
<h3 id="_managing_jakarta_transactions"><a class="anchor" href="#_managing_jakarta_transactions"></a>Managing Jakarta Transactions</h3>
<div class="paragraph">
<p>Jakarta EE application clients and Java SE clients use JMS local transactions (described in <a href="jms-concepts.html#_using_jakarta_messaging_local_transactions" class="xref page">Using Jakarta Messaging Local Transactions</a>), which allow the grouping of sends and receives within a specific Messaging session.
Jakarta EE applications that run in the web or enterprise bean container commonly use Jakarta Transactions to ensure the integrity of accesses to external resources.
The key difference between a Jakarta transaction and a Jakarta Messaging local transaction is that a Jakarta transaction is controlled by the application server&#8217;s transaction managers.
Jakarta transactions may be distributed, which means that they can encompass multiple resources in the same transaction, such as a Messaging provider and a database.</p>
</div>
<div class="paragraph">
<p>For example, distributed transactions allow multiple applications to perform atomic updates on the same database, and they allow a single application to perform atomic updates on multiple databases.</p>
</div>
<div class="paragraph">
<p>In a Jakarta EE application that uses Jakarta Messaging, you can use transactions to combine message sends or receives with database updates and other resource manager operations.
You can access resources from multiple application components within a single transaction.
For example, a servlet can start a transaction, access multiple databases, invoke an enterprise bean that sends a Jakarta Messaging message, invoke another enterprise bean that modifies an EIS system using the Connectors, and finally commit the transaction.
Your application cannot, however, both send a Jakarta Messaging message and receive a reply to it within the same transaction.</p>
</div>
<div class="paragraph">
<p>Jakarta Transactions within the enterprise bean and web containers can be either of two kinds.</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Container-managed transactions: The container controls the integrity of your transactions without your having to call <code>commit</code> or <code>rollback</code>.
Container-managed transactions are easier to use than bean-managed transactions.
You can specify appropriate transaction attributes for your enterprise bean methods.</p>
<div class="paragraph">
<p>Use the <code>Required</code> transaction attribute (the default) to ensure that a method is always part of a transaction.
If a transaction is in progress when the method is called, the method will be part of that transaction; if not, a new transaction will be started before the method is called and will be committed when the method returns.
See <a href="../../supporttechs/transactions/transactions.html#_transaction_attributes" class="xref page">Transaction Attributes</a> for more information.</p>
</div>
</li>
<li>
<p>Bean-managed transactions: You can use these in conjunction with the <code>jakarta.transaction.UserTransaction</code> interface, which provides its own <code>commit</code> and <code>rollback</code> methods you can use to delimit transaction boundaries.
Bean-managed transactions are recommended only for those who are experienced in programming transactions.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>You can use either container-managed transactions or bean-managed transactions with message-driven beans.
To ensure that all messages are received and handled within the context of a transaction, use container-managed transactions and use the <code>Required</code> transaction attribute (the default) for the <code>onMessage</code> method.</p>
</div>
<div class="paragraph">
<p>When you use container-managed transactions, you can call the following <code>MessageDrivenContext</code> methods.</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>setRollbackOnly</code>: Use this method for error handling.
If an exception occurs, <code>setRollbackOnly</code> marks the current transaction so that the only possible outcome of the transaction is a rollback.</p>
</li>
<li>
<p><code>getRollbackOnly</code>: Use this method to test whether the current transaction has been marked for rollback.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>If you use bean-managed transactions, the delivery of a message to the <code>onMessage</code> method takes place outside the Jakarta transaction context.
The transaction begins when you call the <code>UserTransaction.begin</code> method within the <code>onMessage</code> method, and it ends when you call <code>UserTransaction.commit</code> or <code>UserTransaction.rollback</code>.
Any call to the <code>Connection.createSession</code> method must take place within the transaction.</p>
</div>
<div class="paragraph">
<p>Using bean-managed transactions allows you to process the message by using more than one transaction or to have some parts of the message processing take place outside a transaction context.
However, if you use container-managed transactions, the message is received by the MDB and processed by the <code>onMessage</code> method within the same transaction.
It is not possible to achieve this behavior with bean-managed transactions.</p>
</div>
<div class="paragraph">
<p>When you create a <code>JMSContext</code> in a Jakarta transaction (in the web or enterprise bean container), the container ignores any arguments you specify, because it manages all transactional properties.
When you create a <code>JMSContext</code> in the web or enterprise bean container and there is no Jakarta transaction, the value (if any) passed to the <code>createContext</code> method should be <code>JMSContext.AUTO_ACKNOWLEDGE</code> or <code>JMSContext.DUPS_OK_ACKNOWLEDGE</code>.</p>
</div>
<div class="paragraph">
<p>When you use container-managed transactions, you normally use the <code>Required</code> transaction attribute (the default) for your enterprise bean&#8217;s business methods.</p>
</div>
<div class="paragraph">
<p>You do not specify the activation configuration property <code>acknowledgeMode</code> when you create a message-driven bean that uses container-managed transactions.
The container acknowledges the message automatically when it commits the transaction.</p>
</div>
<div class="paragraph">
<p>If a message-driven bean uses bean-managed transactions, the message receipt cannot be part of the bean-managed transaction.
You can set the activation configuration property <code>acknowledgeMode</code> to <code>Auto-acknowledge</code> or <code>Dups-ok-acknowledge</code> to specify how you want the message received by the message-driven bean to be acknowledged.</p>
</div>
<div class="paragraph">
<p>If the <code>onMessage</code> method throws a <code>RuntimeException</code>, the container does not acknowledge processing the message.
In that case, the Messaging provider will redeliver the unacknowledged message in the future.</p>
</div>
</div>
</div>
</div>
</article>
  </div>
</main>
</div>
<footer class="footer">
  <p>This page was built using the Antora default UI.</p>
  <p>The source code for this UI is licensed under the terms of the MPL-2.0 license.</p>
</footer>
<script id="site-script" src="../../../../_/js/site.js" data-ui-root-path="../../../../_"></script>
<script async src="../../../../_/js/vendor/highlight.js"></script>
  </body>
</html>
