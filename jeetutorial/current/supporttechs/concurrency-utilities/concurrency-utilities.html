<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>Jakarta Concurrency :: Jakarta EE Documentation</title>
    <meta name="generator" content="Antora 3.1.3">
    <link rel="stylesheet" href="../../../../_/css/site.css">
    <script>var uiRootPath = '../../../../_'</script>
    <script>!function (theme) {
        if (theme === 'dark') document.documentElement.classList.add('theme-dark')
      }(localStorage && localStorage.getItem('theme') || (matchMedia('(prefers-color-scheme: dark)') && 'dark'))
    </script>
      </head>
  <body class="article">
<header class="header">
  <nav class="navbar">
    <div class="navbar-brand">
      <a id="site-title" class="navbar-item" href="../../../..">Jakarta EE Documentation</a>
      <button class="navbar-burger" data-target="topbar-nav">
        <span></span>
        <span></span>
        <span></span>
      </button>
    </div>
    <div id="topbar-nav" class="navbar-menu">
      <div class="navbar-end">
<!--
        <a class="navbar-item" href="#">Home</a>
        <div class="navbar-item has-dropdown is-hoverable">
          <a class="navbar-link" href="#">Products</a>
          <div class="navbar-dropdown">
            <a class="navbar-item" href="#">Product A</a>
            <a class="navbar-item" href="#">Product B</a>
            <a class="navbar-item" href="#">Product C</a>
          </div>
        </div>
        <div class="navbar-item has-dropdown is-hoverable">
          <a class="navbar-link" href="#">Services</a>
          <div class="navbar-dropdown">
            <a class="navbar-item" href="#">Service A</a>
            <a class="navbar-item" href="#">Service B</a>
            <a class="navbar-item" href="#">Service C</a>
          </div>
        </div>
 -->
        <div class="navbar-item">
          <span class="control">
            <a class="button is-primary" href="../../../../jakartaee-tutorial/10/jakarta-ee-tutorial.pdf">Download</a>
          </span>
        </div>
      </div>
      <div class="navbar-theme-switcher">
        <span class="switch" title="Switch between Light and Dark Theme">
          <input id="theme-switcher-checkbox" type="checkbox" />
          <label for="theme-switcher-checkbox">Dark Theme</label>
        </span>
      </div>
    </div>
  </nav>
</header>
<div class="body">
<div class="nav-container" data-component="jakartaee-tutorial" data-version="10">
  <aside class="nav">
    <div class="panels">
<div class="nav-panel-menu is-active" data-panel="menu">
  <nav class="nav-menu">
    <h3 class="title"><a href="../../index.html">Jakarta EE Tutorial</a></h3>
<ul class="nav-list">
  <li class="nav-item" data-depth="0">
    <button class="nav-item-toggle"></button>
    <span class="nav-text">Introduction</span>
<ul class="nav-list">
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="../../index.html">Preface</a>
  </li>
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="../../intro/usingexamples/usingexamples.html">Using the Tutorial Examples</a>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="0">
    <button class="nav-item-toggle"></button>
    <span class="nav-text">Jakarta EE Core Profile</span>
<ul class="nav-list">
  <li class="nav-item" data-depth="1">
    <button class="nav-item-toggle"></button>
    <span class="nav-text">Jakarta CDI Lite</span>
<ul class="nav-list">
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../../cdi/cdi-basic/cdi-basic.html">Introduction to Jakarta Contexts and Dependency Injection</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../../cdi/cdi-basicexamples/cdi-basicexamples.html">Running the Basic Contexts and Dependency Injection Examples</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../interceptors/interceptors.html">Using Jakarta EE Interceptors</a>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="1">
    <button class="nav-item-toggle"></button>
    <span class="nav-text">Jakarta REST</span>
<ul class="nav-list">
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../../websvcs/jaxrs/jaxrs.html">Building RESTful Web Services with Jakarta REST</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../../websvcs/jaxrs-client/jaxrs-client.html">Accessing REST Resources with the Jakarta REST Client API</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../../websvcs/jaxrs-advanced/jaxrs-advanced.html">Jakarta REST: Advanced Topics and an Example</a>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="1">
    <button class="nav-item-toggle"></button>
    <span class="nav-text">Jakarta JSON</span>
<ul class="nav-list">
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../../web/jsonb/jsonb.html">JSON Binding</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../../web/jsonp/jsonp.html">JSON Processing</a>
  </li>
</ul>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="0">
    <button class="nav-item-toggle"></button>
    <span class="nav-text">Jakarta EE Web Profile</span>
<ul class="nav-list">
  <li class="nav-item" data-depth="1">
    <button class="nav-item-toggle"></button>
    <span class="nav-text">Jakarta CDI Full</span>
<ul class="nav-list">
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../../cdi/cdi-adv/cdi-adv.html">Jakarta Contexts and Dependency Injection: Advanced Topics</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../../cdi/cdi-bootstrap-se8/cdi-bootstrap-se8.html">Bootstrapping a CDI Container in Java SE</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../../cdi/cdi-adv-examples/cdi-adv-examples.html">Running the Advanced Contexts and Dependency Injection Examples</a>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="1">
    <button class="nav-item-toggle"></button>
    <span class="nav-text">Jakarta Validation</span>
<ul class="nav-list">
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../../beanvalidation/bean-validation/bean-validation.html">Introduction to Jakarta Bean Validation</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../../beanvalidation/bean-validation-advanced/bean-validation-advanced.html">Bean Validation: Advanced Topics</a>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="../../security/security.html">Jakarta Security</a>
  </li>
  <li class="nav-item" data-depth="1">
    <button class="nav-item-toggle"></button>
    <span class="nav-text">Jakarta Servlets</span>
<ul class="nav-list">
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../../web/webapp/webapp.html">Getting Started with Web Applications</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../../web/servlets/servlets.html">Jakarta Servlet Technology</a>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="1">
    <button class="nav-item-toggle"></button>
    <span class="nav-text">Jakarta Faces</span>
<ul class="nav-list">
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../../web/faces-intro/faces-intro.html">Jakarta Faces Technology</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../../web/faces-facelets/faces-facelets.html">Introduction to Facelets</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../../web/faces-page/faces-page.html">Using Jakarta Faces Technology in Web Pages</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../../web/faces-page-core/faces-page-core.html">Using Converters, Listeners, and Validators</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../../web/faces-develop/faces-develop.html">Developing with Jakarta Faces Technology</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../../web/faces-ajax/faces-ajax.html">Using Ajax with Jakarta Faces Technology</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../../web/faces-advanced-cc/faces-advanced-cc.html">Composite Components: Advanced Topics and an Example</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../../web/faces-custom/faces-custom.html">Creating Custom UI Components and Other Custom Objects</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../../web/faces-configure/faces-configure.html">Configuring Jakarta Faces Applications</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../../web/faces-ws/faces-ws.html">Using WebSockets with Jakarta Faces Technology</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../../web/webi18n/webi18n.html">Internationalizing and Localizing Web Applications</a>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="../../web/websocket/websocket.html">Jakarta WebSocket</a>
  </li>
  <li class="nav-item" data-depth="1">
    <button class="nav-item-toggle"></button>
    <span class="nav-text">Jakarta Persistence</span>
<ul class="nav-list">
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../../persist/persistence-intro/persistence-intro.html">Introduction to Jakarta Persistence</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../../persist/persistence-basicexamples/persistence-basicexamples.html">Running the Persistence Examples</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../../persist/persistence-querylanguage/persistence-querylanguage.html">The Jakarta Persistence Query Language</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../../persist/persistence-criteria/persistence-criteria.html">Using the Criteria API to Create Queries</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../../persist/persistence-string-queries/persistence-string-queries.html">Creating and Using String-Based Criteria Queries</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../../persist/persistence-locking/persistence-locking.html">Controlling Concurrent Access to Entity Data with Locking</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../../persist/persistence-entitygraphs/persistence-entitygraphs.html">Creating Fetch Plans with Entity Graphs</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../../persist/persistence-cache/persistence-cache.html">Using a Second-Level Cache with Jakarta Persistence Applications</a>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="1">
    <button class="nav-item-toggle"></button>
    <span class="nav-text">Jakarta Enterprise Beans Lite</span>
<ul class="nav-list">
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../../entbeans/ejb-intro/ejb-intro.html">Enterprise Beans</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../../entbeans/ejb-gettingstarted/ejb-gettingstarted.html">Getting Started with Enterprise Beans</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../../entbeans/ejb-basicexamples/ejb-basicexamples.html">Running the Enterprise Bean Examples</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../../entbeans/ejb-async/ejb-async.html">Using Asynchronous Method Invocation in Session Beans</a>
  </li>
</ul>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="0">
    <button class="nav-item-toggle"></button>
    <span class="nav-text">Jakarta EE Platform</span>
<ul class="nav-list">
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="../../messaging/mail-api/mail-api.html">Jakarta Mail</a>
  </li>
  <li class="nav-item" data-depth="1">
    <button class="nav-item-toggle"></button>
    <span class="nav-text">Jakarta Messaging</span>
<ul class="nav-list">
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../../messaging/jms-concepts/jms-concepts.html">Jakarta Messaging Concepts</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../../messaging/jms-examples/jms-examples.html">Jakarta Messaging Examples</a>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="../batch-processing/batch-processing.html">Jakarta Batch</a>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="0">
    <button class="nav-item-toggle"></button>
    <span class="nav-text">Advanced</span>
<ul class="nav-list">
  <li class="nav-item" data-depth="1">
    <button class="nav-item-toggle"></button>
    <span class="nav-text">Web Profile</span>
<ul class="nav-list">
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../../security/security-authentication/security-authentication.html">Jakarta Authentication</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../../security/security-authorization/security-authorization.html">Jakarta Authorization</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../transactions/transactions.html">Jakarta Transactions</a>
  </li>
  <li class="nav-item is-current-page" data-depth="2">
    <a class="nav-link" href="concurrency-utilities.html">Jakarta Concurrency</a>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="1">
    <button class="nav-item-toggle"></button>
    <span class="nav-text">Jakarta EE Platform</span>
<ul class="nav-list">
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../connectors/connectors.html">Jakarta Connectors</a>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="1">
    <button class="nav-item-toggle"></button>
    <span class="nav-text">Optional Components</span>
<ul class="nav-list">
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../../web/faces-el/faces-el.html">Jakarta Expression Language</a>
  </li>
  <li class="nav-item" data-depth="2">
    <span class="nav-text">Jakarta XML Binding</span>
  </li>
</ul>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="0">
    <button class="nav-item-toggle"></button>
    <span class="nav-text">Archived</span>
<ul class="nav-list">
  <li class="nav-item" data-depth="1">
    <button class="nav-item-toggle"></button>
    <span class="nav-text">Web Profile</span>
<ul class="nav-list">
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../../web/jakarta-pages/jakarta-pages.html">Jakarta Pages</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../../web/jakarta-tags/jakarta-tags.html">Jakarta Tags</a>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="1">
    <button class="nav-item-toggle"></button>
    <span class="nav-text">Jakarta EE Platform</span>
<ul class="nav-list">
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../../websvcs/xml-websvcs/xml-websvcs.html">XML Web Services</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../../entbeans/ejb-full/ejb-full.html">Jakarta Enterprise Beans Full</a>
  </li>
</ul>
  </li>
</ul>
  </li>
</ul>
  </nav>
</div>
<div class="nav-panel-explore" data-panel="explore">
  <div class="context">
    <span class="title">Jakarta EE Tutorial</span>
    <span class="version">10</span>
  </div>
  <ul class="components">
    <li class="component is-current">
      <a class="title" href="../../index.html">Jakarta EE Tutorial</a>
      <ul class="versions">
        <li class="version is-current is-latest">
          <a href="../../index.html">10</a>
        </li>
        <li class="version">
          <a href="../../../9.1/index.html">9.1</a>
        </li>
      </ul>
    </li>
  </ul>
</div>
    </div>
  </aside>
</div>
<main class="article">
<div class="toolbar" role="navigation">
<button class="nav-toggle"></button>
<nav class="breadcrumbs" aria-label="breadcrumbs">
  <ul>
    <li><a href="../../index.html">Jakarta EE Tutorial</a></li>
    <li>Advanced</li>
    <li>Web Profile</li>
    <li><a href="concurrency-utilities.html">Jakarta Concurrency</a></li>
  </ul>
</nav>
<div class="page-versions">
  <button class="version-menu-toggle" title="Show other versions of page">10</button>
  <div class="version-menu">
    <a class="version is-current" href="concurrency-utilities.html">10</a>
    <a class="version" href="../../../9.1/supporttechs/concurrency-utilities/concurrency-utilities.html">9.1</a>
  </div>
</div>
  <div class="edit-this-page"><a href="file:///home/john/workspace/virtua/jakartaee-tutorial/src/main/antora/modules/supporttechs/pages/concurrency-utilities/concurrency-utilities.adoc">Edit this Page</a></div>
</div>
  <div class="content">
<aside class="toc sidebar" data-title="Contents" data-levels="2">
  <div class="toc-menu"></div>
</aside>
<article class="doc">
<h1 class="page">Jakarta Concurrency</h1>
<div id="preamble">
<div class="sectionbody">
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>We are working on a fresh, updated Jakarta EE Tutorial. This section hasn&#8217;t yet been updated.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>This chapter describes Jakarta Concurrency spec.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_concurrency_basics"><a class="anchor" href="#_concurrency_basics"></a>Concurrency Basics</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Concurrency is the concept of executing two or more tasks at the same time (in parallel).
Tasks may include methods (functions), parts of a program, or even other programs.
With current computer architectures, support for multiple cores and multiple processors in a single CPU is very common.</p>
</div>
<div class="paragraph">
<p>The Java Platform has always offered support for concurrent programming, which was the basis for implementing many of the services offered by Jakarta EE containers.
Since Java SE 5, additional high-level API support for concurrency was provided by the <code>java.util.concurrent</code> package.</p>
</div>
<div class="sect2">
<h3 id="_threads_and_processes"><a class="anchor" href="#_threads_and_processes"></a>Threads and Processes</h3>
<div class="paragraph">
<p>The two main concurrency concepts are processes and threads.</p>
</div>
<div class="paragraph">
<p>Processes are primarily associated with applications running on the operating system (OS).
A process has specific runtime resources to interact with the underlying OS and allocate other resources, such as its own memory, just as the JVM process does.
A JVM is in fact a process.</p>
</div>
<div class="paragraph">
<p>The Java programming language and platform are primarily concerned with threads.</p>
</div>
<div class="paragraph">
<p>Threads share some features with processes, since both consume resources from the OS or the execution environment.
But threads are easier to create and consume many fewer resources than a process.</p>
</div>
<div class="paragraph">
<p>Because threads are so lightweight, any modern CPU that has a couple of cores and a few gigabytes of RAM can handle thousands of threads in a single JVM process.
The precise number of threads will depend on the combined output of the CPU, OS, and RAM available, as well as on correct configuration (tuning) of the JVM.</p>
</div>
<div class="paragraph">
<p>Although concurrent programming solves many problems and can improve performance for most applications, there are a number of situations where multiple execution lines (threads or processes) can cause major problems.
These situations include the following:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Deadlocks</p>
</li>
<li>
<p>Thread starvation</p>
</li>
<li>
<p>Concurrent accessing of shared resources</p>
</li>
<li>
<p>Situations when the program generates incorrect data</p>
</li>
</ul>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_main_components_of_the_concurrency_utilities"><a class="anchor" href="#_main_components_of_the_concurrency_utilities"></a>Main Components of the Concurrency Utilities</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Concurrent resources are managed objects that provide concurrency capabilities to Jakarta EE applications.
In GlassFish Server, you configure concurrent resources and then make them available for use by application components such as servlets and enterprise beans.
Concurrent resources are accessed through JNDI lookup or resource injection.</p>
</div>
<div class="paragraph">
<p>The primary components of the concurrency utilities are as follows.</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>ManagedExecutorService</code>: A managed executor service is used by applications to execute submitted tasks asynchronously.
Tasks are executed on threads that are started and managed by the container.
The context of the container is propagated to the thread executing the task.</p>
<div class="paragraph">
<p>For example, by using an <code>ManagedExecutorService.submit()</code> call, a task, such as the GenerateReportTask, could be submitted to execute at a later time and then, by using the <code>Future</code> object callback, retrieve the result when it becomes available.</p>
</div>
</li>
<li>
<p><code>ManagedScheduledExecutorService</code>: A managed scheduled executor service is used by applications to execute submitted tasks asynchronously at specific times.
Tasks are executed on threads that are started and managed by the container.
The context of the container is propagated to the thread executing the task.
The API provides the scheduling functionality that allows users to set a specific date/time for the Task execution programmatically in the application.</p>
</li>
<li>
<p><code>ContextService</code>: A context service is used to create dynamic proxy objects that capture the context of a container and enable applications to run within that context at a later time or be submitted to a Managed Executor Service.
The context of the container is propagated to the thread executing the task.</p>
</li>
<li>
<p><code>ManagedThreadFactory</code>: A managed thread factory is used by applications to create managed threads.
The threads are started and managed by the container.
The context of the container is propagated to the thread executing the task.
This object can also be used to provide custom factories for specific use cases (with custom Threads) and, for example, set specific/proprietary properties to these objects.</p>
</li>
</ul>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_concurrency_and_transactions"><a class="anchor" href="#_concurrency_and_transactions"></a>Concurrency and Transactions</h2>
<div class="sectionbody">
<div class="paragraph">
<p>The most basic operations for transactions are commit and rollback, but, in a distributed environment with concurrent processing, it can be difficult to guarantee that commit or rollback operations will be successfully processed, and the transaction can be spread among different threads, CPU cores, physical machines, and networks.</p>
</div>
<div class="paragraph">
<p>Ensuring that a rollback operation will successfully execute in such a scenario is crucial.
Concurrency Utilities relies on Jakarta Transactions to implement and support transactions on its components through <code>jakarta.transaction.UserTransaction</code>, allowing application developers to explicitly manage transaction boundaries.
More information is available in the Jakarta Transactions specification.</p>
</div>
<div class="paragraph">
<p>Optionally, context objects can begin, commit, or roll back transactions, but these objects cannot enlist in parent component transactions.</p>
</div>
<div class="paragraph">
<p>The following code snippet illustrates a <code>Runnable</code> task that obtains a <code>UserTransaction</code> and then starts and commits a transaction while interacting with other transactional components, such as an enterprise bean and a database:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">public class MyTransactionalTask implements Runnable {

   UserTransaction ut = ... // obtained through JNDI or injection

   public void run() {

       // Start a transaction
       ut.begin();

       // Invoke a Service or an EJB
       myEJB.businessMethod();

       // Update a database entity using an XA JDBC driver
       myEJB.updateCustomer(customer);

       // Commit the transaction
       ut.commit();

   }
}</code></pre>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_concurrency_and_security"><a class="anchor" href="#_concurrency_and_security"></a>Concurrency and Security</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Jakarta Concurrency defers most security decisions to the application server implementation.
If, however, the container supports a security context, that context can be propagated to the thread of execution.
The <code>ContextService</code> can support several runtime behaviors, and the <code>security</code> attribute, if enabled, will propagate the container security principal.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_the_jobs_concurrency_example"><a class="anchor" href="#_the_jobs_concurrency_example"></a>The jobs Concurrency Example</h2>
<div class="sectionbody">
<div class="paragraph">
<p>This section describes a very basic example that shows how to use some of the basic concurrency features in an enterprise application.
Specifically, this example uses one of the main components of Jakarta Concurrency, a Managed Executor Service.</p>
</div>
<div class="paragraph">
<p>The example demonstrates a scenario where a RESTful web service, exposed as a public API, is used to submit generic jobs for execution.
These jobs are processed in the background.
Each job prints a "Starting" and a "Finished" message at the beginning and end of the execution.
Also, to simulate background processing, each job takes 10 seconds to execute.</p>
</div>
<div class="paragraph">
<p>The RESTful service exposes two methods:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>/token</code>: Exposed as a GET method that registers and returns valid API tokens</p>
</li>
<li>
<p><code>/process</code>: Exposed as a POST method that receives a <code>jobID</code> query parameter, which is the identifier for the job to be executed, and a custom HTTP header named <code>X-REST-API-Key,</code> which will be used internally to validate requests with tokens</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>The token is used to differentiate the Quality of Service (QoS) offered by the API.
Users that provide a token in a service request can process multiple concurrent jobs.
However, users that do not provide a token can process only one job at a time.
Since every job takes 10 seconds to execute, users that provide no token will be able to execute only one call to the service every 10 seconds.
For users that provide a token, processing will be much faster.</p>
</div>
<div class="paragraph">
<p>This differentiation is made possible by the use of two different Managed Executor Services, one for each type of request.</p>
</div>
<div class="sect2">
<h3 id="_running_the_jobs_example"><a class="anchor" href="#_running_the_jobs_example"></a>Running the jobs Example</h3>
<div class="paragraph">
<p>After configuring GlassFish Server by adding two Managed Executor Services, you can use either NetBeans IDE or Maven to build, package, deploy, and run the <code>jobs</code> example.</p>
</div>
<div class="sect3">
<h4 id="_to_configure_glassfish_server_for_the_basic_concurrency_example"><a class="anchor" href="#_to_configure_glassfish_server_for_the_basic_concurrency_example"></a>To Configure GlassFish Server for the Basic Concurrency Example</h4>
<div class="paragraph">
<p>To configure GlassFish Server, follow these steps.</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Open the Administration Console at <a href="http://localhost:4848" class="bare" target="_blank" rel="noopener">http://localhost:4848</a>.</p>
</li>
<li>
<p>Expand the Resources node.</p>
</li>
<li>
<p>Expand the Concurrent Resources node.</p>
</li>
<li>
<p>Click Managed Executor Services.</p>
</li>
<li>
<p>On the Managed Executor Services page, click New to open the New Managed Executor Services page.</p>
</li>
<li>
<p>In the JNDI Name field, enter <code>MES_High</code> to create the high-priority Managed Executor Service.
Use the following settings (keep the default values for other settings):</p>
<div class="ulist">
<ul>
<li>
<p>Thread Priority: 10</p>
</li>
<li>
<p>Core Size: 2</p>
</li>
<li>
<p>Maximum Pool Size: 5</p>
</li>
<li>
<p>Task Queue Capacity: 2</p>
</li>
</ul>
</div>
</li>
<li>
<p>Click OK.</p>
</li>
<li>
<p>On the On the Managed Executor Services page, click New again.</p>
</li>
<li>
<p>In the JNDI Name field, enter <code>MES_Low</code> to create the low-priority Managed Executor Service.
Use the following settings (keep the default values for other settings):</p>
<div class="ulist">
<ul>
<li>
<p>Thread Priority: 1</p>
</li>
<li>
<p>Core Size: 1</p>
</li>
<li>
<p>Maximum Pool Size: 1</p>
</li>
<li>
<p>Task Queue Capacity: 0</p>
</li>
</ul>
</div>
</li>
<li>
<p>Click OK.</p>
</li>
</ol>
</div>
</div>
<div class="sect3">
<h4 id="_to_build_package_and_deploy_the_jobs_example_using_netbeans_ide"><a class="anchor" href="#_to_build_package_and_deploy_the_jobs_example_using_netbeans_ide"></a>To Build, Package, and Deploy the jobs Example Using NetBeans IDE</h4>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Make sure that GlassFish Server has been started (see <a href="../../intro/usingexamples/usingexamples.html#_starting_and_stopping_glassfish_server" class="xref page">Starting and Stopping GlassFish Server</a>).</p>
</li>
<li>
<p>From the File menu, choose Open Project.</p>
</li>
<li>
<p>In the Open Project dialog box, navigate to:</p>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-asciidoc hljs" data-lang="asciidoc">jakartaee-examples/tutorial/concurrency</code></pre>
</div>
</div>
</li>
<li>
<p>Select the <code>jobs</code> folder.</p>
</li>
<li>
<p>Click Open Project.</p>
</li>
<li>
<p>In the Projects tab, right-click the <code>jobs</code> project and select Build.</p>
<div class="paragraph">
<p>This command builds and deploys the application.</p>
</div>
</li>
</ol>
</div>
</div>
<div class="sect3">
<h4 id="_to_build_package_and_deploy_the_jobs_example_using_maven"><a class="anchor" href="#_to_build_package_and_deploy_the_jobs_example_using_maven"></a>To Build, Package, and Deploy the jobs Example Using Maven</h4>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Make sure that GlassFish Server has been started (see <a href="../../intro/usingexamples/usingexamples.html#_starting_and_stopping_glassfish_server" class="xref page">Starting and Stopping GlassFish Server</a>).</p>
</li>
<li>
<p>In a terminal window, go to:</p>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-asciidoc hljs" data-lang="asciidoc">jakartaee-examples/tutorial/concurrency/jobs</code></pre>
</div>
</div>
</li>
<li>
<p>Enter the following command to build and deploy the application:</p>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-shell hljs" data-lang="shell">mvn install</code></pre>
</div>
</div>
</li>
</ol>
</div>
</div>
<div class="sect3">
<h4 id="_to_run_the_jobs_example_and_submit_jobs_with_low_priority"><a class="anchor" href="#_to_run_the_jobs_example_and_submit_jobs_with_low_priority"></a>To Run the jobs Example and Submit Jobs with Low Priority</h4>
<div class="paragraph">
<p>To run the example as a user who submits jobs with low priority, follow
these steps:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>In a web browser, enter the following URL:</p>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-asciidoc hljs" data-lang="asciidoc">http://localhost:8080/jobs</code></pre>
</div>
</div>
</li>
<li>
<p>In the Jobs Client page, enter the value 1 in the Enter a JobID field, enter nothing in the Enter a Token field, then click Submit Job.</p>
<div class="paragraph">
<p>The following message should be displayed at the bottom of the page:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-asciidoc hljs" data-lang="asciidoc">Job 1 successfully submitted</code></pre>
</div>
</div>
<div class="paragraph">
<p>The server log includes the following messages:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-asciidoc hljs" data-lang="asciidoc">INFO:   Invalid or missing token!
INFO:   Task started LOW-1
INFO:   Job 1 successfully submitted
INFO:   Task finished LOW-1</code></pre>
</div>
</div>
<div class="paragraph">
<p>You submitted a job with low priority.
This means that you cannot submit another job for 10 seconds.
If you try to do so, the RESTful API will return a service unavailable (HTTP 503) response and the following message will be displayed at the bottom of the page:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-asciidoc hljs" data-lang="asciidoc">Job 2 was NOT submitted</code></pre>
</div>
</div>
<div class="paragraph">
<p>The server log will include the following messages:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-asciidoc hljs" data-lang="asciidoc">INFO:   Invalid or missing token!
INFO:   Job 1 successfully submitted
INFO:   Task started LOW-1
INFO:   Invalid or missing token!
INFO:   Job 2 was NOT submitted
INFO:   Task finished LOW-1</code></pre>
</div>
</div>
</li>
</ol>
</div>
</div>
<div class="sect3">
<h4 id="_to_run_the_jobs_example_and_submit_jobs_with_high_priority"><a class="anchor" href="#_to_run_the_jobs_example_and_submit_jobs_with_high_priority"></a>To Run the jobs Example and Submit Jobs with High Priority</h4>
<div class="paragraph">
<p>To run the example as a user who submits jobs with high priority, follow these steps:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>In a web browser, enter the following URL:</p>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-asciidoc hljs" data-lang="asciidoc">http://localhost:8080/jobs</code></pre>
</div>
</div>
</li>
<li>
<p>In the Jobs Client page, enter a value of one to ten digits in the Enter a JobID field.</p>
</li>
<li>
<p>Click the here link on the line "Get a token here" to get a token.
The page that displays the token will open in a new tab.</p>
</li>
<li>
<p>Copy the token and return to the Jobs Client page.</p>
</li>
<li>
<p>Paste the token in the Enter a Token field, then click Submit Job.</p>
<div class="paragraph">
<p>A message like the following should be displayed at the bottom of the page:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-asciidoc hljs" data-lang="asciidoc">Job 11 successfully submitted</code></pre>
</div>
</div>
<div class="paragraph">
<p>The server log includes the following messages:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-asciidoc hljs" data-lang="asciidoc">INFO:   Token accepted. Execution with high priority.
INFO:   Task started HIGH-11
INFO:   Job 11 successfully submitted
INFO:   Task finished HIGH-11</code></pre>
</div>
</div>
<div class="paragraph">
<p>You submitted a job with high priority.
This means that you can submit multiple jobs, each with a token, and not face the 10 second per job restriction that the low priority submitters face.
If you submit 3 jobs with tokens in rapid succession, messages like the following will be displayed at the bottom of the page:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-asciidoc hljs" data-lang="asciidoc">Job 1 was submitted
Job 2 was submitted
Job 3 was submitted</code></pre>
</div>
</div>
<div class="paragraph">
<p>The server log will include the following messages:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-asciidoc hljs" data-lang="asciidoc">INFO:   Token accepted. Execution with high priority.
INFO:   Task started HIGH-1
INFO:   Job 1 successfully submitted
INFO:   Token accepted. Execution with high priority.
INFO:   Task started HIGH-2
INFO:   Job 2 successfully submitted
INFO:   Task finished HIGH-1
INFO:   Token accepted. Execution with high priority.
INFO:   Task started HIGH-3
INFO:   Job 3 successfully submitted
INFO:   Task finished HIGH-2
INFO:   Task finished HIGH-3</code></pre>
</div>
</div>
</li>
</ol>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_the_taskcreator_concurrency_example"><a class="anchor" href="#_the_taskcreator_concurrency_example"></a>The taskcreator Concurrency Example</h2>
<div class="sectionbody">
<div class="paragraph">
<p>The <code>taskcreator</code> example demonstrates how to use Jakarta Concurrency to run tasks immediately, periodically, or after a fixed delay.
This example provides a Jakarta Faces interface that enables users to submit tasks to be executed and displays information messages for each task.
The example uses the Managed Executor Service to run tasks immediately and the Managed Scheduled Executor Service to run tasks periodically or after a fixed delay.
(See <a href="#_main_components_of_the_concurrency_utilities">Main Components of the Concurrency Utilities</a> for information about these services.)</p>
</div>
<div class="paragraph">
<p>The <code>taskcreator</code> example consists of the following components.</p>
</div>
<div class="ulist">
<ul>
<li>
<p>A Jakarta Faces page (<code>index.xhtml</code>) that contains three elements: a form to submit tasks, a task execution log, and a form to cancel periodic tasks.
This page submits Ajax requests to create and cancel tasks.
This page also receives WebSocket messages, using JavaScript code to update the task execution log.</p>
</li>
<li>
<p>A CDI managed bean (<code>TaskCreatorBean</code>) that processes the requests from the Jakarta Faces page.
This bean invokes the methods in <code>TaskEJB</code> to submit new tasks and to cancel periodic tasks.</p>
</li>
<li>
<p>An enterprise bean (<code>TaskEJB</code>) that obtains executor service instances using resource injection and submits tasks for execution.
This bean is also a Jakarta RESTful web service endpoint.
The tasks send information messages to this endpoint.</p>
</li>
<li>
<p>A WebSocket endpoint (<code>InfoEndpoint</code>) that the enterprise bean uses to send information messages to the clients.</p>
</li>
<li>
<p>A task class (<code>Task</code>) that implements the <code>Runnable</code> interface.
The <code>run</code> method in this class sends information messages to the web service endpoint in <code>TaskEJB</code> and sleeps for 1.5 seconds.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p><a href="#_architecture_of_the_taskcreator_example">Figure 1, &#8220;Architecture of the taskcreator Example&#8221;</a> shows the architecture of the <code>taskcreator</code> example.</p>
</div>
<div id="_architecture_of_the_taskcreator_example" class="imageblock">
<div class="content">
<img src="../../common/_images/jakartaeett_dt_060.svg" alt="The figure shows the architecture of the taskcreator example. The Jakarta Faces page invokes methods on a CDI-managed bean, which submits task initiation requests to an enterprise bean. The enterprise bean uses a WebSocket endpoint to indicate to clients that an updated task execution log is available.">
</div>
<div class="title">Figure 1. Architecture of the taskcreator Example</div>
</div>
<div class="paragraph">
<p>The <code>TaskEJB</code> class obtains the default executor service objects from the application server as follows:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">@Resource(name="java:comp/DefaultManagedExecutorService")
ManagedExecutorService mExecService;

@Resource(name="java:comp/DefaultManagedScheduledExecutorService")
ManagedScheduledExecutorService sExecService;</code></pre>
</div>
</div>
<div class="paragraph">
<p>The <code>submitTask</code> method in <code>TaskEJB</code> uses these objects to submit tasks for execution as follows:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">public void submitTask(Task task, String type) {
    /* Use the managed executor objects from the app server */
    switch (type) {
        case "IMMEDIATE":
            mExecService.submit(task);
            break;
        case "DELAYED":
            sExecService.schedule(task, 3, TimeUnit.SECONDS);
            break;
        case "PERIODIC":
            ScheduledFuture&lt;?&gt; fut;
            fut = sExecService.scheduleAtFixedRate(task, 0, 8,
                    TimeUnit.SECONDS);
            periodicTasks.put(task.getName(), fut);
            break;
    }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>For periodic tasks, <code>TaskEJB</code> keeps a reference to the <code>ScheduledFuture</code> object, so that the user can cancel the task at any time.</p>
</div>
<div class="sect2">
<h3 id="_running_the_taskcreator_example"><a class="anchor" href="#_running_the_taskcreator_example"></a>Running the taskcreator Example</h3>
<div class="paragraph">
<p>This section describes how to build, package, deploy, and run the <code>taskcreator</code> example using NetBeans IDE or Maven.</p>
</div>
<div class="sect3">
<h4 id="_to_build_package_and_deploy_the_taskcreator_example_using_netbeans_ide"><a class="anchor" href="#_to_build_package_and_deploy_the_taskcreator_example_using_netbeans_ide"></a>To Build, Package, and Deploy the taskcreator Example Using NetBeans IDE</h4>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Make sure that GlassFish Server has been started (see <a href="../../intro/usingexamples/usingexamples.html#_starting_and_stopping_glassfish_server" class="xref page">Starting and Stopping GlassFish Server</a>).</p>
</li>
<li>
<p>From the File menu, choose Open Project.</p>
</li>
<li>
<p>In the Open Project dialog box, navigate to:</p>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-asciidoc hljs" data-lang="asciidoc">jakartaee-examples/tutorial/concurrency</code></pre>
</div>
</div>
</li>
<li>
<p>Select the <code>taskcreator</code> folder.</p>
</li>
<li>
<p>Click Open Project.</p>
</li>
<li>
<p>In the Projects tab, right-click the <code>taskcreator</code> project and select Build.</p>
<div class="paragraph">
<p>This command builds and deploys the application.</p>
</div>
</li>
</ol>
</div>
</div>
<div class="sect3">
<h4 id="_to_build_package_and_deploy_the_taskcreator_example_using_maven"><a class="anchor" href="#_to_build_package_and_deploy_the_taskcreator_example_using_maven"></a>To Build, Package, and Deploy the taskcreator Example Using Maven</h4>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Make sure that GlassFish Server has been started (see <a href="../../intro/usingexamples/usingexamples.html#_starting_and_stopping_glassfish_server" class="xref page">Starting and Stopping GlassFish Server</a>).</p>
</li>
<li>
<p>In a terminal window, go to:</p>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-asciidoc hljs" data-lang="asciidoc">jakartaee-examples/tutorial/concurrency/taskcreator</code></pre>
</div>
</div>
</li>
<li>
<p>Enter the following command to build and deploy the application:</p>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-shell hljs" data-lang="shell">mvn install</code></pre>
</div>
</div>
</li>
</ol>
</div>
</div>
<div class="sect3">
<h4 id="_to_run_the_taskcreator_example"><a class="anchor" href="#_to_run_the_taskcreator_example"></a>To Run the taskcreator Example</h4>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Open the following URL in a web browser:</p>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-asciidoc hljs" data-lang="asciidoc">http://localhost:8080/taskcreator/</code></pre>
</div>
</div>
<div class="paragraph">
<p>The page contains a form to submit tasks, a task execution log, and a form to cancel periodic tasks.</p>
</div>
</li>
<li>
<p>Select the Immediate task type, enter a task name, and click the Submit button.
Messages like the following appear in the task execution log:</p>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-asciidoc hljs" data-lang="asciidoc">12:40:47 - IMMEDIATE Task TaskA finished
12:40:45 - IMMEDIATE Task TaskA started</code></pre>
</div>
</div>
</li>
<li>
<p>Select the Delayed (3 sec) task type, enter a task name, and click the Submit button.
Messages like the following appear in the task execution log:</p>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-asciidoc hljs" data-lang="asciidoc">12:43:26 - DELAYED Task TaskB finished
12:43:25 - DELAYED Task TaskB started
12:43:22 - DELAYED Task TaskB submitted</code></pre>
</div>
</div>
</li>
<li>
<p>Select the Periodic (8 sec) task type, enter a task name, and click the Submit button.
Messages like the following appear in the task execution log:</p>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-asciidoc hljs" data-lang="asciidoc">12:45:25 - PERIODIC Task TaskC finished run #2
12:45:23 - PERIODIC Task TaskC started run #2
12:45:17 - PERIODIC Task TaskC finished run #1
12:45:15 - PERIODIC Task TaskC started run #1</code></pre>
</div>
</div>
<div class="paragraph">
<p>You can add more than one periodic task.
To cancel a periodic task, select it from the form and click Cancel Task.</p>
</div>
</li>
</ol>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_further_information_about_jakarta_concurrency"><a class="anchor" href="#_further_information_about_jakarta_concurrency"></a>Further Information about Jakarta Concurrency</h2>
<div class="sectionbody">
<div class="paragraph">
<p>For more information about concurrency, see</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Jakarta Concurrency 2.0 specification:<br>
<a href="https://jakarta.ee/specifications/concurrency/2.0/" class="bare" target="_blank" rel="noopener">https://jakarta.ee/specifications/concurrency/2.0/</a></p>
</li>
<li>
<p>Concurrency Lesson in The Java Tutorials:<br>
<a href="https://docs.oracle.com/javase/tutorial/essential/concurrency/" class="bare" target="_blank" rel="noopener">https://docs.oracle.com/javase/tutorial/essential/concurrency/</a></p>
</li>
</ul>
</div>
</div>
</div>
</article>
  </div>
</main>
</div>
<footer class="footer">
  <p>This page was built using the Antora default UI.</p>
  <p>The source code for this UI is licensed under the terms of the MPL-2.0 license.</p>
</footer>
<script id="site-script" src="../../../../_/js/site.js" data-ui-root-path="../../../../_"></script>
<script async src="../../../../_/js/vendor/highlight.js"></script>
  </body>
</html>
