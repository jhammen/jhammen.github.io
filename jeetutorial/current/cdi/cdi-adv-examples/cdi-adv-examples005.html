<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>Untitled :: Jakarta EE Documentation</title>
    <meta name="generator" content="Antora 3.1.3">
    <link rel="stylesheet" href="../../../../_/css/site.css">
    <script>var uiRootPath = '../../../../_'</script>
    <script>!function (theme) {
        if (theme === 'dark') document.documentElement.classList.add('theme-dark')
      }(localStorage && localStorage.getItem('theme') || (matchMedia('(prefers-color-scheme: dark)') && 'dark'))
    </script>
      </head>
  <body class="article">
<header class="header">
  <nav class="navbar">
    <div class="navbar-brand">
      <a id="site-title" class="navbar-item" href="../../../..">Jakarta EE Documentation</a>
      <button class="navbar-burger" data-target="topbar-nav">
        <span></span>
        <span></span>
        <span></span>
      </button>
    </div>
    <div id="topbar-nav" class="navbar-menu">
      <div class="navbar-end">
<!--
        <a class="navbar-item" href="#">Home</a>
        <div class="navbar-item has-dropdown is-hoverable">
          <a class="navbar-link" href="#">Products</a>
          <div class="navbar-dropdown">
            <a class="navbar-item" href="#">Product A</a>
            <a class="navbar-item" href="#">Product B</a>
            <a class="navbar-item" href="#">Product C</a>
          </div>
        </div>
        <div class="navbar-item has-dropdown is-hoverable">
          <a class="navbar-link" href="#">Services</a>
          <div class="navbar-dropdown">
            <a class="navbar-item" href="#">Service A</a>
            <a class="navbar-item" href="#">Service B</a>
            <a class="navbar-item" href="#">Service C</a>
          </div>
        </div>
 -->
        <div class="navbar-item">
          <span class="control">
            <a class="button is-primary" href="../../../../jakartaee-tutorial/10/jakarta-ee-tutorial.pdf">Download</a>
          </span>
        </div>
      </div>
      <div class="navbar-theme-switcher">
        <span class="switch" title="Switch between Light and Dark Theme">
          <input id="theme-switcher-checkbox" type="checkbox" />
          <label for="theme-switcher-checkbox">Dark Theme</label>
        </span>
      </div>
    </div>
  </nav>
</header>
<div class="body">
<div class="nav-container" data-component="jakartaee-tutorial" data-version="10">
  <aside class="nav">
    <div class="panels">
<div class="nav-panel-menu is-active" data-panel="menu">
  <nav class="nav-menu">
    <h3 class="title"><a href="../../index.html">Jakarta EE Tutorial</a></h3>
<ul class="nav-list">
  <li class="nav-item" data-depth="0">
    <button class="nav-item-toggle"></button>
    <span class="nav-text">Introduction</span>
<ul class="nav-list">
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="../../index.html">Preface</a>
  </li>
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="../../intro/usingexamples/usingexamples.html">Using the Tutorial Examples</a>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="0">
    <button class="nav-item-toggle"></button>
    <span class="nav-text">Jakarta EE Core Profile</span>
<ul class="nav-list">
  <li class="nav-item" data-depth="1">
    <button class="nav-item-toggle"></button>
    <span class="nav-text">Jakarta CDI Lite</span>
<ul class="nav-list">
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../cdi-basic/cdi-basic.html">Introduction to Jakarta Contexts and Dependency Injection</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../cdi-basicexamples/cdi-basicexamples.html">Running the Basic Contexts and Dependency Injection Examples</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../../supporttechs/interceptors/interceptors.html">Using Jakarta EE Interceptors</a>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="1">
    <button class="nav-item-toggle"></button>
    <span class="nav-text">Jakarta REST</span>
<ul class="nav-list">
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../../websvcs/jaxrs/jaxrs.html">Building RESTful Web Services with Jakarta REST</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../../websvcs/jaxrs-client/jaxrs-client.html">Accessing REST Resources with the Jakarta REST Client API</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../../websvcs/jaxrs-advanced/jaxrs-advanced.html">Jakarta REST: Advanced Topics and an Example</a>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="1">
    <button class="nav-item-toggle"></button>
    <span class="nav-text">Jakarta JSON</span>
<ul class="nav-list">
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../../web/jsonb/jsonb.html">JSON Binding</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../../web/jsonp/jsonp.html">JSON Processing</a>
  </li>
</ul>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="0">
    <button class="nav-item-toggle"></button>
    <span class="nav-text">Jakarta EE Web Profile</span>
<ul class="nav-list">
  <li class="nav-item" data-depth="1">
    <button class="nav-item-toggle"></button>
    <span class="nav-text">Jakarta CDI Full</span>
<ul class="nav-list">
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../cdi-adv/cdi-adv.html">Jakarta Contexts and Dependency Injection: Advanced Topics</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../cdi-bootstrap-se8/cdi-bootstrap-se8.html">Bootstrapping a CDI Container in Java SE</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="cdi-adv-examples.html">Running the Advanced Contexts and Dependency Injection Examples</a>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="1">
    <button class="nav-item-toggle"></button>
    <span class="nav-text">Jakarta Validation</span>
<ul class="nav-list">
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../../beanvalidation/bean-validation/bean-validation.html">Introduction to Jakarta Bean Validation</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../../beanvalidation/bean-validation-advanced/bean-validation-advanced.html">Bean Validation: Advanced Topics</a>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="../../security/security.html">Jakarta Security</a>
  </li>
  <li class="nav-item" data-depth="1">
    <button class="nav-item-toggle"></button>
    <span class="nav-text">Jakarta Servlets</span>
<ul class="nav-list">
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../../web/webapp/webapp.html">Getting Started with Web Applications</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../../web/servlets/servlets.html">Jakarta Servlet Technology</a>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="1">
    <button class="nav-item-toggle"></button>
    <span class="nav-text">Jakarta Faces</span>
<ul class="nav-list">
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../../web/faces-intro/faces-intro.html">Jakarta Faces Technology</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../../web/faces-facelets/faces-facelets.html">Introduction to Facelets</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../../web/faces-page/faces-page.html">Using Jakarta Faces Technology in Web Pages</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../../web/faces-page-core/faces-page-core.html">Using Converters, Listeners, and Validators</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../../web/faces-develop/faces-develop.html">Developing with Jakarta Faces Technology</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../../web/faces-ajax/faces-ajax.html">Using Ajax with Jakarta Faces Technology</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../../web/faces-advanced-cc/faces-advanced-cc.html">Composite Components: Advanced Topics and an Example</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../../web/faces-custom/faces-custom.html">Creating Custom UI Components and Other Custom Objects</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../../web/faces-configure/faces-configure.html">Configuring Jakarta Faces Applications</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../../web/faces-ws/faces-ws.html">Using WebSockets with Jakarta Faces Technology</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../../web/webi18n/webi18n.html">Internationalizing and Localizing Web Applications</a>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="../../web/websocket/websocket.html">Jakarta WebSocket</a>
  </li>
  <li class="nav-item" data-depth="1">
    <button class="nav-item-toggle"></button>
    <span class="nav-text">Jakarta Persistence</span>
<ul class="nav-list">
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../../persist/persistence-intro/persistence-intro.html">Introduction to Jakarta Persistence</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../../persist/persistence-basicexamples/persistence-basicexamples.html">Running the Persistence Examples</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../../persist/persistence-querylanguage/persistence-querylanguage.html">The Jakarta Persistence Query Language</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../../persist/persistence-criteria/persistence-criteria.html">Using the Criteria API to Create Queries</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../../persist/persistence-string-queries/persistence-string-queries.html">Creating and Using String-Based Criteria Queries</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../../persist/persistence-locking/persistence-locking.html">Controlling Concurrent Access to Entity Data with Locking</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../../persist/persistence-entitygraphs/persistence-entitygraphs.html">Creating Fetch Plans with Entity Graphs</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../../persist/persistence-cache/persistence-cache.html">Using a Second-Level Cache with Jakarta Persistence Applications</a>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="1">
    <button class="nav-item-toggle"></button>
    <span class="nav-text">Jakarta Enterprise Beans Lite</span>
<ul class="nav-list">
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../../entbeans/ejb-intro/ejb-intro.html">Enterprise Beans</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../../entbeans/ejb-gettingstarted/ejb-gettingstarted.html">Getting Started with Enterprise Beans</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../../entbeans/ejb-basicexamples/ejb-basicexamples.html">Running the Enterprise Bean Examples</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../../entbeans/ejb-async/ejb-async.html">Using Asynchronous Method Invocation in Session Beans</a>
  </li>
</ul>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="0">
    <button class="nav-item-toggle"></button>
    <span class="nav-text">Jakarta EE Platform</span>
<ul class="nav-list">
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="../../messaging/mail-api/mail-api.html">Jakarta Mail</a>
  </li>
  <li class="nav-item" data-depth="1">
    <button class="nav-item-toggle"></button>
    <span class="nav-text">Jakarta Messaging</span>
<ul class="nav-list">
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../../messaging/jms-concepts/jms-concepts.html">Jakarta Messaging Concepts</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../../messaging/jms-examples/jms-examples.html">Jakarta Messaging Examples</a>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="../../supporttechs/batch-processing/batch-processing.html">Jakarta Batch</a>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="0">
    <button class="nav-item-toggle"></button>
    <span class="nav-text">Advanced</span>
<ul class="nav-list">
  <li class="nav-item" data-depth="1">
    <button class="nav-item-toggle"></button>
    <span class="nav-text">Web Profile</span>
<ul class="nav-list">
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../../security/security-authentication/security-authentication.html">Jakarta Authentication</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../../security/security-authorization/security-authorization.html">Jakarta Authorization</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../../supporttechs/transactions/transactions.html">Jakarta Transactions</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../../supporttechs/concurrency-utilities/concurrency-utilities.html">Jakarta Concurrency</a>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="1">
    <button class="nav-item-toggle"></button>
    <span class="nav-text">Jakarta EE Platform</span>
<ul class="nav-list">
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../../supporttechs/connectors/connectors.html">Jakarta Connectors</a>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="1">
    <button class="nav-item-toggle"></button>
    <span class="nav-text">Optional Components</span>
<ul class="nav-list">
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../../web/faces-el/faces-el.html">Jakarta Expression Language</a>
  </li>
  <li class="nav-item" data-depth="2">
    <span class="nav-text">Jakarta XML Binding</span>
  </li>
</ul>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="0">
    <button class="nav-item-toggle"></button>
    <span class="nav-text">Archived</span>
<ul class="nav-list">
  <li class="nav-item" data-depth="1">
    <button class="nav-item-toggle"></button>
    <span class="nav-text">Web Profile</span>
<ul class="nav-list">
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../../web/jakarta-pages/jakarta-pages.html">Jakarta Pages</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../../web/jakarta-tags/jakarta-tags.html">Jakarta Tags</a>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="1">
    <button class="nav-item-toggle"></button>
    <span class="nav-text">Jakarta EE Platform</span>
<ul class="nav-list">
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../../websvcs/xml-websvcs/xml-websvcs.html">XML Web Services</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../../entbeans/ejb-full/ejb-full.html">Jakarta Enterprise Beans Full</a>
  </li>
</ul>
  </li>
</ul>
  </li>
</ul>
  </nav>
</div>
<div class="nav-panel-explore" data-panel="explore">
  <div class="context">
    <span class="title">Jakarta EE Tutorial</span>
    <span class="version">10</span>
  </div>
  <ul class="components">
    <li class="component is-current">
      <a class="title" href="../../index.html">Jakarta EE Tutorial</a>
      <ul class="versions">
        <li class="version is-current is-latest">
          <a href="../../index.html">10</a>
        </li>
        <li class="version">
          <a href="../../../9.1/index.html">9.1</a>
        </li>
      </ul>
    </li>
  </ul>
</div>
    </div>
  </aside>
</div>
<main class="article">
<div class="toolbar" role="navigation">
<button class="nav-toggle"></button>
<nav class="breadcrumbs" aria-label="breadcrumbs">
</nav>
<div class="page-versions">
  <button class="version-menu-toggle" title="Show other versions of page">10</button>
  <div class="version-menu">
    <a class="version is-current" href="cdi-adv-examples005.html">10</a>
    <a class="version" href="../../../9.1/cdi/cdi-adv-examples/cdi-adv-examples005.html">9.1</a>
  </div>
</div>
  <div class="edit-this-page"><a href="file:///home/john/workspace/virtua/jakartaee-tutorial/src/main/antora/modules/cdi/pages/cdi-adv-examples/cdi-adv-examples005.adoc">Edit this Page</a></div>
</div>
  <div class="content">
<aside class="toc sidebar" data-title="Contents" data-levels="2">
  <div class="toc-menu"></div>
</aside>
<article class="doc">
<div class="sect1">
<h2 id="_the_billpayment_example_using_events_and_interceptors"><a class="anchor" href="#_the_billpayment_example_using_events_and_interceptors"></a>The billpayment Example: Using Events and Interceptors</h2>
<div class="sectionbody">
<div class="paragraph">
<p>The <code>billpayment</code> example shows how to use both events and interceptors.</p>
</div>
<div class="paragraph">
<p>The source files are located in the <code><em>jakartaee-examples</em>/tutorial/cdi/billpayment/src/main/java/jakarta/tutorial/billpayment/</code> directory.</p>
</div>
<div class="sect2">
<h3 id="_overview_of_the_billpayment_example"><a class="anchor" href="#_overview_of_the_billpayment_example"></a>Overview of the billpayment Example</h3>
<div class="paragraph">
<p>The example simulates paying an amount using a debit card or credit card.
When the user chooses a payment method, the managed bean creates an appropriate event, supplies its payload, and fires it.
A simple event listener handles the event using observer methods.</p>
</div>
<div class="paragraph">
<p>The example also defines an interceptor that is set on a class and on two methods of another class.</p>
</div>
</div>
<div class="sect2">
<h3 id="_the_paymentevent_event_class"><a class="anchor" href="#_the_paymentevent_event_class"></a>The PaymentEvent Event Class</h3>
<div class="paragraph">
<p>The event class, <code>event.PaymentEvent</code>, is a simple bean class that contains a no-argument constructor.
It also has a <code>toString</code> method and getter and setter methods for the payload components: a <code>String</code> for the payment type, a <code>BigDecimal</code> for the payment amount, and a <code>Date</code> for the timestamp.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">public class PaymentEvent implements Serializable {

    ...
    public String paymentType;
    public BigDecimal value;
    public Date datetime;

    public PaymentEvent() {
    }

    @Override
    public String toString() {
        return this.paymentType
                + " = $" + this.value.toString()
                + " at " + this.datetime.toString();
    }
    ...
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>The event class is a simple bean that is instantiated by the managed bean using <code>new</code> and then populated.
For this reason, the CDI container cannot intercept the creation of the bean, and hence it cannot allow interception of its getter and setter methods.</p>
</div>
</div>
<div class="sect2">
<h3 id="_the_paymenthandler_event_listener"><a class="anchor" href="#_the_paymenthandler_event_listener"></a>The PaymentHandler Event Listener</h3>
<div class="paragraph">
<p>The event listener, <code>listener.PaymentHandler</code>, contains two observer methods, one for each of the two event types:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">@Logged
@SessionScoped
public class PaymentHandler implements Serializable {

    ...
    public void creditPayment(@Observes @Credit PaymentEvent event) {
        logger.log(Level.INFO, "PaymentHandler - Credit Handler: {0}",
                event.toString());

        // call a specific Credit handler class...
    }

    public void debitPayment(@Observes @Debit PaymentEvent event) {
        logger.log(Level.INFO, "PaymentHandler - Debit Handler: {0}",
                event.toString());

        // call a specific Debit handler class...
    }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>Each observer method takes as an argument the event, annotated with <code>@Observes</code> and with the qualifier for the type of payment.
In a real application, the observer methods would pass the event information on to another component that would perform business logic on the payment.</p>
</div>
<div class="paragraph">
<p>The qualifiers are defined in the <code>payment</code> package, described in <a href="#_the_billpayment_facelets_pages_and_managed_bean">The billpayment Facelets Pages and Managed Bean</a>.</p>
</div>
<div class="paragraph">
<p>The <code>PaymentHandler</code> bean is annotated <code>@Logged</code> so that all its methods can be intercepted.</p>
</div>
</div>
<div class="sect2">
<h3 id="_the_billpayment_facelets_pages_and_managed_bean"><a class="anchor" href="#_the_billpayment_facelets_pages_and_managed_bean"></a>The billpayment Facelets Pages and Managed Bean</h3>
<div class="paragraph">
<p>The <code>billpayment</code> example contains two Facelets pages, <code>index.xhtml</code> and the very simple <code>response.xhtml</code>.
The body of <code>index.xhtml</code> looks like this:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-xml hljs" data-lang="xml">    &lt;h:body&gt;
        &lt;h3&gt;Bill Payment Options&lt;/h3&gt;
        &lt;p&gt;Enter an amount, select Debit Card or Credit Card,
            then click Pay.&lt;/p&gt;
        &lt;h:form&gt;
            &lt;p&gt;
            &lt;h:outputLabel value="Amount: $" for="amt"/&gt;
            &lt;h:inputText id="amt" value="#{paymentBean.value}"
                         required="true"
                         requiredMessage="An amount is required."
                         maxlength="15" /&gt;
            &lt;/p&gt;
            &lt;h:outputLabel value="Options:" for="opt"/&gt;
            &lt;h:selectOneRadio id="opt" value="#{paymentBean.paymentOption}"&gt;
                &lt;f:selectItem id="debit" itemLabel="Debit Card"
                              itemValue="1"/&gt;
                &lt;f:selectItem id="credit" itemLabel="Credit Card"
                              itemValue="2" /&gt;
            &lt;/h:selectOneRadio&gt;
            &lt;p&gt;&lt;h:commandButton id="submit" value="Pay"
                                action="#{paymentBean.pay}" /&gt;&lt;/p&gt;
            &lt;p&gt;&lt;h:commandButton value="Reset"
                                action="#{paymentBean.reset}" /&gt;&lt;/p&gt;
        &lt;/h:form&gt;
        ...
    &lt;/h:body&gt;</code></pre>
</div>
</div>
<div class="paragraph">
<p>The input field takes a payment amount, passed to <code>paymentBean.value</code>.
Two options ask the user to select a Debit Card or Credit Card payment, passing the integer value to <code>paymentBean.paymentOption</code>.
Finally, the Pay command button&#8217;s action is set to the method <code>paymentBean.pay</code>, and the Reset button&#8217;s action is set to the <code>paymentBean.reset</code> method.</p>
</div>
<div class="paragraph">
<p>The <code>payment.PaymentBean</code> managed bean uses qualifiers to differentiate between the two kinds of payment event:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">@Named
@SessionScoped
public class PaymentBean implements Serializable {

   ...
    @Inject
    @Credit
    Event&lt;PaymentEvent&gt; creditEvent;

    @Inject
    @Debit
    Event&lt;PaymentEvent&gt; debitEvent;
    ...
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>The qualifiers, <code>@Credit</code> and <code>@Debit</code>, are defined in the <code>payment</code> package along with <code>PaymentBean</code>.</p>
</div>
<div class="paragraph">
<p>Next, the <code>PaymentBean</code> defines the properties it obtains from the Facelets page and will pass on to the event:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">public static final int DEBIT = 1;
public static final int CREDIT = 2;
private int paymentOption = DEBIT;

@Digits(integer = 10, fraction = 2, message = "Invalid value")
private BigDecimal value;

private Date datetime;</code></pre>
</div>
</div>
<div class="paragraph">
<p>The <code>paymentOption</code> value is an integer passed in from the option component; the default value is <code>DEBIT</code>.
The <code>value</code> is a <code>BigDecimal</code> with a Bean Validation constraint that enforces a currency value with a maximum number of digits.
The timestamp for the event, <code>datetime</code>, is a <code>Date</code> object initialized when the <code>pay</code> method is called.</p>
</div>
<div class="paragraph">
<p>The <code>pay</code> method of the bean first sets the timestamp for this payment event.
It then creates and populates the event payload, using the constructor for the <code>PaymentEvent</code> and calling the event&#8217;s setter methods, using the bean properties as arguments.
It then fires the event.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">@Logged
public String pay() {
    this.setDatetime(Calendar.getInstance().getTime());
    switch (paymentOption) {
        case DEBIT:
            PaymentEvent debitPayload = new PaymentEvent();
            debitPayload.setPaymentType("Debit");
            debitPayload.setValue(value);
            debitPayload.setDatetime(datetime);
            debitEvent.fire(debitPayload);
            break;
        case CREDIT:
            PaymentEvent creditPayload = new PaymentEvent();
            creditPayload.setPaymentType("Credit");
            creditPayload.setValue(value);
            creditPayload.setDatetime(datetime);
            creditEvent.fire(creditPayload);
            break;
        default:
            logger.severe("Invalid payment option!");
    }
    return "response";
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>The <code>pay</code> method returns the page to which the action is redirected, <code>response.xhtml</code>.</p>
</div>
<div class="paragraph">
<p>The <code>PaymentBean</code> class also contains a <code>reset</code> method that empties the value field on the <code>index.xhtml</code> page and sets the payment option to the default:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">@Logged
public void reset() {
    setPaymentOption(DEBIT);
    setValue(BigDecimal.ZERO);
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>In this bean, only the <code>pay</code> and <code>reset</code> methods are intercepted.</p>
</div>
<div class="paragraph">
<p>The <code>response.xhtml</code> page displays the amount paid.
It uses a <code>rendered</code> expression to display the payment method:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-xml hljs" data-lang="xml">    &lt;h:body&gt;
        &lt;h:form&gt;
            &lt;h2&gt;Bill Payment: Result&lt;/h2&gt;
            &lt;h3&gt;Amount Paid with
                &lt;h:outputText id="debit" value="Debit Card: "
                              rendered="#{paymentBean.paymentOption eq 1}" /&gt;
                &lt;h:outputText id="credit" value="Credit Card: "
                              rendered="#{paymentBean.paymentOption eq 2}" /&gt;
                &lt;h:outputText id="result" value="#{paymentBean.value}"&gt;
                    &lt;f:convertNumber type="currency"/&gt;
                &lt;/h:outputText&gt;
            &lt;/h3&gt;
            &lt;p&gt;&lt;h:commandButton id="back" value="Back" action="index" /&gt;&lt;/p&gt;
        &lt;/h:form&gt;
    &lt;/h:body&gt;</code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_the_loggedinterceptor_interceptor_class"><a class="anchor" href="#_the_loggedinterceptor_interceptor_class"></a>The LoggedInterceptor Interceptor Class</h3>
<div class="paragraph">
<p>The interceptor class, <code>LoggedInterceptor</code>, and its interceptor binding, <code>Logged</code>, are both defined in the <code>interceptor</code> package.
The <code>Logged</code> interceptor binding is defined as follows:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">@Inherited
@InterceptorBinding
@Retention(RUNTIME)
@Target({METHOD, TYPE})
public @interface Logged {
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>The <code>LoggedInterceptor</code> class looks like this:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">@Logged
@Interceptor
public class LoggedInterceptor implements Serializable {

    ...

    public LoggedInterceptor() {
    }

    @AroundInvoke
    public Object logMethodEntry(InvocationContext invocationContext)
            throws Exception {
        System.out.println("Entering method: "
                + invocationContext.getMethod().getName() + " in class "
                + invocationContext.getMethod().getDeclaringClass().getName());

        return invocationContext.proceed();
    }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>The class is annotated with both the <code>@Logged</code> and the <code>@Interceptor</code> annotations.
The <code>@AroundInvoke</code> method, <code>logMethodEntry</code>, takes the required <code>InvocationContext</code> argument and calls the required <code>proceed</code> method.
When a method is intercepted, <code>logMethodEntry</code> displays the name of the method being invoked as well as its class.</p>
</div>
<div class="paragraph">
<p>To enable the interceptor, the <code>beans.xml</code> file defines it as follows:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-xml hljs" data-lang="xml">&lt;interceptors&gt;
    &lt;class&gt;ee.jakarta.tutorial.billpayment.interceptor.LoggedInterceptor&lt;/class&gt;
&lt;/interceptors&gt;</code></pre>
</div>
</div>
<div class="paragraph">
<p>In this application, the <code>PaymentEvent</code> and <code>PaymentHandler</code> classes are annotated <code>@Logged</code>, so all their methods are intercepted.
In <code>PaymentBean</code>, only the <code>pay</code> and <code>reset</code> methods are annotated <code>@Logged</code>, so only those methods are intercepted.</p>
</div>
</div>
<div class="sect2">
<h3 id="_running_the_billpayment_example"><a class="anchor" href="#_running_the_billpayment_example"></a>Running the billpayment Example</h3>
<div class="paragraph">
<p>You can use either NetBeans IDE or Maven to build, package, deploy, and run the <code>billpayment</code> application.</p>
</div>
<div class="sect3">
<h4 id="_to_build_package_and_deploy_the_billpayment_example_using_netbeans_ide"><a class="anchor" href="#_to_build_package_and_deploy_the_billpayment_example_using_netbeans_ide"></a>To Build, Package, and Deploy the billpayment Example Using NetBeans IDE</h4>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Make sure that GlassFish Server has been started (see <a href="../../intro/usingexamples/usingexamples.html#_starting_and_stopping_glassfish_server" class="xref page">Starting and Stopping GlassFish Server</a>).</p>
</li>
<li>
<p>From the <strong>File</strong> menu, choose <strong>Open Project</strong>.</p>
</li>
<li>
<p>In the <strong>Open Project</strong> dialog box, navigate to:</p>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-asciidoc hljs" data-lang="asciidoc">jakartaee-examples/tutorial/cdi</code></pre>
</div>
</div>
</li>
<li>
<p>Select the <code>billpayment</code> folder.</p>
</li>
<li>
<p>Click <strong>Open Project</strong>.</p>
</li>
<li>
<p>In the <strong>Projects</strong> tab, right-click the <code>billpayment</code> project and select <strong>Build</strong>.</p>
<div class="paragraph">
<p>This command builds and packages the application into a WAR file, <code>billpayment.war</code>, located in the <code>target</code> directory, and then deploys it to GlassFish Server.</p>
</div>
</li>
</ol>
</div>
</div>
<div class="sect3">
<h4 id="_to_build_package_and_deploy_the_billpayment_example_using_maven"><a class="anchor" href="#_to_build_package_and_deploy_the_billpayment_example_using_maven"></a>To Build, Package, and Deploy the billpayment Example Using Maven</h4>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Make sure that GlassFish Server has been started (see <a href="../../intro/usingexamples/usingexamples.html#_starting_and_stopping_glassfish_server" class="xref page">Starting and Stopping GlassFish Server</a>).</p>
</li>
<li>
<p>In a terminal window, go to:</p>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-asciidoc hljs" data-lang="asciidoc">jakartaee-examples/tutorial/cdi/billpayment/</code></pre>
</div>
</div>
</li>
<li>
<p>Enter the following command to deploy the application:</p>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-shell hljs" data-lang="shell">mvn install</code></pre>
</div>
</div>
<div class="paragraph">
<p>This command builds and packages the application into a WAR file, <code>billpayment.war</code>, located in the <code>target</code> directory, and then deploys it to GlassFish Server.</p>
</div>
</li>
</ol>
</div>
</div>
<div class="sect3">
<h4 id="_to_run_the_billpayment_example"><a class="anchor" href="#_to_run_the_billpayment_example"></a>To Run the billpayment Example</h4>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>In a web browser, enter the following URL:</p>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-asciidoc hljs" data-lang="asciidoc">http://localhost:8080/billpayment</code></pre>
</div>
</div>
</li>
<li>
<p>On the Bill Payment Options page, enter a value in the Amount field.</p>
<div class="paragraph">
<p>The amount can contain up to 10 digits and include up to two decimal places.
For example:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-asciidoc hljs" data-lang="asciidoc">9876.54</code></pre>
</div>
</div>
</li>
<li>
<p>Select Debit Card or Credit Card and click Pay.</p>
<div class="paragraph">
<p>The Bill Payment: Result page opens, displaying the amount paid and the method of payment:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-asciidoc hljs" data-lang="asciidoc">Amount Paid with Credit Card: $9,876.34</code></pre>
</div>
</div>
</li>
<li>
<p>Click Back to return to the Bill Payment Options page.</p>
<div class="paragraph">
<p>You can also click Reset to return to the initial page values.</p>
</div>
</li>
<li>
<p>Examine the server log output.</p>
<div class="paragraph">
<p>In NetBeans IDE, the output is visible in the GlassFish Server Output tab.
Otherwise, view <code><em>domain-dir</em>/logs/server.log</code>.</p>
</div>
<div class="paragraph">
<p>The output from each interceptor appears in the log, followed by the additional logger output defined by the constructor and methods:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-asciidoc hljs" data-lang="asciidoc">INFO: Entering method: pay in class billpayment.payment.PaymentBean
INFO: PaymentHandler created.
INFO: Entering method: debitPayment in class billpayment.listener.PaymentHandler
INFO: PaymentHandler - Debit Handler: Debit = $1234.56 at Tue Dec 14 14:50:28 EST 2010</code></pre>
</div>
</div>
</li>
</ol>
</div>
</div>
</div>
</div>
</div>
</article>
  </div>
</main>
</div>
<footer class="footer">
  <p>This page was built using the Antora default UI.</p>
  <p>The source code for this UI is licensed under the terms of the MPL-2.0 license.</p>
</footer>
<script id="site-script" src="../../../../_/js/site.js" data-ui-root-path="../../../../_"></script>
<script async src="../../../../_/js/vendor/highlight.js"></script>
  </body>
</html>
