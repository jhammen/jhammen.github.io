<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>Running the Persistence Examples :: Jakarta EE Documentation</title>
    <meta name="generator" content="Antora 3.1.3">
    <link rel="stylesheet" href="../../../../_/css/site.css">
    <script>var uiRootPath = '../../../../_'</script>
    <script>!function (theme) {
        if (theme === 'dark') document.documentElement.classList.add('theme-dark')
      }(localStorage && localStorage.getItem('theme') || (matchMedia('(prefers-color-scheme: dark)') && 'dark'))
    </script>
      </head>
  <body class="article">
<header class="header">
  <nav class="navbar">
    <div class="navbar-brand">
      <a id="site-title" class="navbar-item" href="../../../..">Jakarta EE Documentation</a>
      <button class="navbar-burger" data-target="topbar-nav">
        <span></span>
        <span></span>
        <span></span>
      </button>
    </div>
    <div id="topbar-nav" class="navbar-menu">
      <div class="navbar-end">
<!--
        <a class="navbar-item" href="#">Home</a>
        <div class="navbar-item has-dropdown is-hoverable">
          <a class="navbar-link" href="#">Products</a>
          <div class="navbar-dropdown">
            <a class="navbar-item" href="#">Product A</a>
            <a class="navbar-item" href="#">Product B</a>
            <a class="navbar-item" href="#">Product C</a>
          </div>
        </div>
        <div class="navbar-item has-dropdown is-hoverable">
          <a class="navbar-link" href="#">Services</a>
          <div class="navbar-dropdown">
            <a class="navbar-item" href="#">Service A</a>
            <a class="navbar-item" href="#">Service B</a>
            <a class="navbar-item" href="#">Service C</a>
          </div>
        </div>
 -->
        <div class="navbar-item">
          <span class="control">
            <a class="button is-primary" href="../../../../jakartaee-tutorial/10/jakarta-ee-tutorial.pdf">Download</a>
          </span>
        </div>
      </div>
      <div class="navbar-theme-switcher">
        <span class="switch" title="Switch between Light and Dark Theme">
          <input id="theme-switcher-checkbox" type="checkbox" />
          <label for="theme-switcher-checkbox">Dark Theme</label>
        </span>
      </div>
    </div>
  </nav>
</header>
<div class="body">
<div class="nav-container" data-component="jakartaee-tutorial" data-version="10">
  <aside class="nav">
    <div class="panels">
<div class="nav-panel-menu is-active" data-panel="menu">
  <nav class="nav-menu">
    <h3 class="title"><a href="../../index.html">Jakarta EE Tutorial</a></h3>
<ul class="nav-list">
  <li class="nav-item" data-depth="0">
    <button class="nav-item-toggle"></button>
    <span class="nav-text">Introduction</span>
<ul class="nav-list">
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="../../index.html">Preface</a>
  </li>
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="../../intro/usingexamples/usingexamples.html">Using the Tutorial Examples</a>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="0">
    <button class="nav-item-toggle"></button>
    <span class="nav-text">Jakarta EE Core Profile</span>
<ul class="nav-list">
  <li class="nav-item" data-depth="1">
    <button class="nav-item-toggle"></button>
    <span class="nav-text">Jakarta CDI Lite</span>
<ul class="nav-list">
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../../cdi/cdi-basic/cdi-basic.html">Introduction to Jakarta Contexts and Dependency Injection</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../../cdi/cdi-basicexamples/cdi-basicexamples.html">Running the Basic Contexts and Dependency Injection Examples</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../../supporttechs/interceptors/interceptors.html">Using Jakarta EE Interceptors</a>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="1">
    <button class="nav-item-toggle"></button>
    <span class="nav-text">Jakarta REST</span>
<ul class="nav-list">
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../../websvcs/jaxrs/jaxrs.html">Building RESTful Web Services with Jakarta REST</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../../websvcs/jaxrs-client/jaxrs-client.html">Accessing REST Resources with the Jakarta REST Client API</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../../websvcs/jaxrs-advanced/jaxrs-advanced.html">Jakarta REST: Advanced Topics and an Example</a>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="1">
    <button class="nav-item-toggle"></button>
    <span class="nav-text">Jakarta JSON</span>
<ul class="nav-list">
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../../web/jsonb/jsonb.html">JSON Binding</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../../web/jsonp/jsonp.html">JSON Processing</a>
  </li>
</ul>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="0">
    <button class="nav-item-toggle"></button>
    <span class="nav-text">Jakarta EE Web Profile</span>
<ul class="nav-list">
  <li class="nav-item" data-depth="1">
    <button class="nav-item-toggle"></button>
    <span class="nav-text">Jakarta CDI Full</span>
<ul class="nav-list">
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../../cdi/cdi-adv/cdi-adv.html">Jakarta Contexts and Dependency Injection: Advanced Topics</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../../cdi/cdi-bootstrap-se8/cdi-bootstrap-se8.html">Bootstrapping a CDI Container in Java SE</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../../cdi/cdi-adv-examples/cdi-adv-examples.html">Running the Advanced Contexts and Dependency Injection Examples</a>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="1">
    <button class="nav-item-toggle"></button>
    <span class="nav-text">Jakarta Validation</span>
<ul class="nav-list">
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../../beanvalidation/bean-validation/bean-validation.html">Introduction to Jakarta Bean Validation</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../../beanvalidation/bean-validation-advanced/bean-validation-advanced.html">Bean Validation: Advanced Topics</a>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="../../security/security.html">Jakarta Security</a>
  </li>
  <li class="nav-item" data-depth="1">
    <button class="nav-item-toggle"></button>
    <span class="nav-text">Jakarta Servlets</span>
<ul class="nav-list">
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../../web/webapp/webapp.html">Getting Started with Web Applications</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../../web/servlets/servlets.html">Jakarta Servlet Technology</a>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="1">
    <button class="nav-item-toggle"></button>
    <span class="nav-text">Jakarta Faces</span>
<ul class="nav-list">
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../../web/faces-intro/faces-intro.html">Jakarta Faces Technology</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../../web/faces-facelets/faces-facelets.html">Introduction to Facelets</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../../web/faces-page/faces-page.html">Using Jakarta Faces Technology in Web Pages</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../../web/faces-page-core/faces-page-core.html">Using Converters, Listeners, and Validators</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../../web/faces-develop/faces-develop.html">Developing with Jakarta Faces Technology</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../../web/faces-ajax/faces-ajax.html">Using Ajax with Jakarta Faces Technology</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../../web/faces-advanced-cc/faces-advanced-cc.html">Composite Components: Advanced Topics and an Example</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../../web/faces-custom/faces-custom.html">Creating Custom UI Components and Other Custom Objects</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../../web/faces-configure/faces-configure.html">Configuring Jakarta Faces Applications</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../../web/faces-ws/faces-ws.html">Using WebSockets with Jakarta Faces Technology</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../../web/webi18n/webi18n.html">Internationalizing and Localizing Web Applications</a>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="../../web/websocket/websocket.html">Jakarta WebSocket</a>
  </li>
  <li class="nav-item" data-depth="1">
    <button class="nav-item-toggle"></button>
    <span class="nav-text">Jakarta Persistence</span>
<ul class="nav-list">
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../persistence-intro/persistence-intro.html">Introduction to Jakarta Persistence</a>
  </li>
  <li class="nav-item is-current-page" data-depth="2">
    <a class="nav-link" href="persistence-basicexamples.html">Running the Persistence Examples</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../persistence-querylanguage/persistence-querylanguage.html">The Jakarta Persistence Query Language</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../persistence-criteria/persistence-criteria.html">Using the Criteria API to Create Queries</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../persistence-string-queries/persistence-string-queries.html">Creating and Using String-Based Criteria Queries</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../persistence-locking/persistence-locking.html">Controlling Concurrent Access to Entity Data with Locking</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../persistence-entitygraphs/persistence-entitygraphs.html">Creating Fetch Plans with Entity Graphs</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../persistence-cache/persistence-cache.html">Using a Second-Level Cache with Jakarta Persistence Applications</a>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="1">
    <button class="nav-item-toggle"></button>
    <span class="nav-text">Jakarta Enterprise Beans Lite</span>
<ul class="nav-list">
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../../entbeans/ejb-intro/ejb-intro.html">Enterprise Beans</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../../entbeans/ejb-gettingstarted/ejb-gettingstarted.html">Getting Started with Enterprise Beans</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../../entbeans/ejb-basicexamples/ejb-basicexamples.html">Running the Enterprise Bean Examples</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../../entbeans/ejb-async/ejb-async.html">Using Asynchronous Method Invocation in Session Beans</a>
  </li>
</ul>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="0">
    <button class="nav-item-toggle"></button>
    <span class="nav-text">Jakarta EE Platform</span>
<ul class="nav-list">
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="../../messaging/mail-api/mail-api.html">Jakarta Mail</a>
  </li>
  <li class="nav-item" data-depth="1">
    <button class="nav-item-toggle"></button>
    <span class="nav-text">Jakarta Messaging</span>
<ul class="nav-list">
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../../messaging/jms-concepts/jms-concepts.html">Jakarta Messaging Concepts</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../../messaging/jms-examples/jms-examples.html">Jakarta Messaging Examples</a>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="../../supporttechs/batch-processing/batch-processing.html">Jakarta Batch</a>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="0">
    <button class="nav-item-toggle"></button>
    <span class="nav-text">Advanced</span>
<ul class="nav-list">
  <li class="nav-item" data-depth="1">
    <button class="nav-item-toggle"></button>
    <span class="nav-text">Web Profile</span>
<ul class="nav-list">
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../../security/security-authentication/security-authentication.html">Jakarta Authentication</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../../security/security-authorization/security-authorization.html">Jakarta Authorization</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../../supporttechs/transactions/transactions.html">Jakarta Transactions</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../../supporttechs/concurrency-utilities/concurrency-utilities.html">Jakarta Concurrency</a>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="1">
    <button class="nav-item-toggle"></button>
    <span class="nav-text">Jakarta EE Platform</span>
<ul class="nav-list">
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../../supporttechs/connectors/connectors.html">Jakarta Connectors</a>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="1">
    <button class="nav-item-toggle"></button>
    <span class="nav-text">Optional Components</span>
<ul class="nav-list">
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../../web/faces-el/faces-el.html">Jakarta Expression Language</a>
  </li>
  <li class="nav-item" data-depth="2">
    <span class="nav-text">Jakarta XML Binding</span>
  </li>
</ul>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="0">
    <button class="nav-item-toggle"></button>
    <span class="nav-text">Archived</span>
<ul class="nav-list">
  <li class="nav-item" data-depth="1">
    <button class="nav-item-toggle"></button>
    <span class="nav-text">Web Profile</span>
<ul class="nav-list">
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../../web/jakarta-pages/jakarta-pages.html">Jakarta Pages</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../../web/jakarta-tags/jakarta-tags.html">Jakarta Tags</a>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="1">
    <button class="nav-item-toggle"></button>
    <span class="nav-text">Jakarta EE Platform</span>
<ul class="nav-list">
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../../websvcs/xml-websvcs/xml-websvcs.html">XML Web Services</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../../entbeans/ejb-full/ejb-full.html">Jakarta Enterprise Beans Full</a>
  </li>
</ul>
  </li>
</ul>
  </li>
</ul>
  </nav>
</div>
<div class="nav-panel-explore" data-panel="explore">
  <div class="context">
    <span class="title">Jakarta EE Tutorial</span>
    <span class="version">10</span>
  </div>
  <ul class="components">
    <li class="component is-current">
      <a class="title" href="../../index.html">Jakarta EE Tutorial</a>
      <ul class="versions">
        <li class="version is-current is-latest">
          <a href="../../index.html">10</a>
        </li>
        <li class="version">
          <a href="../../../9.1/index.html">9.1</a>
        </li>
      </ul>
    </li>
  </ul>
</div>
    </div>
  </aside>
</div>
<main class="article">
<div class="toolbar" role="navigation">
<button class="nav-toggle"></button>
<nav class="breadcrumbs" aria-label="breadcrumbs">
  <ul>
    <li><a href="../../index.html">Jakarta EE Tutorial</a></li>
    <li>Jakarta EE Web Profile</li>
    <li>Jakarta Persistence</li>
    <li><a href="persistence-basicexamples.html">Running the Persistence Examples</a></li>
  </ul>
</nav>
<div class="page-versions">
  <button class="version-menu-toggle" title="Show other versions of page">10</button>
  <div class="version-menu">
    <a class="version is-current" href="persistence-basicexamples.html">10</a>
    <a class="version" href="../../../9.1/persist/persistence-basicexamples/persistence-basicexamples.html">9.1</a>
  </div>
</div>
  <div class="edit-this-page"><a href="file:///home/john/workspace/virtua/jakartaee-tutorial/src/main/antora/modules/persist/pages/persistence-basicexamples/persistence-basicexamples.adoc">Edit this Page</a></div>
</div>
  <div class="content">
<aside class="toc sidebar" data-title="Contents" data-levels="2">
  <div class="toc-menu"></div>
</aside>
<article class="doc">
<h1 class="page">Running the Persistence Examples</h1>
<div id="preamble">
<div class="sectionbody">
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>We are working on a fresh, updated Jakarta EE Tutorial. This section hasn&#8217;t yet been updated.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>This chapter explains how to use Jakarta Persistence.
The material here focuses on the source code and settings of three examples.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_overview_of_the_persistence_examples"><a class="anchor" href="#_overview_of_the_persistence_examples"></a>Overview of the Persistence Examples</h2>
<div class="sectionbody">
<div class="paragraph">
<p>The first example, <code>order</code>, is an application that uses a stateful session bean to manage entities related to an ordering system.
The second example, <code>roster</code>, is an application that manages a community sports system.
The third example, <code>address-book</code>, is a web application that stores contact data.
This chapter assumes that you are familiar with the concepts detailed in <a href="../persistence-intro/persistence-intro.html#_introduction_to_jakarta_persistence" class="xref page">Introduction to Jakarta Persistence</a>.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_the_order_application"><a class="anchor" href="#_the_order_application"></a>The order Application</h2>
<div class="sectionbody">
<div class="paragraph">
<p>The <code>order</code> application is a simple inventory and ordering application for maintaining a catalog of parts and placing an itemized order of those parts.
The application has entities that represent parts, vendors, orders, and line items.
These entities are accessed using a stateful session bean that holds the business logic of the application.
A simple singleton session bean creates the initial entities on application deployment.
A Facelets web application manipulates the data and displays data from the catalog.</p>
</div>
<div class="paragraph">
<p>The information contained in an order can be divided into elements.
What is the order number? What parts are included in the order? What parts make up that part? Who makes the part? What are the specifications for the part? Are there any schematics for the part? The <code>order</code> application is a simplified version of an ordering system that has all these elements.</p>
</div>
<div class="paragraph">
<p>The <code>order</code> application consists of a single WAR module that includes the enterprise bean classes, the entities, the support classes, and the Facelets XHTML and class files.</p>
</div>
<div class="paragraph">
<p>The database schema in the Derby database for <code>order</code> is shown in <a href="#_database_schema_for_the_order_application">Figure 1, &#8220;Database Schema for the order Application&#8221;</a>.</p>
</div>
<div id="_database_schema_for_the_order_application" class="imageblock">
<div class="content">
<img src="../../common/_images/jakartaeett_dt_024.svg" alt="Diagram showing the database schema for the order application">
</div>
<div class="title">Figure 1. Database Schema for the order Application</div>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
In this diagram, for simplicity, the <code>PERSISTENCE_ORDER_</code> prefix is omitted from the table names.
</td>
</tr>
</table>
</div>
<div class="sect2">
<h3 id="_entity_relationships_in_the_order_application"><a class="anchor" href="#_entity_relationships_in_the_order_application"></a>Entity Relationships in the order Application</h3>
<div class="paragraph">
<p>The <code>order</code> application demonstrates several types of entity relationships: self-referential, one-to-one, one-to-many, many-to-one, and unidirectional relationships.</p>
</div>
<div class="sect3">
<h4 id="_self_referential_relationships"><a class="anchor" href="#_self_referential_relationships"></a>Self-Referential Relationships</h4>
<div class="paragraph">
<p>A self-referential relationship occurs between relationship fields in the same entity.
<code>Part</code> has a field, <code>bomPart</code>, which has a one-to-many relationship with the field <code>parts</code>, which is also in <code>Part</code>.
That is, a part can be made up of many parts, and each of those parts has exactly one bill-of-material part.</p>
</div>
<div class="paragraph">
<p>The primary key for <code>Part</code> is a compound primary key, a combination of the <code>partNumber</code> and <code>revision</code> fields.
This key is mapped to the <code>PARTNUMBER</code> and <code>REVISION</code> columns in the <code>PERSISTENCE_ORDER_PART</code> table:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">...
@ManyToOne
@JoinColumns({
    @JoinColumn(name="BOMPARTNUMBER", referencedColumnName="PARTNUMBER"),
    @JoinColumn(name="BOMREVISION", referencedColumnName="REVISION")
})
public Part getBomPart() {
    return bomPart;
}
...
@OneToMany(mappedBy="bomPart")
public Collection&lt;Part&gt; getParts() {
    return parts;
}
...</code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_one_to_one_relationships"><a class="anchor" href="#_one_to_one_relationships"></a>One-to-One Relationships</h4>
<div class="paragraph">
<p><code>Part</code> has a field, <code>vendorPart</code>, that has a one-to-one relationship with <code>VendorPart</code>'s <code>part</code> field.
That is, each part has exactly one vendor part, and vice versa.</p>
</div>
<div class="paragraph">
<p>Here is the relationship mapping in <code>Part</code>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">@OneToOne(mappedBy="part")
public VendorPart getVendorPart() {
    return vendorPart;
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>Here is the relationship mapping in <code>VendorPart</code>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">@OneToOne
@JoinColumns({
    @JoinColumn(name="PARTNUMBER", referencedColumnName="PARTNUMBER"),
    @JoinColumn(name="PARTREVISION", referencedColumnName="REVISION")
})
public Part getPart() {
    return part;
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>Note that, because <code>Part</code> uses a compound primary key, the <code>@JoinColumns</code> annotation is used to map the columns in the <code>PERSISTENCE_ORDER_VENDOR_PART</code> table to the columns in <code>PERSISTENCE_ORDER_PART</code>.
The <code>PERSISTENCE_ORDER_VENDOR_PART</code> table&#8217;s <code>PARTREVISION</code> column refers to <code>PERSISTENCE_ORDER_PART</code>'s <code>REVISION</code> column.</p>
</div>
</div>
<div class="sect3">
<h4 id="_one_to_many_relationship_mapped_to_overlapping_primary_and_foreign_keys"><a class="anchor" href="#_one_to_many_relationship_mapped_to_overlapping_primary_and_foreign_keys"></a>One-to-Many Relationship Mapped to Overlapping Primary and Foreign Keys</h4>
<div class="paragraph">
<p><code>CustomerOrder</code> has a field, <code>lineItems</code>, that has a one-to-many relationship with <code>LineItem</code>'s field <code>customerOrder</code>.
That is, each order has one or more line item.</p>
</div>
<div class="paragraph">
<p><code>LineItem</code> uses a compound primary key that is made up of the <code>orderId</code> and <code>itemId</code> fields.
This compound primary key maps to the <code>ORDERID</code> and <code>ITEMID</code> columns in the <code>PERSISTENCE_ORDER_LINEITEM</code> table.
<code>ORDERID</code> is a foreign key to the <code>ORDERID</code> column in the <code>PERSISTENCE_ORDER_CUSTOMERORDER</code> table.
This means that the <code>ORDERID</code> column is mapped twice: once as a primary key field, <code>orderId</code>; and again as a relationship field, <code>order</code>.</p>
</div>
<div class="paragraph">
<p>Here is the relationship mapping in <code>CustomerOrder</code>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">@OneToMany(cascade=ALL, mappedBy="customerOrder")
public Collection&lt;LineItem&gt; getLineItems() {
    return lineItems;
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>Here is the relationship mapping in <code>LineItem</code>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">@Id
@ManyToOne
@JoinColumn(name="ORDERID")
public CustomerOrder getCustomerOrder() {
    return customerOrder;
}</code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_unidirectional_relationships"><a class="anchor" href="#_unidirectional_relationships"></a>Unidirectional Relationships</h4>
<div class="paragraph">
<p><code>LineItem</code> has a field, <code>vendorPart</code>, that has a unidirectional many-to-one relationship with <code>VendorPart</code>.
That is, there is no field in the target entity in this relationship:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">@JoinColumn(name="VENDORPARTNUMBER")
@ManyToOne
public VendorPart getVendorPart() {
    return vendorPart;
}</code></pre>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_primary_keys_in_the_order_application"><a class="anchor" href="#_primary_keys_in_the_order_application"></a>Primary Keys in the order Application</h3>
<div class="paragraph">
<p>The <code>order</code> application uses several types of primary keys: single-valued primary keys, generated primary keys, and compound primary keys.</p>
</div>
<div class="sect3">
<h4 id="_generated_primary_keys"><a class="anchor" href="#_generated_primary_keys"></a>Generated Primary Keys</h4>
<div class="paragraph">
<p><code>VendorPart</code> uses a generated primary key value.
That is, the application does not assign primary key values for the entities but instead relies on the persistence provider to generate the primary key values.
The <code>@GeneratedValue</code> annotation is used to specify that an entity will use a generated primary key.</p>
</div>
<div class="paragraph">
<p>In <code>VendorPart</code>, the following code specifies the settings for generating primary key values:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">@TableGenerator(
    name="vendorPartGen",
    table="PERSISTENCE_ORDER_SEQUENCE_GENERATOR",
    pkColumnName="GEN_KEY",
    valueColumnName="GEN_VALUE",
    pkColumnValue="VENDOR_PART_ID",
    allocationSize=10)
@Id
@GeneratedValue(strategy=GenerationType.TABLE, generator="vendorPartGen")
public Long getVendorPartNumber() {
    return vendorPartNumber;
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>The <code>@TableGenerator</code> annotation is used in conjunction with <code>@GeneratedValue</code>'s <code>strategy=TABLE</code> element.
That is, the strategy used to generate the primary keys is to use a table in the database.
The <code>@TableGenerator</code> annotation is used to configure the settings for the generator table.
The name element sets the name of the generator, which is <code>vendorPartGen</code> in <code>VendorPart</code>.</p>
</div>
<div class="paragraph">
<p>The <code>PERSISTENCE_ORDER_SEQUENCE_GENERATOR</code> table, whose two columns are <code>GEN_KEY</code> and <code>GEN_VALUE</code>, will store the generated primary key values.
This table could be used to generate other entities' primary keys, so the <code>pkColumnValue</code> element is set to <code>VENDOR_PART_ID</code> to distinguish this entity&#8217;s generated primary keys from other entities' generated primary keys.
The <code>allocationSize</code> element specifies the amount to increment when allocating primary key values.
In this case, each <code>VendorPart</code>'s primary key will increment by 10.</p>
</div>
<div class="paragraph">
<p>The primary key field <code>vendorPartNumber</code> is of type <code>Long</code>, as the generated primary key&#8217;s field must be an integral type.</p>
</div>
</div>
<div class="sect3">
<h4 id="_compound_primary_keys"><a class="anchor" href="#_compound_primary_keys"></a>Compound Primary Keys</h4>
<div class="paragraph">
<p>A compound primary key is made up of multiple fields and follows the requirements described in <a href="../persistence-intro/persistence-intro.html#_primary_keys_in_entities" class="xref page">Primary Keys in Entities</a>.
To use a compound primary key, you must create a wrapper class.</p>
</div>
<div class="paragraph">
<p>In <code>order</code>, two entities use compound primary keys: <code>Part</code> and <code>LineItem</code>.</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>Part</code> uses the <code>PartKey</code> wrapper class.
<code>Part</code>'s primary key is a combination of the part number and the revision number.
<code>PartKey</code> encapsulates this primary key.</p>
</li>
<li>
<p><code>LineItem</code> uses the <code>LineItemKey</code> class.
<code>LineItem</code>'s primary key is a combination of the order number and the item number.
<code>LineItemKey</code> encapsulates this primary key.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>This is the <code>LineItemKey</code> compound primary key wrapper class:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">package ee.jakarta.tutorial.order.entity;

import java.io.Serializable;

public final class LineItemKey implements Serializable {

    private Integer customerOrder;
    private int itemId;

    public LineItemKey() {}

    public LineItemKey(Integer order, int itemId) {
        this.setCustomerOrder(order);
        this.setItemId(itemId);
    }

    @Override
    public int hashCode() {
        return ((this.getCustomerOrder() == null
                ? 0 : this.getCustomerOrder().hashCode())
                ^ ((int) this.getItemId()));
    }

    @Override
    public boolean equals(Object otherOb) {
        if (this == otherOb) {
            return true;
        }
        if (!(otherOb instanceof LineItemKey)) {
            return false;
        }
        LineItemKey other = (LineItemKey) otherOb;
        return ((this.getCustomerOrder() == null
                ? other.getCustomerOrder == null : this.getOrderId()
                .equals(other.getCustomerOrder()))
                &amp;&amp; (this.getItemId == oother.getItemId()));
    }

    @Override
    public String toString() {
        return "" + getCustomerOrder() + "-" + getItemId();
    }

    public Integer getCustomerOrder() {
        return customerOrder;
    }

    public void setCustomerOrder(Integer order) {
        this.customerOrder = order;
    }

    public int getItemId() {
        return itemId;
    }

    public void setItemId(int itemId) {
        this.itemId = itemId;
    }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>The <code>@IdClass</code> annotation is used to specify the primary key class in the entity class.
In <code>LineItem</code>, <code>@IdClass</code> is used as follows:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">@IdClass(LineItemKey.class)
@Entity
...
public class LineItem implements Serializable {
    ...
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>The two fields in <code>LineItem</code> are tagged with the <code>@Id</code> annotation to mark those fields as part of the compound primary key:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">@Id
public int getItemId() {
    return itemId;
}
...
@Id
@ManyToOne
@JoinColumn(name="ORDERID")
public CustomerOrder getCustomerOrder() {
    return customerOrder;
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>For <code>customerOrder</code>, you also use the <code>@JoinColumn</code> annotation to specify the column name in the table and that this column is an overlapping foreign key pointing at the <code>PERSISTENCE_ORDER_CUSTOMERORDER</code> table&#8217;s <code>ORDERID</code> column (see <a href="#_one_to_many_relationship_mapped_to_overlapping_primary_and_foreign_keys">One-to-Many Relationship Mapped to Overlapping Primary and Foreign Keys</a>).
That is, <code>customerOrder</code> will be set by the <code>CustomerOrder</code> entity.</p>
</div>
<div class="paragraph">
<p>In <code>LineItem</code>'s constructor, the line item number (<code>LineItem.itemId</code>) is set using the <code>CustomerOrder.getNextId</code> method:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">public LineItem(CustomerOrder order, int quantity, VendorPart vendorPart) {
    this.customerOrder = order;
    this.itemId = order.getNextId();
    this.quantity = quantity;
    this.vendorPart = vendorPart;
}</code></pre>
</div>
</div>
<div class="paragraph">
<p><code>CustomerOrder.getNextId</code> counts the number of current line items, adds 1, and returns that number:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">@Transient
public int getNextId() {
    return this.lineItems.size() + 1;
}</code></pre>
</div>
</div>
<div class="paragraph">
<p><code>Part</code> requires the <code>@Column</code> annotation on the two fields that comprise <code>Part</code>'s compound primary key, because <code>Part</code>'s compound primary key is an overlapping primary key/foreign key:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">@IdClass(PartKey.class)
@Entity
...
public class Part implements Serializable {
    ...
    @Id
    @Column(nullable=false)
    public String getPartNumber() {
        return partNumber;
    }
    ...
    @Id
    @Column(nullable=false)
    public int getRevision() {
        return revision;
    }
    ...
}</code></pre>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_entity_mapped_to_more_than_one_database_table"><a class="anchor" href="#_entity_mapped_to_more_than_one_database_table"></a>Entity Mapped to More Than One Database Table</h3>
<div class="paragraph">
<p><code>Part</code>'s fields map to more than one database table: <code>PERSISTENCE_ORDER_PART</code> and <code>PERSISTENCE_ORDER_PART_DETAIL</code>.
The <code>PERSISTENCE_ORDER_PART_DETAIL</code> table holds the specification and schematics for the part.
The <code>@SecondaryTable</code> annotation is used to specify the secondary table:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">...
@Entity
@Table(name="PERSISTENCE_ORDER_PART")
@SecondaryTable(name="PERSISTENCE_ORDER_PART_DETAIL", pkJoinColumns={
    @PrimaryKeyJoinColumn(name="PARTNUMBER",
        referencedColumnName="PARTNUMBER"),
    @PrimaryKeyJoinColumn(name="REVISION",
        referencedColumnName="REVISION")
})
public class Part implements Serializable {
    ...
}</code></pre>
</div>
</div>
<div class="paragraph">
<p><code>PERSISTENCE_ORDER_PART_DETAIL</code> and <code>PERSISTENCE_ORDER_PART</code> share the same primary key values.
The <code>pkJoinColumns</code> element of <code>@SecondaryTable</code> is used to specify that <code>PERSISTENCE_ORDER_PART_DETAIL</code>'s primary key columns are foreign keys to <code>PERSISTENCE_ORDER_PART</code>.
The <code>@PrimaryKeyJoinColumn</code> annotation sets the primary key column names and specifies which column in the primary table the column refers to.
In this case, the primary key column names for both <code>PERSISTENCE_ORDER_PART_DETAIL</code> and <code>PERSISTENCE_ORDER_PART</code> are the same: <code>PARTNUMBER</code> and <code>REVISION</code>, respectively.</p>
</div>
</div>
<div class="sect2">
<h3 id="_cascade_operations_in_the_order_application"><a class="anchor" href="#_cascade_operations_in_the_order_application"></a>Cascade Operations in the order Application</h3>
<div class="paragraph">
<p>Entities that have relationships to other entities often have dependencies on the existence of the other entity in the relationship.
For example, a line item is part of an order; if the order is deleted, then the line item also should be deleted.
This is called a cascade delete relationship.</p>
</div>
<div class="paragraph">
<p>In <code>order</code>, there are two cascade delete dependencies in the entity relationships.
If the <code>CustomerOrder</code> to which a <code>LineItem</code> is related is deleted, the <code>LineItem</code> also should be deleted.
If the <code>Vendor</code> to which a <code>VendorPart</code> is related is deleted, the <code>VendorPart</code> also should be deleted.</p>
</div>
<div class="paragraph">
<p>You specify the cascade operations for entity relationships by setting the <code>cascade</code> element in the inverse (nonowning) side of the relationship.
The cascade element is set to <code>ALL</code> in the case of <code>CustomerOrder.lineItems</code>.
This means that all persistence operations (deletes, updates, and so on) are cascaded from orders to line items.</p>
</div>
<div class="paragraph">
<p>Here is the relationship mapping in <code>CustomerOrder</code>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">@OneToMany(cascade=ALL, mappedBy="customerOrder")
public Collection&lt;LineItem&gt; getLineItems() {
    return lineItems;
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>Here is the relationship mapping in <code>LineItem</code>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">@Id
@ManyToOne
@JoinColumn(name="ORDERID")
public CustomerOrder getCustomerOrder() {
    return customerOrder;
}</code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_blob_and_clob_database_types_in_the_order_application"><a class="anchor" href="#_blob_and_clob_database_types_in_the_order_application"></a>BLOB and CLOB Database Types in the order Application</h3>
<div class="paragraph">
<p>The <code>PARTDETAIL</code> table in the database has a column, <code>DRAWING</code>, of type <code>BLOB</code>.
<code>BLOB</code> stands for binary large objects, which are used for storing binary data, such as an image.
The <code>DRAWING</code> column is mapped to the field <code>Part.drawing</code> of type <code>java.io.Serializable</code>.
The <code>@Lob</code> annotation is used to denote that the field is a large object:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">@Column(table="PERSISTENCE_ORDER_PART_DETAIL")
@Lob
public Serializable getDrawing() {
    return drawing;
}</code></pre>
</div>
</div>
<div class="paragraph">
<p><code>PERSISTENCE_ORDER_PART_DETAIL</code> also has a column, <code>SPECIFICATION</code>, of type <code>CLOB</code>.
<code>CLOB</code> stands for character large objects, which are used to store string data too large to be stored in a <code>VARCHAR</code> column.
<code>SPECIFICATION</code> is mapped to the field <code>Part.specification</code> of type <code>java.lang.String</code>.
The <code>@Lob</code> annotation is also used here to denote that the field is a large object:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">@Column(table="PERSISTENCE_ORDER_PART_DETAIL")
@Lob
public String getSpecification() {
    return specification;
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>Both of these fields use the <code>@Column</code> annotation and set the <code>table</code> element to the secondary table.</p>
</div>
</div>
<div class="sect2">
<h3 id="_temporal_types_in_the_order_application"><a class="anchor" href="#_temporal_types_in_the_order_application"></a>Temporal Types in the order Application</h3>
<div class="paragraph">
<p>The <code>CustomerOrder.lastUpdate</code> persistent property, which is of type <code>java.util.Date</code>, is mapped to the <code>PERSISTENCE_ORDER_CUSTOMERORDER.LASTUPDATE</code> database field, which is of the SQL type <code>TIMESTAMP</code>.
To ensure the proper mapping between these types, you must use the <code>@Temporal</code> annotation with the proper temporal type specified in <code>@Temporal</code>'s element.
<code>@Temporal</code>'s elements are of type <code>jakarta.persistence.TemporalType</code>.
The possible values are</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>DATE</code>, which maps to <code>java.sql.Date</code></p>
</li>
<li>
<p><code>TIME</code>, which maps to <code>java.sql.Time</code></p>
</li>
<li>
<p><code>TIMESTAMP</code>, which maps to <code>java.sql.Timestamp</code></p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Here is the relevant section of <code>CustomerOrder</code>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">@Temporal(TIMESTAMP)
public Date getLastUpdate() {
    return lastUpdate;
}</code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_managing_the_order_applications_entities"><a class="anchor" href="#_managing_the_order_applications_entities"></a>Managing the order Application&#8217;s Entities</h3>
<div class="paragraph">
<p>The <code>RequestBean</code> stateful session bean contains the business logic and manages the entities of <code>order</code>.
<code>RequestBean</code> uses the <code>@PersistenceContext</code> annotation to retrieve an entity manager instance, which is used to manage <code>order</code>'s entities in <code>RequestBean</code>'s business methods:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">@PersistenceContext
private EntityManager em;</code></pre>
</div>
</div>
<div class="paragraph">
<p>This <code>EntityManager</code> instance is a container-managed entity manager, so the container takes care of all the transactions involved in managing <code>order</code>'s entities.</p>
</div>
<div class="sect3">
<h4 id="_creating_entities"><a class="anchor" href="#_creating_entities"></a>Creating Entities</h4>
<div class="paragraph">
<p>The <code>RequestBean.createPart</code> business method creates a new <code>Part</code> entity.
The <code>EntityManager.persist</code> method is used to persist the newly created entity to the database:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">Part part = new Part(partNumber,
        revision,
        description,
        revisionDate,
        specification,
        drawing);
em.persist(part);</code></pre>
</div>
</div>
<div class="paragraph">
<p>The <code>ConfigBean</code> singleton session bean is used to initialize the data in <code>order</code>.
<code>ConfigBean</code> is annotated with <code>@Startup</code>, which indicates that the enterprise bean container should create <code>ConfigBean</code> when <code>order</code> is deployed.
The <code>createData</code> method is annotated with <code>@PostConstruct</code> and creates the initial entities used by <code>order</code> by calling <code>RequestBean</code>'s business methods.</p>
</div>
</div>
<div class="sect3">
<h4 id="_finding_entities"><a class="anchor" href="#_finding_entities"></a>Finding Entities</h4>
<div class="paragraph">
<p>The <code>RequestBean.getOrderPrice</code> business method returns the price of a given order based on the <code>orderId</code>.
The <code>EntityManager.find</code> method is used to retrieve the entity from the database:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">CustomerOrder order = em.find(CustomerOrder.class, orderId);</code></pre>
</div>
</div>
<div class="paragraph">
<p>The first argument of <code>EntityManager.find</code> is the entity class, and the second is the primary key.</p>
</div>
</div>
<div class="sect3">
<h4 id="_setting_entity_relationships"><a class="anchor" href="#_setting_entity_relationships"></a>Setting Entity Relationships</h4>
<div class="paragraph">
<p>The <code>RequestBean.createVendorPart</code> business method creates a <code>VendorPart</code> associated with a particular <code>Vendor</code>.
The <code>EntityManager.persist</code> method is used to persist the newly created <code>VendorPart</code> entity to the database, and the <code>VendorPart.setVendor</code> and <code>Vendor.setVendorPart</code> methods are used to associate the <code>VendorPart</code> with the <code>Vendor</code>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">PartKey pkey = new PartKey();
pkey.setPartNumber(partNumber);
pkey.setRevision(revision);

Part part = em.find(Part.class, pkey);

VendorPart vendorPart = new VendorPart(description, price, part);
em.persist(vendorPart);

Vendor vendor = em.find(Vendor.class, vendorId);
vendor.addVendorPart(vendorPart);
vendorPart.setVendor(vendor);</code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_using_queries"><a class="anchor" href="#_using_queries"></a>Using Queries</h4>
<div class="paragraph">
<p>The <code>RequestBean.adjustOrderDiscount</code> business method updates the discount applied to all orders.
This method uses the <code>findAllOrders</code> named query, defined in <code>CustomerOrder</code>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">@NamedQuery(
    name="findAllOrders",
    query="SELECT co FROM CustomerOrder co " +
          "ORDER BY co.orderId"
)</code></pre>
</div>
</div>
<div class="paragraph">
<p>The <code>EntityManager.createNamedQuery</code> method is used to run the query.
Because the query returns a <code>List</code> of all the orders, the <code>Query.getResultList</code> method is used:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">List orders = em.createNamedQuery(
        "findAllOrders")
        .getResultList();</code></pre>
</div>
</div>
<div class="paragraph">
<p>The <code>RequestBean.getTotalPricePerVendor</code> business method returns the total price of all the parts for a particular vendor.
This method uses a named parameter, <code>id</code>, defined in the named query <code>findTotalVendorPartPricePerVendor</code> defined in <code>VendorPart</code>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">@NamedQuery(
    name="findTotalVendorPartPricePerVendor",
    query="SELECT SUM(vp.price) " +
    "FROM VendorPart vp " +
    "WHERE vp.vendor.vendorId = :id"
)</code></pre>
</div>
</div>
<div class="paragraph">
<p>When running the query, the <code>Query.setParameter</code> method is used to set the named parameter <code>id</code> to the value of <code>vendorId</code>, the parameter to <code>RequestBean.getTotalPricePerVendor</code>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">return (Double) em.createNamedQuery(
    "findTotalVendorPartPricePerVendor")
    .setParameter("id", vendorId)
    .getSingleResult();</code></pre>
</div>
</div>
<div class="paragraph">
<p>The <code>Query.getSingleResult</code> method is used for this query because the query returns a single value.</p>
</div>
</div>
<div class="sect3">
<h4 id="_removing_entities"><a class="anchor" href="#_removing_entities"></a>Removing Entities</h4>
<div class="paragraph">
<p>The <code>RequestBean.removeOrder</code> business method deletes a given order from the database.
This method uses the <code>EntityManager.remove</code> method to delete the entity from the database:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">CustomerOrder order = em.find(CustomerOrder.class, orderId);
em.remove(order);</code></pre>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_running_the_order_example"><a class="anchor" href="#_running_the_order_example"></a>Running the order Example</h3>
<div class="paragraph">
<p>You can use either NetBeans IDE or Maven to build, package, deploy, and run the <code>order</code> application.
First, you will create the database tables in Apache Derby.</p>
</div>
<div class="sect3">
<h4 id="_to_run_the_order_example_using_netbeans_ide"><a class="anchor" href="#_to_run_the_order_example_using_netbeans_ide"></a>To Run the order Example Using NetBeans IDE</h4>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Make sure that GlassFish Server has been started (see <a href="../../intro/usingexamples/usingexamples.html#_starting_and_stopping_glassfish_server" class="xref page">Starting and Stopping GlassFish Server</a>).</p>
</li>
<li>
<p>If the database server is not already running, start it by following the instructions in <a href="../../intro/usingexamples/usingexamples.html#_starting_and_stopping_apache_derby" class="xref page">Starting and Stopping Apache Derby</a>.</p>
</li>
<li>
<p>From the <strong>File</strong> menu, choose <strong>Open Project</strong>.</p>
</li>
<li>
<p>In the <strong>Open Project</strong> dialog box, navigate to:</p>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-asciidoc hljs" data-lang="asciidoc">jakartaee-examples/tutorial/persistence</code></pre>
</div>
</div>
</li>
<li>
<p>Select the <code>order</code> folder.</p>
</li>
<li>
<p>Click <strong>Open Project</strong>.</p>
</li>
<li>
<p>In the <strong>Projects</strong> tab, right-click the <code>order</code> project and select <strong>Run</strong>.</p>
<div class="paragraph">
<p>NetBeans IDE opens a web browser to the following URL:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-asciidoc hljs" data-lang="asciidoc">http://localhost:8080/order/</code></pre>
</div>
</div>
</li>
</ol>
</div>
</div>
<div class="sect3">
<h4 id="_to_run_the_order_example_using_maven"><a class="anchor" href="#_to_run_the_order_example_using_maven"></a>To Run the order Example Using Maven</h4>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Make sure that GlassFish Server has been started (see <a href="../../intro/usingexamples/usingexamples.html#_starting_and_stopping_glassfish_server" class="xref page">Starting and Stopping GlassFish Server</a>).</p>
</li>
<li>
<p>If the database server is not already running, start it by following the instructions in <a href="../../intro/usingexamples/usingexamples.html#_starting_and_stopping_apache_derby" class="xref page">Starting and Stopping Apache Derby</a>.</p>
</li>
<li>
<p>In a terminal window, go to:</p>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-asciidoc hljs" data-lang="asciidoc">jakartaee-examples/tutorial/persistence/order/</code></pre>
</div>
</div>
</li>
<li>
<p>Enter the following command:</p>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-shell hljs" data-lang="shell">mvn install</code></pre>
</div>
</div>
<div class="paragraph">
<p>This compiles the source files and packages the application into a WAR file located at <code><em>jakartaee-examples</em>/tutorial/persistence/order/target/order.war</code>.
Then the WAR file is deployed to your GlassFish Server instance.</p>
</div>
</li>
<li>
<p>To create and update the order data, open a web browser to the following URL:</p>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-asciidoc hljs" data-lang="asciidoc">http://localhost:8080/order/</code></pre>
</div>
</div>
</li>
</ol>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_the_roster_application"><a class="anchor" href="#_the_roster_application"></a>The roster Application</h2>
<div class="sectionbody">
<div class="paragraph">
<p>The <code>roster</code> application maintains the team rosters for players in recreational sports leagues.
The application has four components: Jakarta Persistence entities (<code>Player</code>, <code>Team</code>, and <code>League</code>), a stateful session bean (<code>RequestBean</code>), an application client (<code>RosterClient</code>), and three helper classes (<code>PlayerDetails</code>, <code>TeamDetails</code>, and <code>LeagueDetails</code>).</p>
</div>
<div class="paragraph">
<p>Functionally, <code>roster</code> is similar to the <code>order</code> application, with three new features that <code>order</code> does not have: many-to-many relationships, entity inheritance, and automatic table creation at deployment time.</p>
</div>
<div class="paragraph">
<p>The database schema in Apache Derby for the <code>roster</code> application is shown in <a href="#_database_schema_for_the_roster_application">Figure 2, &#8220;Database Schema for the roster Application&#8221;</a>.</p>
</div>
<div id="_database_schema_for_the_roster_application" class="imageblock">
<div class="content">
<img src="../../common/_images/jakartaeett_dt_025.svg" alt="Diagram showing the database schema for the roster application">
</div>
<div class="title">Figure 2. Database Schema for the roster Application</div>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
In this diagram, for simplicity, the <code>PERSISTENCE_ROSTER_</code> prefix is omitted from the table names.
</td>
</tr>
</table>
</div>
<div class="sect2">
<h3 id="_relationships_in_the_roster_application"><a class="anchor" href="#_relationships_in_the_roster_application"></a>Relationships in the roster Application</h3>
<div class="paragraph">
<p>A recreational sports system has the following relationships.</p>
</div>
<div class="ulist">
<ul>
<li>
<p>A player can be on many teams.</p>
</li>
<li>
<p>A team can have many players.</p>
</li>
<li>
<p>A team is in exactly one league.</p>
</li>
<li>
<p>A league has many teams.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>In <code>roster</code> this system is reflected by the following relationships between the <code>Player</code>, <code>Team</code>, and <code>League</code> entities.</p>
</div>
<div class="ulist">
<ul>
<li>
<p>There is a many-to-many relationship between <code>Player</code> and <code>Team</code>.</p>
</li>
<li>
<p>There is a many-to-one relationship between <code>Team</code> and <code>League</code>.</p>
</li>
</ul>
</div>
<div class="sect3">
<h4 id="_the_many_to_many_relationship_in_roster"><a class="anchor" href="#_the_many_to_many_relationship_in_roster"></a>The Many-To-Many Relationship in roster</h4>
<div class="paragraph">
<p>The many-to-many relationship between <code>Player</code> and <code>Team</code> is specified by using the <code>@ManyToMany</code> annotation.
In <code>Team.java</code>, the <code>@ManyToMany</code> annotation decorates the <code>getPlayers</code> method:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">@ManyToMany
@JoinTable(
    name="PERSISTENCE_ROSTER_TEAM_PLAYER",
    joinColumns=
        @JoinColumn(name="TEAM_ID", referencedColumnName="ID"),
    inverseJoinColumns=
        @JoinColumn(name="PLAYER_ID", referencedColumnName="ID")
)
public Collection&lt;Player&gt; getPlayers() {
    return players;
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>The <code>@JoinTable</code> annotation is used to specify a database table that will associate player IDs with team IDs.
The entity that specifies the <code>@JoinTable</code> is the owner of the relationship, so the <code>Team</code> entity is the owner of the relationship with the <code>Player</code> entity.
Because <code>roster</code> uses automatic table creation at deployment time, the container will create a join table named <code>PERSISTENCE_ROSTER_TEAM_PLAYER</code>.</p>
</div>
<div class="paragraph">
<p><code>Player</code> is the inverse, or nonowning, side of the relationship with <code>Team</code>.
As one-to-one and many-to-one relationships, the nonowning side is marked by the <code>mappedBy</code> element in the relationship annotation.
Because the relationship between <code>Player</code> and <code>Team</code> is bidirectional, the choice of which entity is the owner of the relationship is arbitrary.</p>
</div>
<div class="paragraph">
<p>In <code>Player.java</code>, the <code>@ManyToMany</code> annotation decorates the <code>getTeams</code> method:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">@ManyToMany(mappedBy="players")
public Collection&lt;Team&gt; getTeams() {
    return teams;
}</code></pre>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_entity_inheritance_in_the_roster_application"><a class="anchor" href="#_entity_inheritance_in_the_roster_application"></a>Entity Inheritance in the roster Application</h3>
<div class="paragraph">
<p>The <code>roster</code> application shows how to use entity inheritance, as described in <a href="../persistence-intro/persistence-intro.html#_entity_inheritance" class="xref page">Entity Inheritance</a>.</p>
</div>
<div class="paragraph">
<p>The <code>League</code> entity in <code>roster</code> is an abstract entity with two concrete subclasses: <code>SummerLeague</code> and <code>WinterLeague</code>.
Because <code>League</code> is an abstract class, it cannot be instantiated:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">@Entity
@Table(name = "PERSISTENCE_ROSTER_LEAGUE")
public abstract class League implements Serializable { ... }</code></pre>
</div>
</div>
<div class="paragraph">
<p>Instead, when creating a league, clients use <code>SummerLeague</code> or <code>WinterLeague</code>.
<code>SummerLeague</code> and <code>WinterLeague</code> inherit the persistent properties defined in <code>League</code> and add only a constructor that verifies that the sport parameter matches the type of sport allowed in that seasonal league.
For example, here is the <code>SummerLeague</code> entity:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">...
@Entity
public class SummerLeague extends League implements Serializable {

    /** Creates a new instance of SummerLeague */
    public SummerLeague() {
    }

    public SummerLeague(String id, String name, String sport)
            throws IncorrectSportException {
        this.id = id;
        this.name = name;
        if (sport.equalsIgnoreCase("swimming") ||
                sport.equalsIgnoreCase("soccer") ||
                sport.equalsIgnoreCase("basketball") ||
                sport.equalsIgnoreCase("baseball")) {
            this.sport = sport;
        } else {
            throw new IncorrectSportException("Sport is not a summer sport.");
        }
    }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>The <code>roster</code> application uses the default mapping strategy of <code>InheritanceType.SINGLE_TABLE</code>, so the <code>@Inheritance</code> annotation is not required.
If you want to use a different mapping strategy, decorate <code>League</code> with <code>@Inheritance</code> and specify the mapping strategy in the <code>strategy</code> element:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">@Entity
@Inheritance(strategy=JOINED)
@Table(name="PERSISTENCE_ROSTER_LEAGUE")
public abstract class League implements Serializable { ... }</code></pre>
</div>
</div>
<div class="paragraph">
<p>The <code>roster</code> application uses the default discriminator column name, so the <code>@DiscriminatorColumn</code> annotation is not required.
Because you are using automatic table generation in <code>roster</code>, the Persistence provider will create a discriminator column called <code>DTYPE</code> in the <code>PERSISTENCE_ROSTER_LEAGUE</code> table, which will store the name of the inherited entity used to create the league.
If you want to use a different name for the discriminator column, decorate <code>League</code> with <code>@DiscriminatorColumn</code> and set the <code>name</code> element:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">@Entity
@DiscriminatorColumn(name="DISCRIMINATOR")
@Table(name="PERSISTENCE_ROSTER_LEAGUE")
public abstract class League implements Serializable { ... }</code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_criteria_queries_in_the_roster_application"><a class="anchor" href="#_criteria_queries_in_the_roster_application"></a>Criteria Queries in the roster Application</h3>
<div class="paragraph">
<p>The <code>roster</code> application uses Criteria API queries, as opposed to the JPQL queries used in <code>order</code>.
Criteria queries are Java programming language, typesafe queries defined in the business tier of <code>roster</code>, in the <code>RequestBean</code> stateful session bean.</p>
</div>
<div class="sect3">
<h4 id="_metamodel_classes_in_the_roster_application"><a class="anchor" href="#_metamodel_classes_in_the_roster_application"></a>Metamodel Classes in the roster Application</h4>
<div class="paragraph">
<p>Metamodel classes model an entity&#8217;s attributes and are used by Criteria queries to navigate to an entity&#8217;s attributes.
Each entity class in <code>roster</code> has a corresponding metamodel class, generated at compile time, with the same package name as the entity and appended with an underscore character (<code>_</code>).
For example, the <code>roster.entity.Player</code> entity has a corresponding metamodel class, <code>roster.entity.Player_</code>.</p>
</div>
<div class="paragraph">
<p>Each persistent field or property in the entity class has a corresponding attribute in the entity&#8217;s metamodel class.
For the <code>Player</code> entity, the corresponding metamodel class is as follows:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">@StaticMetamodel(Player.class)
public class Player_ {
    public static volatile SingularAttribute&lt;Player, String&gt; id;
    public static volatile SingularAttribute&lt;Player, String&gt; name;
    public static volatile SingularAttribute&lt;Player, String&gt; position;
    public static volatile SingularAttribute&lt;Player, Double&gt; salary;
    public static volatile CollectionAttribute&lt;Player, Team&gt; teams;
}</code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_obtaining_a_criteriabuilder_instance_in_requestbean"><a class="anchor" href="#_obtaining_a_criteriabuilder_instance_in_requestbean"></a>Obtaining a CriteriaBuilder Instance in RequestBean</h4>
<div class="paragraph">
<p>The <code>CriteriaBuilder</code> interface defines methods to create criteria query objects and create expressions for modifying those query objects.
<code>RequestBean</code> creates an instance of <code>CriteriaBuilder</code> by using a <code>@PostConstruct</code> method, <code>init</code>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">@PersistenceContext
private EntityManager em;
private CriteriaBuilder cb;

@PostConstruct
private void init() {
    cb = em.getCriteriaBuilder();
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>The <code>EntityManager</code> instance is injected at runtime, and then that <code>EntityManager</code> object is used to create the <code>CriteriaBuilder</code> instance by calling <code>getCriteriaBuilder</code>.
The <code>CriteriaBuilder</code> instance is created in a <code>@PostConstruct</code> method to ensure that the <code>EntityManager</code> instance has been injected by the enterprise bean container.</p>
</div>
</div>
<div class="sect3">
<h4 id="_creating_criteria_queries_in_requestbeans_business_methods"><a class="anchor" href="#_creating_criteria_queries_in_requestbeans_business_methods"></a>Creating Criteria Queries in RequestBean&#8217;s Business Methods</h4>
<div class="paragraph">
<p>Many of the business methods in <code>RequestBean</code> define Criteria queries.
One business method, <code>getPlayersByPosition</code>, returns a list of players who play a particular position on a team:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">public List&lt;PlayerDetails&gt; getPlayersByPosition(String position) {
    logger.info("getPlayersByPosition");
    List&lt;Player&gt; players = null;

    try {
        CriteriaQuery&lt;Player&gt; cq = cb.createQuery(Player.class);
        if (cq != null) {
            Root&lt;Player&gt; player = cq.from(Player.class);

            // set the where clause
            cq.where(cb.equal(player.get(Player_.position), position));
            cq.select(player);
            TypedQuery&lt;Player&gt; q = em.createQuery(cq);
            players = q.getResultList();
        }
        return copyPlayersToDetails(players);
    } catch (Exception ex) {
        throw new EJBException(ex);
    }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>A query object is created by calling the <code>CriteriaBuilder</code> object&#8217;s <code>createQuery</code> method, with the type set to <code>Player</code> because the query will return a list of players.</p>
</div>
<div class="paragraph">
<p>The query root, the base entity from which the query will navigate to find the entity&#8217;s attributes and related entities, is created by calling the <code>from</code> method of the query object.
This sets the <code>FROM</code> clause of the query.</p>
</div>
<div class="paragraph">
<p>The <code>WHERE</code> clause, set by calling the <code>where</code> method on the query object, restricts the results of the query according to the conditions of an expression.
The <code>CriteriaBuilder.equal</code> method compares the two expressions.
In <code>getPlayersByPosition</code>, the <code>position</code> attribute of the <code>Player_</code> metamodel class, accessed by calling the <code>get</code> method of the query root, is compared to the <code>position</code> parameter passed to <code>getPlayersByPosition</code>.</p>
</div>
<div class="paragraph">
<p>The <code>SELECT</code> clause of the query is set by calling the <code>select</code> method of the query object.
The query will return <code>Player</code> entities, so the query root object is passed as a parameter to <code>select</code>.</p>
</div>
<div class="paragraph">
<p>The query object is prepared for execution by calling <code>EntityManager.createQuery</code>, which returns a <code>TypedQuery&lt;T&gt;</code> object with the type of the query, in this case <code>Player</code>.
This typed query object is used to execute the query, which occurs when the <code>getResultList</code> method is called, and a <code>List&lt;Player&gt;</code> collection is returned.</p>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_automatic_table_generation_in_the_roster_application"><a class="anchor" href="#_automatic_table_generation_in_the_roster_application"></a>Automatic Table Generation in the roster Application</h3>
<div class="paragraph">
<p>At deployment time, GlassFish Server will automatically drop and create the database tables used by <code>roster</code>.
This is done by setting the <code>jakarta.persistence.schema-generation.database.action</code> property to <code>drop-and-create</code> in <code>persistence.xml</code>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-xml hljs" data-lang="xml">&lt;?xml version="1.0" encoding="UTF-8"?&gt;
&lt;persistence version="3.0"
    xmlns="https://jakarta.ee/xml/ns/persistence"
    xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
    xsi:schemaLocation="https://jakarta.ee/xml/ns/persistence
        https://jakarta.ee/xml/ns/persistence/persistence_3_0.xsd"&gt;
  &lt;persistence-unit name="em" transaction-type="JTA"&gt;
    &lt;jta-data-source&gt;java:comp/DefaultDataSource&lt;/jta-data-source&gt;
    &lt;properties&gt;
      &lt;property name="jakarta.persistence.schema-generation.database.action"
                value="drop-and-create"/&gt;
    &lt;/properties&gt;
  &lt;/persistence-unit&gt;
&lt;/persistence&gt;</code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_running_the_roster_example"><a class="anchor" href="#_running_the_roster_example"></a>Running the roster Example</h3>
<div class="paragraph">
<p>You can use either NetBeans IDE or Maven to build, package, deploy, and run the <code>roster</code> application.</p>
</div>
<div class="sect3">
<h4 id="_to_run_the_roster_example_using_netbeans_ide"><a class="anchor" href="#_to_run_the_roster_example_using_netbeans_ide"></a>To Run the roster Example Using NetBeans IDE</h4>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Make sure that GlassFish Server has been started (see <a href="../../intro/usingexamples/usingexamples.html#_starting_and_stopping_glassfish_server" class="xref page">Starting and Stopping GlassFish Server</a>).</p>
</li>
<li>
<p>If the database server is not already running, start it by following the instructions in <a href="../../intro/usingexamples/usingexamples.html#_starting_and_stopping_apache_derby" class="xref page">Starting and Stopping Apache Derby</a>.</p>
</li>
<li>
<p>From the <strong>File</strong> menu, choose <strong>Open Project</strong>.</p>
</li>
<li>
<p>In the <strong>Open Project</strong> dialog box, navigate to:</p>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-asciidoc hljs" data-lang="asciidoc">jakartaee-examples/tutorial/persistence</code></pre>
</div>
</div>
</li>
<li>
<p>Select the <code>roster</code> folder.</p>
</li>
<li>
<p>Select the <strong>Open Required Projects</strong> check box.</p>
</li>
<li>
<p>Click <strong>Open Project</strong>.</p>
</li>
<li>
<p>In the <strong>Projects</strong> tab, right-click the <code>roster</code> project and select <strong>Build</strong>.</p>
<div class="paragraph">
<p>This will compile, package, and deploy the EAR to GlassFish Server.</p>
</div>
<div class="paragraph">
<p>You will see the following partial output from the application client in the Output tab:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-asciidoc hljs" data-lang="asciidoc">List all players in team T2:
P6 Ian Carlyle goalkeeper 555.0
P7 Rebecca Struthers midfielder 777.0
P8 Anne Anderson forward 65.0
P9 Jan Wesley defender 100.0
P10 Terry Smithson midfielder 100.0

List all teams in league L1:
T1 Honey Bees Visalia
T2 Gophers Manteca
T5 Crows Orland

List all defenders:
P2 Alice Smith defender 505.0
P5 Barney Bold defender 100.0
P9 Jan Wesley defender 100.0
P22 Janice Walker defender 857.0
P25 Frank Fletcher defender 399.0</code></pre>
</div>
</div>
</li>
</ol>
</div>
</div>
<div class="sect3">
<h4 id="_to_run_the_roster_example_using_maven"><a class="anchor" href="#_to_run_the_roster_example_using_maven"></a>To Run the roster Example Using Maven</h4>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Make sure that GlassFish Server has been started (see <a href="../../intro/usingexamples/usingexamples.html#_starting_and_stopping_glassfish_server" class="xref page">Starting and Stopping GlassFish Server</a>).</p>
</li>
<li>
<p>If the database server is not already running, start it by following the instructions in <a href="../../intro/usingexamples/usingexamples.html#_starting_and_stopping_apache_derby" class="xref page">Starting and Stopping Apache Derby</a>.</p>
</li>
<li>
<p>In a terminal window, go to:</p>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-asciidoc hljs" data-lang="asciidoc">jakartaee-examples/tutorial/persistence/roster/roster-ear/</code></pre>
</div>
</div>
</li>
<li>
<p>Enter the following command:</p>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-shell hljs" data-lang="shell">mvn install</code></pre>
</div>
</div>
<div class="paragraph">
<p>This compiles the source files and packages the application into an EAR file located at <code><em>jakartaee-examples</em>/tutorial/persistence/roster/target/roster.ear</code>.
The EAR file is then deployed to GlassFish Server.
GlassFish Server will then drop and create the database tables during deployment, as specified in <code>persistence.xml</code>.</p>
</div>
<div class="paragraph">
<p>After successfully deploying the EAR, the client stubs are retrieved and the application client is run using the appclient application included with GlassFish Server.</p>
</div>
<div class="paragraph">
<p>You will see the output, which begins as follows:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-asciidoc hljs" data-lang="asciidoc">[echo] running application client container.
[exec] List all players in team T2:
[exec] P6 Ian Carlyle goalkeeper 555.0
[exec] P7 Rebecca Struthers midfielder 777.0
[exec] P8 Anne Anderson forward 65.0
[exec] P9 Jan Wesley defender 100.0
[exec] P10 Terry Smithson midfielder 100.0

[exec] List all teams in league L1:
[exec] T1 Honey Bees Visalia
[exec] T2 Gophers Manteca
[exec] T5 Crows Orland

[exec] List all defenders:
[exec] P2 Alice Smith defender 505.0
[exec] P5 Barney Bold defender 100.0
[exec] P9 Jan Wesley defender 100.0
[exec] P22 Janice Walker defender 857.0
[exec] P25 Frank Fletcher defender 399.0</code></pre>
</div>
</div>
</li>
</ol>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_the_address_book_application"><a class="anchor" href="#_the_address_book_application"></a>The address-book Application</h2>
<div class="sectionbody">
<div class="paragraph">
<p>The <code>address-book</code> example application is a simple web application that stores contact data.
It uses a single entity class, <code>Contact</code>, that uses Jakarta Bean Validation to validate the data stored in the persistent attributes of the entity, as described in <a href="../persistence-intro/persistence-intro.html#_validating_persistent_fields_and_properties" class="xref page">Validating Persistent Fields and Properties</a>.</p>
</div>
<div class="sect2">
<h3 id="_bean_validation_constraints_in_address_book"><a class="anchor" href="#_bean_validation_constraints_in_address_book"></a>Bean Validation Constraints in address-book</h3>
<div class="paragraph">
<p>The <code>Contact</code> entity uses the <code>@NotNull</code>, <code>@Pattern</code>, and <code>@Past</code> constraints on the persistent attributes.</p>
</div>
<div class="paragraph">
<p>The <code>@NotNull</code> constraint marks the attribute as a required field.
The attribute must be set to a non-null value before the entity can be persisted or modified.
Bean Validation will throw a validation error if the attribute is null when the entity is persisted or modified.</p>
</div>
<div class="paragraph">
<p>The <code>@Pattern</code> constraint defines a regular expression that the value of the attribute must match before the entity can be persisted or modified.
This constraint has two different uses in <code>address-book</code>.</p>
</div>
<div class="ulist">
<ul>
<li>
<p>The regular expression declared in the <code>@Pattern</code> annotation on the <code>email</code> field matches email addresses of the form name<code>@</code>domain name<code>.</code>top level domain, allowing only valid characters for email addresses.
For example, <code>username@example.com</code> will pass validation, as will <code>firstname.lastname@mail.example.com</code>.
However, <code>firstname,lastname@example.com</code>, which contains an illegal comma character in the local name, will fail validation.</p>
</li>
<li>
<p>The <code>mobilePhone</code> and <code>homePhone</code> fields are annotated with a <code>@Pattern</code> constraint that defines a regular expression to match phone numbers of the form <code>(</code>xxx<code>)</code> xxx<code>-</code>xxxx.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>The <code>@Past</code> constraint is applied to the birthday field, which must be a <code>java.util.Date</code> in the past.</p>
</div>
<div class="paragraph">
<p>Here are the relevant parts of the <code>Contact</code> entity class:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">@Entity
public class Contact implements Serializable {
    @Id
    @GeneratedValue(strategy = GenerationType.AUTO)
    private Long id;
    @NotNull
    protected String firstName;
    @NotNull
    protected String lastName;
    @Pattern(regexp = "[a-z0-9!#$%&amp;'*+/=?^_`{|}~-]+(?:\\."
            + "[a-z0-9!#$%&amp;'*+/=?^_`{|}~-]+)*@"
            + "(?:[a-z0-9](?:[a-z0-9-]*[a-z0-9])?\\.)+[a-z0-9]"
            + "(?:[a-z0-9-]*[a-z0-9])?",
            message = "{invalid.email}")
    protected String email;
    @Pattern(regexp = "^\\(?(\\d{3})\\)?[- ]?(\\d{3})[- ]?(\\d{4})$",
            message = "{invalid.phonenumber}")
    protected String mobilePhone;
    @Pattern(regexp = "^\\(?(\\d{3})\\)?[- ]?(\\d{3})[- ]?(\\d{4})$",
            message = "{invalid.phonenumber}")
    protected String homePhone;
    @Temporal(jakarta.persistence.TemporalType.DATE)
    @Past
    protected Date birthday;
    ...
}</code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_specifying_error_messages_for_constraints_in_address_book"><a class="anchor" href="#_specifying_error_messages_for_constraints_in_address_book"></a>Specifying Error Messages for Constraints in address-book</h3>
<div class="paragraph">
<p>Some of the constraints in the <code>Contact</code> entity specify an optional message:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">@Pattern(regexp = "^\\(?(\\d{3})\\)?[- ]?(\\d{3})[- ]?(\\d{4})$",
        message = "{invalid.phonenumber}")
protected String homePhone;</code></pre>
</div>
</div>
<div class="paragraph">
<p>The optional message element in the <code>@Pattern</code> constraint overrides the default validation message.
The message can be specified directly:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">@Pattern(regexp = "^\\(?(\\d{3})\\)?[- ]?(\\d{3})[- ]?(\\d{4})$",
        message = "Invalid phone number!")
protected String homePhone;</code></pre>
</div>
</div>
<div class="paragraph">
<p>The constraints in <code>Contact</code>, however, are strings in the resource bundle <code>ValidationMessages.properties</code>, under <code><em>jakartaee-examples</em>/tutorial/persistence/address-book/src/main/java</code>.
This allows the validation messages to be located in one single properties file and the messages to be easily localized.
Overridden Bean Validation messages must be placed in a resource bundle properties file named <code>ValidationMessages.properties</code> in the default package, with localized resource bundles taking the form <code>ValidationMessages<em>_locale-prefix</em>.properties</code>.
For example, <code>ValidationMessages_es.properties</code> is the resource bundle used in Spanish-speaking locales.</p>
</div>
</div>
<div class="sect2">
<h3 id="_validating_contact_input_from_a_jakarta_faces_application"><a class="anchor" href="#_validating_contact_input_from_a_jakarta_faces_application"></a>Validating Contact Input from a Jakarta Faces Application</h3>
<div class="paragraph">
<p>The <code>address-book</code> application uses a Jakarta Faces web front end to allow users to enter contacts.
While Jakarta Faces has a form input validation mechanism using tags in Facelets XHTML files, <code>address-book</code> doesn&#8217;t use these validation tags.
Bean Validation constraints in Jakarta Faces managed beans, in this case in the <code>Contact</code> entity, automatically trigger validation when the forms are submitted.</p>
</div>
<div class="paragraph">
<p>The following code snippet from the <code>Create.xhtml</code> Facelets file shows some of the input form for creating new <code>Contact</code> instances:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-xml hljs" data-lang="xml">&lt;h:form&gt;
    &lt;table columns="3" role="presentation"&gt;
        &lt;tr&gt;
            &lt;td&gt;&lt;h:outputLabel value="#{bundle.CreateContactLabel_firstName}"
                               for="firstName" /&gt;&lt;/td&gt;
            &lt;td&gt;&lt;h:inputText id="firstName"
                             value="#{contactController.selected.firstName}"
                             title="#{bundle.CreateContactTitle_firstName}"/&gt;
            &lt;/td&gt;
            &lt;td&gt;&lt;h:message for="firstName" /&gt;&lt;/td&gt;
        &lt;/tr&gt;
        &lt;tr&gt;
            &lt;td&gt;&lt;h:outputLabel value="#{bundle.CreateContactLabel_lastName}"
                               for="lastName" /&gt;&lt;/td&gt;
            &lt;td&gt;&lt;h:inputText id="lastName"
                             value="#{contactController.selected.lastName}"
                             title="#{bundle.CreateContactTitle_lastName}" /&gt;
            &lt;/td&gt;
            &lt;td&gt;&lt;h:message for="lastName" /&gt;&lt;/td&gt;
        &lt;/tr&gt;
        ...
    &lt;/table&gt;
&lt;/h:form&gt;</code></pre>
</div>
</div>
<div class="paragraph">
<p>The <code>&lt;h:inputText&gt;</code> tags <code>firstName</code> and <code>lastName</code> are bound to the attributes in the <code>Contact</code> entity instance <code>selected</code> in the <code>ContactController</code> stateless session bean.
Each <code>&lt;h:inputText&gt;</code> tag has an associated <code>&lt;h:message&gt;</code> tag that will display validation error messages.
The form doesn&#8217;t require any Jakarta Faces validation tags, however.</p>
</div>
</div>
<div class="sect2">
<h3 id="_running_the_address_book_example"><a class="anchor" href="#_running_the_address_book_example"></a>Running the address-book Example</h3>
<div class="paragraph">
<p>You can use either NetBeans IDE or Maven to build, package, deploy, and run the <code>address-book</code> application.</p>
</div>
<div class="sect3">
<h4 id="_to_run_the_address_book_example_using_netbeans_ide"><a class="anchor" href="#_to_run_the_address_book_example_using_netbeans_ide"></a>To Run the address-book Example Using NetBeans IDE</h4>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Make sure that GlassFish Server has been started (see <a href="../../intro/usingexamples/usingexamples.html#_starting_and_stopping_glassfish_server" class="xref page">Starting and Stopping GlassFish Server</a>).</p>
</li>
<li>
<p>If the database server is not already running, start it by following the instructions in <a href="../../intro/usingexamples/usingexamples.html#_starting_and_stopping_apache_derby" class="xref page">Starting and Stopping Apache Derby</a>.</p>
</li>
<li>
<p>From the <strong>File</strong> menu, choose <strong>Open Project</strong>.</p>
</li>
<li>
<p>In the <strong>Open Project</strong> dialog box, navigate to:</p>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-asciidoc hljs" data-lang="asciidoc">jakartaee-examples/tutorial/persistence</code></pre>
</div>
</div>
</li>
<li>
<p>Select the <code>address-book</code> folder.</p>
</li>
<li>
<p>Click <strong>Open Project</strong>.</p>
</li>
<li>
<p>In the <strong>Projects</strong> tab, right-click the <code>address-book</code> project and select <strong>Run</strong>.</p>
<div class="paragraph">
<p>After the application has been deployed, a web browser window appears at the following URL:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-asciidoc hljs" data-lang="asciidoc">http://localhost:8080/address-book/</code></pre>
</div>
</div>
</li>
<li>
<p>Click Show All Contact Items, then Create New Contact.
Enter values in the fields; then click Save.</p>
<div class="paragraph">
<p>If any of the values entered violate the constraints in <code>Contact</code>, an error message will appear in red beside the field with the incorrect values.</p>
</div>
</li>
</ol>
</div>
</div>
<div class="sect3">
<h4 id="_to_run_the_address_book_example_using_maven"><a class="anchor" href="#_to_run_the_address_book_example_using_maven"></a>To Run the address-book Example Using Maven</h4>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Make sure that GlassFish Server has been started (see <a href="../../intro/usingexamples/usingexamples.html#_starting_and_stopping_glassfish_server" class="xref page">Starting and Stopping GlassFish Server</a>).</p>
</li>
<li>
<p>If the database server is not already running, start it by following the instructions in <a href="../../intro/usingexamples/usingexamples.html#_starting_and_stopping_apache_derby" class="xref page">Starting and Stopping Apache Derby</a>.</p>
</li>
<li>
<p>In a terminal window, go to:</p>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-asciidoc hljs" data-lang="asciidoc">jakartaee-examples/tutorial/persistence/address-book/</code></pre>
</div>
</div>
</li>
<li>
<p>Enter the following command:</p>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-shell hljs" data-lang="shell">mvn install</code></pre>
</div>
</div>
<div class="paragraph">
<p>This will compile and assemble the <code>address-book</code> application into a WAR.
The WAR file is then deployed to GlassFish Server.</p>
</div>
</li>
<li>
<p>Open a web browser window and enter the following URL:</p>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-asciidoc hljs" data-lang="asciidoc">http://localhost:8080/address-book/</code></pre>
</div>
</div>
</li>
<li>
<p>Click Show All Contact Items, then Create New Contact.
Enter values in the fields; then click Save.</p>
<div class="paragraph">
<p>If any of the values entered violate the constraints in <code>Contact</code>, an error message will appear in red beside the field with the incorrect values.</p>
</div>
</li>
</ol>
</div>
</div>
</div>
</div>
</div>
</article>
  </div>
</main>
</div>
<footer class="footer">
  <p>This page was built using the Antora default UI.</p>
  <p>The source code for this UI is licensed under the terms of the MPL-2.0 license.</p>
</footer>
<script id="site-script" src="../../../../_/js/site.js" data-ui-root-path="../../../../_"></script>
<script async src="../../../../_/js/vendor/highlight.js"></script>
  </body>
</html>
