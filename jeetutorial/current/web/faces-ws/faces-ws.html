<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>Using WebSockets with Jakarta Faces Technology :: Jakarta EE Documentation</title>
    <meta name="generator" content="Antora 3.1.3">
    <link rel="stylesheet" href="../../../../_/css/site.css">
    <script>var uiRootPath = '../../../../_'</script>
    <script>!function (theme) {
        if (theme === 'dark') document.documentElement.classList.add('theme-dark')
      }(localStorage && localStorage.getItem('theme') || (matchMedia('(prefers-color-scheme: dark)') && 'dark'))
    </script>
      </head>
  <body class="article">
<header class="header">
  <nav class="navbar">
    <div class="navbar-brand">
      <a id="site-title" class="navbar-item" href="../../../..">Jakarta EE Documentation</a>
      <button class="navbar-burger" data-target="topbar-nav">
        <span></span>
        <span></span>
        <span></span>
      </button>
    </div>
    <div id="topbar-nav" class="navbar-menu">
      <div class="navbar-end">
<!--
        <a class="navbar-item" href="#">Home</a>
        <div class="navbar-item has-dropdown is-hoverable">
          <a class="navbar-link" href="#">Products</a>
          <div class="navbar-dropdown">
            <a class="navbar-item" href="#">Product A</a>
            <a class="navbar-item" href="#">Product B</a>
            <a class="navbar-item" href="#">Product C</a>
          </div>
        </div>
        <div class="navbar-item has-dropdown is-hoverable">
          <a class="navbar-link" href="#">Services</a>
          <div class="navbar-dropdown">
            <a class="navbar-item" href="#">Service A</a>
            <a class="navbar-item" href="#">Service B</a>
            <a class="navbar-item" href="#">Service C</a>
          </div>
        </div>
 -->
        <div class="navbar-item">
          <span class="control">
            <a class="button is-primary" href="../../../../jakartaee-tutorial/10/jakarta-ee-tutorial.pdf">Download</a>
          </span>
        </div>
      </div>
      <div class="navbar-theme-switcher">
        <span class="switch" title="Switch between Light and Dark Theme">
          <input id="theme-switcher-checkbox" type="checkbox" />
          <label for="theme-switcher-checkbox">Dark Theme</label>
        </span>
      </div>
    </div>
  </nav>
</header>
<div class="body">
<div class="nav-container" data-component="jakartaee-tutorial" data-version="10">
  <aside class="nav">
    <div class="panels">
<div class="nav-panel-menu is-active" data-panel="menu">
  <nav class="nav-menu">
    <h3 class="title"><a href="../../index.html">Jakarta EE Tutorial</a></h3>
<ul class="nav-list">
  <li class="nav-item" data-depth="0">
    <button class="nav-item-toggle"></button>
    <span class="nav-text">Introduction</span>
<ul class="nav-list">
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="../../index.html">Preface</a>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="0">
    <button class="nav-item-toggle"></button>
    <span class="nav-text">Jakarta EE Core Profile</span>
<ul class="nav-list">
  <li class="nav-item" data-depth="1">
    <button class="nav-item-toggle"></button>
    <span class="nav-text">Jakarta CDI Lite</span>
<ul class="nav-list">
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../../cdi/cdi-basic/cdi-basic.html">Introduction to Jakarta Contexts and Dependency Injection</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../../cdi/cdi-basicexamples/cdi-basicexamples.html">Running the Basic Contexts and Dependency Injection Examples</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../../supporttechs/interceptors/interceptors.html">Using Jakarta EE Interceptors</a>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="1">
    <button class="nav-item-toggle"></button>
    <span class="nav-text">Jakarta REST</span>
<ul class="nav-list">
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../../websvcs/jaxrs/jaxrs.html">Building RESTful Web Services with Jakarta REST</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../../websvcs/jaxrs-client/jaxrs-client.html">Accessing REST Resources with the Jakarta REST Client API</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../../websvcs/jaxrs-advanced/jaxrs-advanced.html">Jakarta REST: Advanced Topics and an Example</a>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="1">
    <button class="nav-item-toggle"></button>
    <span class="nav-text">Jakarta JSON</span>
<ul class="nav-list">
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../jsonb/jsonb.html">JSON Binding</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../jsonp/jsonp.html">JSON Processing</a>
  </li>
</ul>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="0">
    <button class="nav-item-toggle"></button>
    <span class="nav-text">Jakarta EE Web Profile</span>
<ul class="nav-list">
  <li class="nav-item" data-depth="1">
    <button class="nav-item-toggle"></button>
    <span class="nav-text">Jakarta CDI Full</span>
<ul class="nav-list">
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../../cdi/cdi-adv/cdi-adv.html">Jakarta Contexts and Dependency Injection: Advanced Topics</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../../cdi/cdi-bootstrap-se8/cdi-bootstrap-se8.html">Bootstrapping a CDI Container in Java SE</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../../cdi/cdi-adv-examples/cdi-adv-examples.html">Running the Advanced Contexts and Dependency Injection Examples</a>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="1">
    <button class="nav-item-toggle"></button>
    <span class="nav-text">Jakarta Validation</span>
<ul class="nav-list">
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../../beanvalidation/bean-validation/bean-validation.html">Introduction to Jakarta Bean Validation</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../../beanvalidation/bean-validation-advanced/bean-validation-advanced.html">Bean Validation: Advanced Topics</a>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="../../security/security.html">Jakarta Security</a>
  </li>
  <li class="nav-item" data-depth="1">
    <button class="nav-item-toggle"></button>
    <span class="nav-text">Jakarta Servlets</span>
<ul class="nav-list">
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../webapp/webapp.html">Getting Started with Web Applications</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../servlets/servlets.html">Jakarta Servlet Technology</a>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="1">
    <button class="nav-item-toggle"></button>
    <span class="nav-text">Jakarta Faces</span>
<ul class="nav-list">
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../faces-intro/faces-intro.html">Jakarta Faces Technology</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../faces-facelets/faces-facelets.html">Introduction to Facelets</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../faces-page/faces-page.html">Using Jakarta Faces Technology in Web Pages</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../faces-page-core/faces-page-core.html">Using Converters, Listeners, and Validators</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../faces-develop/faces-develop.html">Developing with Jakarta Faces Technology</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../faces-ajax/faces-ajax.html">Using Ajax with Jakarta Faces Technology</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../faces-advanced-cc/faces-advanced-cc.html">Composite Components: Advanced Topics and an Example</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../faces-custom/faces-custom.html">Creating Custom UI Components and Other Custom Objects</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../faces-configure/faces-configure.html">Configuring Jakarta Faces Applications</a>
  </li>
  <li class="nav-item is-current-page" data-depth="2">
    <a class="nav-link" href="faces-ws.html">Using WebSockets with Jakarta Faces Technology</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../webi18n/webi18n.html">Internationalizing and Localizing Web Applications</a>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="../websocket/websocket.html">Jakarta WebSocket</a>
  </li>
  <li class="nav-item" data-depth="1">
    <button class="nav-item-toggle"></button>
    <span class="nav-text">Jakarta Persistence</span>
<ul class="nav-list">
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../../persist/persistence-intro/persistence-intro.html">Introduction to Jakarta Persistence</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../../persist/persistence-basicexamples/persistence-basicexamples.html">Running the Persistence Examples</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../../persist/persistence-querylanguage/persistence-querylanguage.html">The Jakarta Persistence Query Language</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../../persist/persistence-criteria/persistence-criteria.html">Using the Criteria API to Create Queries</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../../persist/persistence-string-queries/persistence-string-queries.html">Creating and Using String-Based Criteria Queries</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../../persist/persistence-locking/persistence-locking.html">Controlling Concurrent Access to Entity Data with Locking</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../../persist/persistence-entitygraphs/persistence-entitygraphs.html">Creating Fetch Plans with Entity Graphs</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../../persist/persistence-cache/persistence-cache.html">Using a Second-Level Cache with Jakarta Persistence Applications</a>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="1">
    <button class="nav-item-toggle"></button>
    <span class="nav-text">Jakarta Enterprise Beans Lite</span>
<ul class="nav-list">
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../../entbeans/ejb-intro/ejb-intro.html">Enterprise Beans</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../../entbeans/ejb-gettingstarted/ejb-gettingstarted.html">Getting Started with Enterprise Beans</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../../entbeans/ejb-basicexamples/ejb-basicexamples.html">Running the Enterprise Bean Examples</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../../entbeans/ejb-async/ejb-async.html">Using Asynchronous Method Invocation in Session Beans</a>
  </li>
</ul>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="0">
    <button class="nav-item-toggle"></button>
    <span class="nav-text">Jakarta EE Platform</span>
<ul class="nav-list">
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="../../messaging/mail-api/mail-api.html">Jakarta Mail</a>
  </li>
  <li class="nav-item" data-depth="1">
    <button class="nav-item-toggle"></button>
    <span class="nav-text">Jakarta Messaging</span>
<ul class="nav-list">
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../../messaging/jms-concepts/jms-concepts.html">Jakarta Messaging Concepts</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../../messaging/jms-examples/jms-examples.html">Jakarta Messaging Examples</a>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="../../supporttechs/batch-processing/batch-processing.html">Jakarta Batch</a>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="0">
    <button class="nav-item-toggle"></button>
    <span class="nav-text">Advanced</span>
<ul class="nav-list">
  <li class="nav-item" data-depth="1">
    <button class="nav-item-toggle"></button>
    <span class="nav-text">Web Profile</span>
<ul class="nav-list">
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../../security/security-authentication/security-authentication.html">Jakarta Authentication</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../../security/security-authorization/security-authorization.html">Jakarta Authorization</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../../supporttechs/transactions/transactions.html">Jakarta Transactions</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../../supporttechs/concurrency-utilities/concurrency-utilities.html">Jakarta Concurrency</a>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="1">
    <button class="nav-item-toggle"></button>
    <span class="nav-text">Full Profile</span>
<ul class="nav-list">
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../../supporttechs/connectors/connectors.html">Jakarta Connectors</a>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="1">
    <button class="nav-item-toggle"></button>
    <span class="nav-text">Optional Components</span>
<ul class="nav-list">
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../faces-el/faces-el.html">Jakarta Expression Language</a>
  </li>
  <li class="nav-item" data-depth="2">
    <span class="nav-text">Jakarta XML Binding</span>
  </li>
</ul>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="0">
    <button class="nav-item-toggle"></button>
    <span class="nav-text">Archived</span>
<ul class="nav-list">
  <li class="nav-item" data-depth="1">
    <button class="nav-item-toggle"></button>
    <span class="nav-text">Web Profile</span>
<ul class="nav-list">
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../jakarta-pages/jakarta-pages.html">Jakarta Pages</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../jakarta-tags/jakarta-tags.html">Jakarta Tags</a>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="1">
    <button class="nav-item-toggle"></button>
    <span class="nav-text">Full Profile</span>
<ul class="nav-list">
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../../websvcs/xml-websvcs/xml-websvcs.html">XML Web Services</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../../entbeans/ejb-full/ejb-full.html">Jakarta Enterprise Beans Full</a>
  </li>
</ul>
  </li>
</ul>
  </li>
</ul>
  </nav>
</div>
<div class="nav-panel-explore" data-panel="explore">
  <div class="context">
    <span class="title">Jakarta EE Tutorial</span>
    <span class="version">10</span>
  </div>
  <ul class="components">
    <li class="component is-current">
      <a class="title" href="../../index.html">Jakarta EE Tutorial</a>
      <ul class="versions">
        <li class="version is-current is-latest">
          <a href="../../index.html">10</a>
        </li>
      </ul>
    </li>
  </ul>
</div>
    </div>
  </aside>
</div>
<main class="article">
<div class="toolbar" role="navigation">
<button class="nav-toggle"></button>
<nav class="breadcrumbs" aria-label="breadcrumbs">
  <ul>
    <li><a href="../../index.html">Jakarta EE Tutorial</a></li>
    <li>Jakarta EE Web Profile</li>
    <li>Jakarta Faces</li>
    <li><a href="faces-ws.html">Using WebSockets with Jakarta Faces Technology</a></li>
  </ul>
</nav>
  <div class="edit-this-page"><a href="file:///home/john/workspace/virtua/jakartaee-tutorial/src/main/antora/modules/web/pages/faces-ws/faces-ws.adoc">Edit this Page</a></div>
</div>
  <div class="content">
<aside class="toc sidebar" data-title="Contents" data-levels="2">
  <div class="toc-menu"></div>
</aside>
<article class="doc">
<h1 class="page">Using WebSockets with Jakarta Faces Technology</h1>
<div id="preamble">
<div class="sectionbody">
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>We are working on a fresh, updated Jakarta EE Tutorial. This section hasn&#8217;t yet been updated.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>This chapter describes using WebSockets in Jakarta Faces web applications.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_about_websockets_in_jakarta_faces"><a class="anchor" href="#_about_websockets_in_jakarta_faces"></a>About WebSockets in Jakarta Faces</h2>
<div class="sectionbody">
<div class="paragraph">
<p>You use the <code>f:websocket tag</code> in a view to allow server-side communications to be pushed to all instances of a socket containing the same channel name.
When the communication is received, an <code>onmessage</code>, client-side JavaScript event handler can be set that is called whenever a push arrives from the server.</p>
</div>
<div class="paragraph">
<p>The server side of a WebSocket communication has the ability to push out messages.
You can do this using <code>jakarta.faces.push.PushContext</code>, which is an injectable context, allowing a server push to a named channel.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_configuring_websockets"><a class="anchor" href="#_configuring_websockets"></a>Configuring WebSockets</h2>
<div class="sectionbody">
<div class="paragraph">
<p>To configure WebSockets for use in faces web applications, first enable the WebSocket endpoint using the context parameter in <code>web.xml</code>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-xml hljs" data-lang="xml">&lt;context-param&gt;
    &lt;param-name&gt;jakarta.faces.ENABLE_WEBSOCKET_ENDPOINT&lt;/param-name&gt;
    &lt;param-value&gt;true&lt;/param-value&gt;
&lt;/context-param&gt;</code></pre>
</div>
</div>
<div class="paragraph">
<p>If your server is configured to run a WebSocket container on a different TCP port than the HTTP container, you can use the optional <code>jakarta.faces.WEBSOCKET_ENDPOINT_PORT</code> integer context parameter to explicitly specify the port:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-xml hljs" data-lang="xml">&lt;context-param&gt;
    &lt;param-name&gt;jakarta.faces.WEBSOCKET_ENDPOINT_PORT&lt;/param-name&gt;
    &lt;param-value&gt;8000&lt;/param-value&gt;
&lt;/context-param&gt;</code></pre>
</div>
</div>
<div class="sect2">
<h3 id="_websocket_usage_client_side"><a class="anchor" href="#_websocket_usage_client_side"></a>WebSocket Usage: Client Side</h3>
<div class="paragraph">
<p>Declare the <code>f:websocket tag</code> in the faces view with a channel name and an <code>onmessage</code> JavaScript listener function.</p>
</div>
<div class="paragraph">
<p>The following example refers to an existing JavaScript listener function:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-javascript hljs" data-lang="javascript">&lt;f:websocket channel="someChannel" onmessage="someWebsocketListener" /&gt;

function someWebsocketListener(message, channel, event) { console.log(message); }</code></pre>
</div>
</div>
<div class="paragraph">
<p>This example declares an inline JavaScript listener function:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-xml hljs" data-lang="xml">&lt;f:websocket channel="someChannel" onmessage="function(m){console.log(m);}" /&gt;</code></pre>
</div>
</div>
<div class="paragraph">
<p>The <code>onmessage</code> JavaScript listener function is invoked with three arguments:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>message</code>: The push message as a JSON object</p>
</li>
<li>
<p><code>channel</code>: The channel name</p>
</li>
<li>
<p><code>event</code>: The <code>MessageEvent</code> instance</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>When successfully connected, the WebSocket is open by default for as long as the document is open, and it will auto-reconnect, at increasing intervals, when the connection is closed, or aborted, as a result of events such as a network error or server restart.
It will not auto-reconnect when the very first connection attempt fails.
The WebSocket will be implicitly closed after the document is unloaded.</p>
</div>
</div>
<div class="sect2">
<h3 id="_websocket_usage_server_side"><a class="anchor" href="#_websocket_usage_server_side"></a>WebSocket Usage: Server Side</h3>
<div class="paragraph">
<p>On the Java programming side, inject a <code>PushContext</code> using the <code>@Push</code> annotation on the given channel in any CDI or container managed artifact, such as <code>@Named</code>, or <code>@WebServlet</code>, where you want to send a push message.
Then invoke <code>PushContext.send(Object)</code> with any Java object representing the push message.</p>
</div>
<div class="paragraph">
<p>For example:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">@Inject @Push
private PushContext someChannel;

public void sendMessage(Object message) {
    someChannel.send(message);
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>By default, the name of the channel is taken from the name of the variable into which the injection takes place.</p>
</div>
<div class="paragraph">
<p>Optionally, the channel name can be specified using the <code>channel</code> attribute.
The following example injects the push context for channel name <code>foo</code> into a variable named <code>bar</code>.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">@Inject
@Push(channel="foo")
private PushContext bar;</code></pre>
</div>
</div>
<div class="paragraph">
<p>The message object will be encoded as JSON and delivered as a message argument of the <code>onmessage</code> JavaScript listener function associated with the channel name.
It can be a String, but it can also be a collection, map, or a JavaBean.</p>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_using_the_fwebsocket_tag"><a class="anchor" href="#_using_the_fwebsocket_tag"></a>Using the f:websocket Tag</h2>
<div class="sectionbody">
<div class="paragraph">
<p><a href="#_attributes_of_the_fwebsocket_tag">Attributes of the <code>f:websocket</code> Tag</a> describes the attributes of the <code>f:websocket</code> tag.</p>
</div>
<table id="_attributes_of_the_fwebsocket_tag" class="tableblock frame-all grid-all" style="width: 85%;">
<caption class="title">Attributes of the <code>f:websocket</code> Tag</caption>
<colgroup>
<col style="width: 17.647%;">
<col style="width: 17.647%;">
<col style="width: 64.706%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Name</th>
<th class="tableblock halign-left valign-top">Type</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>channel</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">String</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Required.
The name of the WebSocket channel.
It may not be an EL expression and may only contain alphanumeric characters, hyphens, underscores, and periods.
All open WebSockets on the same channel name will receive the same push notification from the server.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>id</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">String</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Optional.
The identifier of the UIWebSocket component to be created.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>scope</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">String</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Optional.
The scope of the WebSocket channel.
It may not be an EL expression.
Allowed values (case insensitive) are: <code>application</code>, <code>session</code>, and <code>view</code>.</p>
<p class="tableblock">When the value is <code>application</code>, all channels with the same name throughout the application receive the same push message.
When the value is <code>session</code>, only the channels with the same name in the current user session receive the same push message.
When the value is <code>view</code>, only the channel in the current view receives the push message.</p>
<p class="tableblock">The default scope is <code>application</code>.
When the <code>user</code> attribute is specified, then the default scope is <code>session</code>.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>user</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Serializable</p></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p>Optional.
The user identifier of the WebSocket channel, so that user-targeted push messages can be sent.
It must implement Serializable and preferably have a low memory footprint.</p>
</div>
<div class="paragraph">
<p><strong>Hint</strong>: Use <code>#{request.remoteUser}</code> or <code>#{someLoggedInUser.id}</code>.</p>
</div>
<div class="paragraph">
<p>All open WebSockets on the same channel and user will receive the same push message from the server.</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>onopen</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">String</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Optional.
The JavaScript event handler function that is invoked when the WebSocket is opened.
The function is invoked with one argument: the channel name.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>onmessage</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">String</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Optional.
The JavaScript event handler function that is invoked when a push message is received from the server.
The function is invoked with three arguments: the push message, the channel name, and the <code>MessageEvent</code> instance.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>onclose</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">String</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Optional.
The JavaScript event handler function that is invoked when the WebSocket is closed.
The function is invoked with three arguments: the close reason code, the channel name, and the <code>CloseEvent</code>.</p>
<p class="tableblock">Note that this will also be invoked on errors.
If an error occurred, you can inspect the close reason code and which code was given (for example, when the code is not <code>1000</code>).</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>connected</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Boolean</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Optional.
Specifies whether to auto-reconnect the WebSocket.
Defaults to <code>true</code>.
It is interpreted as a JavaScript instruction to open or close the WebSocket push connection.</p>
<p class="tableblock">This attribute is implicitly re-evaluated on every ajax request by a <code>PreRenderViewEvent</code> listener on the <code>UIViewRoot</code>.
You can also explicitly set it to <code>false</code> and then manually control it in JavaScript using <code>faces.push.open(clientId)</code> and <code>faces.push.close(clientId)</code>.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>rendered</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Boolean</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Optional.
Specifies whether to render the WebSocket scripts.
Defaults to <code>true</code>.</p>
<p class="tableblock">This attribute is implicitly re-evaluated on every ajax request by a <code>PreRenderViewEvent</code> listener on the <code>UIViewRoot</code>.
If the value changes to <code>false</code> while the WebSocket is already opened, then the WebSocket will implicitly be closed.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>binding</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">UIComponent</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Optional.
The value binding expression to a backing bean property bound to the component instance for the <code>UIComponent</code> created by this tag.</p></td>
</tr>
</tbody>
</table>
</div>
</div>
<div class="sect1">
<h2 id="_websocket_scopes_and_users"><a class="anchor" href="#_websocket_scopes_and_users"></a>WebSocket Scopes and Users</h2>
<div class="sectionbody">
<div class="paragraph">
<p>By default, the WebSocket is application-scoped.
For example, any view or session throughout the web application having the same WebSocket channel open will receive the same push message.
The push message can be sent by all users and the application.
To restrict the push messages to all views in the current user session only, set the optional scope attribute to <code>session</code> .
In this case, the push message can only be sent by the user and not by the application.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-xml hljs" data-lang="xml">&lt;f:websocket channel="someChannel" scope="session" ... /&gt;</code></pre>
</div>
</div>
<div class="paragraph">
<p>To restrict the push messages to the current view only, you can set the scope attribute to <code>view</code>.
The push message will not show up in other views in the same session, even if it has the same URL.
This push message can be sent only by the user and not by the application.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-xml hljs" data-lang="xml">&lt;f:websocket channel="someChannel" scope="view" ... /&gt;</code></pre>
</div>
</div>
<div class="paragraph">
<p>The scope attribute may not be an EL expression.</p>
</div>
<div class="paragraph">
<p>Additionally, you can set the optional <code>user</code> attribute to the unique identifier of the logged-in user, usually the login name or the user ID.As such, the push message can be targeted to a specific user and can also be sent by other users and the application.
The value of the <code>user</code> attribute must implement <code>Serializable</code> and have a low memory footprint, so an entire user entity is not recommended.</p>
</div>
<div class="paragraph">
<p>For example, when you are using container managed authentication or a related framework or library:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-xml hljs" data-lang="xml">&lt;f:websocket channel="someChannel"user="#{request.remoteUser}" ... /&gt;</code></pre>
</div>
</div>
<div class="paragraph">
<p>Or, when you have a custom user entity accessible via EL, such as <code>#{someLoggedInUser}</code> which has an <code>id</code> property representing its identifier:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-xml hljs" data-lang="xml">&lt;f:websocket channel="someChannel" user="#{someLoggedInUser.id}" ... /&gt;</code></pre>
</div>
</div>
<div class="paragraph">
<p>When the <code>user</code> attribute is specified, the scope defaults to <code>session</code> and cannot be set to <code>application</code>.</p>
</div>
<div class="paragraph">
<p>On the server side, the push message can be targeted to the user specified in the <code>user</code> attribute using <code>PushContext.send(Object, Serializable)</code>.
The push message can be sent by all users and the application.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">@Inject @Push
private PushContext someChannel;

public void sendMessage(Object message, User recipientUser) {
    Long recipientUserId = recipientUser.getId();
    someChannel.send(message, recipientUserId);
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>Multiple users can be targeted by passing a <code>Collection</code> holding user identifiers to <code>PushContext.send(Object, Collection)</code>.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">public void sendMessage(Object message, Group recipientGroup) {
    Collection&lt;Long&gt; recipientUserIds = recipientGroup.getUserIds();
    someChannel.send(message, recipientUserIds);
}</code></pre>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_conditionally_connecting_websockets"><a class="anchor" href="#_conditionally_connecting_websockets"></a>Conditionally Connecting WebSockets</h2>
<div class="sectionbody">
<div class="paragraph">
<p>You can use the optional connected attribute to control whether to auto-reconnect the WebSocket.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-xml hljs" data-lang="xml">&lt;f:websocket ... connected="#{bean.pushable}" /&gt;</code></pre>
</div>
</div>
<div class="paragraph">
<p>The connected attribute defaults to <code>true</code> and is interpreted as a JavaScript instruction to open or close the WebSocket push connection.
If the value is an EL expression and it becomes <code>false</code> during an ajax request, then the push connection will explicitly be closed during <code>oncomplete</code> of that ajax request.</p>
</div>
<div class="paragraph">
<p>You can also explicitly set it to <code>false</code> and manually open the push connection on the client side by invoking <code>faces.push.open(clientId)</code>, passing the component&#8217;s client ID.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-xml hljs" data-lang="xml">&lt;h:commandButton ... onclick="faces.push.open('foo')"&gt;
    &lt;f:ajax ... /&gt;
&lt;/h:commandButton&gt;
&lt;f:websocket id="foo" channel="bar" scope="view" ... connected="false" /&gt;</code></pre>
</div>
</div>
<div class="paragraph">
<p>If you intend to have a one-time push and do not expect more messages, you can optionally explicitly close the push connection from the client side by invoking <code>faces.push.close(clientId)</code>, passing the component&#8217;s client ID.
For example, in the <code>onmessage</code> JavaScript listener function, as seen below:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-javascript hljs" data-lang="javascript">function someWebsocketListener(message) {
// ... faces.push.close('foo');
}</code></pre>
</div>
</div>
<div class="sect2">
<h3 id="_websocket_events_server"><a class="anchor" href="#_websocket_events_server"></a>WebSocket Events: Server</h3>
<div class="paragraph">
<p>When a session or view-scoped socket is automatically closed with close reason code <code>1000</code> by the server (and thus, not manually closed by the client via <code>faces.push.close(clientId)</code>), it means that the session or view has expired.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">@ApplicationScoped
public class WebsocketObserver {

    public void onOpen(@Observes @Opened WebsocketEvent event) {
        String channel = event.getChannel();
        // Returns &lt;f:websocket channel&gt;. Long userId = event.getUser();
        // Returns &lt;f:websocket user&gt;, if any.
        // ...
    }

    public void onClose(@Observes @Closed WebsocketEvent event) { String channel = event.getChannel();
        // Returns &lt;f:websocket channel&gt;. Long userId = event.getUser();
        // Returns &lt;f:websocket user&gt;, if any. CloseCode code = event.getCloseCode();
        // Returns close reason code.
       // ...
    }
}</code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_websocket_events_clients"><a class="anchor" href="#_websocket_events_clients"></a>WebSocket Events: Clients</h3>
<div class="paragraph">
<p>You can use the optional <code>onopen</code> JavaScript listener function to listen for the open of a WebSocket on the client side.
This function is invoked on the very first connection attempt, regardless of whether it will be successful.
It will not be invoked when the WebSocket auto-reconnects a broken connection after the first successful connection.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-javascript hljs" data-lang="javascript">&lt;f:websocket ... onopen="websocketOpenListener" /&gt;
function websocketOpenListener(channel) {
// ...
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>The <code>onopen</code> JavaScript listener function is invoked with one argument: <code>channel</code> (the channel name, particularly useful if you have a global listener).</p>
</div>
<div class="paragraph">
<p>You can use the optional <code>onclose</code> JavaScript listener function to listen for a normal or abnormal close of a WebSocket.
This function is invoked when the very first connection attempt fails, or the server has returned close reason code <code>1000</code> (normal closure) or <code>1008</code> (policy violated), or the maximum reconnect attempts have been exceeded.
It will not be invoked if the WebSocket makes an auto-reconnect attempt on a broken connection after the first successful connection.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-javascript hljs" data-lang="javascript">&lt;f:websocket ... onclose="websocketCloseListener" /&gt;
function websocketCloseListener(code, channel, event) {
    if (code == -1) {
        // Websockets not supported by client.
    } else if (code == 1000) {
        // Normal close (as result of expired session or view).
    } else {
        // Abnormal close reason (as result of an error).
    }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>The <code>onclose</code> JavaScript listener function is invoked with three arguments:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>code</code>: The close reason code as an integer. If it is <code>-1</code>, the WebSocket is not supported by the client. If it is <code>1000</code>, then it was normally closed. Otherwise, if it is not <code>1000</code>, then there might be an error.</p>
</li>
<li>
<p><code>channel</code>: The channel name</p>
</li>
<li>
<p><code>event</code>: The <code>CloseEvent</code> instance</p>
</li>
</ul>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_websocket_security_considerations"><a class="anchor" href="#_websocket_security_considerations"></a>WebSocket Security Considerations</h2>
<div class="sectionbody">
<div class="paragraph">
<p>If the WebSocket is declared in a page which is restricted to logged-in users only with a specific role, then you might want to add the push handshake request URL to the set of restricted URLs.</p>
</div>
<div class="paragraph">
<p>The push handshake request URL is composed of the URI prefix, <code>/jakarta.faces.push/</code>, followed by the channel name.
In the example of container managed security, which has already restricted an example page, <code>/user/foo.xhtml</code>, to logged-in users with the example role, <code>USER</code>, on the example URL pattern, <code>/user/*</code>, in <code>web.xml</code>, see below:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-xml hljs" data-lang="xml">&lt;security-constraint&gt;
    &lt;web-resource-collection&gt;
        &lt;web-resource-name&gt;Restrict access to role USER.&lt;/web-resource-name&gt;
        &lt;url-pattern&gt;/user/*&lt;/url-pattern&gt;
    &lt;/web-resource-collection&gt;
    &lt;auth-constraint&gt;
        &lt;role-name&gt;USER&lt;/role-name&gt;
    &lt;/auth-constraint&gt;
&lt;/security-constraint&gt;</code></pre>
</div>
</div>
<div class="paragraph">
<p>If the page, <code>/user/foo.xhtml</code>, contains <code>&lt;f:websocket channel="foo"&gt;</code>, then you must add a restriction on the push handshake request URL pattern of <code>/jakarta.faces.push/foo</code>, as shown next:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-xml hljs" data-lang="xml">&lt;security-constraint&gt;
    &lt;web-resource-collection&gt;
        &lt;web-resource-name&gt;Restrict access to role USER.&lt;/web-resource-name&gt;
        &lt;url-pattern&gt;/user/*&lt;/url-pattern&gt;
        &lt;url-pattern&gt;/jakarta.faces.push/foo&lt;/url-pattern&gt;
    &lt;/web-resource-collection&gt;
    &lt;auth-constraint&gt;
        &lt;role-name&gt;USER&lt;/role-name&gt;
    &lt;/auth-constraint&gt;
&lt;/security-constraint&gt;</code></pre>
</div>
</div>
<div class="paragraph">
<p>As extra security, particularly for those public channels which cannot be restricted by security constraints, the <code>f:websocket</code> tag will register all previously declared channels in the current HTTP session, and any incoming WebSocket open request will be checked for whether it matches these channels in the current HTTP session.
If the channel is unknown (for example, randomly guessed or spoofed by end users or manually reconnected after the session is expired), then the WebSocket will immediately be closed with close reason code, <code>CloseCodes.VIOLATED_POLICY (1008)</code>.
Also, when the HTTP session gets destroyed, all session and view-scoped channels which are still open will explicitly be closed from the server side with close reason code, <code>CloseCodes.NORMAL_CLOSURE (1000)</code>.
Only application-scoped sockets remain open and are still reachable from the server even when the session or view associated with the page in the client side is expired.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_using_ajax_with_websockets"><a class="anchor" href="#_using_ajax_with_websockets"></a>Using Ajax With WebSockets</h2>
<div class="sectionbody">
<div class="paragraph">
<p>If you want to perform complex UI updates depending on the received push message, you can nest the <code>f:ajax</code> tag inside the <code>f:websocket</code> tag.
See the following example:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-xml hljs" data-lang="xml">&lt;h:panelGroup id="foo"&gt;
    ... (some complex UI here) ...
&lt;/h:panelGroup&gt;
&lt;h:form&gt;
    &lt;f:websocket channel="someChannel" scope="view"&gt;
        &lt;f:ajax event="someEvent" listener="#{bean.pushed}" render=":foo" /&gt;
    &lt;/f:websocket&gt;
&lt;/h:form&gt;</code></pre>
</div>
</div>
<div class="paragraph">
<p>Here, the push message simply represents the ajax event name.
You can use any custom event name.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-javascript hljs" data-lang="javascript">someChannel.send("someEvent");</code></pre>
</div>
</div>
<div class="paragraph">
<p>An alternative is to combine the <code>f:websocket</code> tag with the <code>h:commandScript</code> tag.
The <code>&lt;f:websocket onmessage&gt;</code> references exactly the <code>&lt;h:commandScript name&gt;</code>.</p>
</div>
<div class="paragraph">
<p>For example:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-xml hljs" data-lang="xml">&lt;h:panelGroup id="foo"&gt;
    ... (some complex UI here) ...
&lt;/h:panelGroup&gt;
&lt;f:websocket channel="someChannel" scope="view" onmessage="pushed" /&gt;
&lt;h:form&gt;
    &lt;h:commandScript name="pushed" action="#{bean.pushed}" render=":foo" /&gt;
&lt;/h:form&gt;</code></pre>
</div>
</div>
<div class="paragraph">
<p>If you pass a <code>Map&lt;String,V&gt;</code> or a JavaBean as the push message object, then all entries or properties will transparently be available as request parameters in the command script method <code>#{bean.pushed}</code>.</p>
</div>
</div>
</div>
</article>
  </div>
</main>
</div>
<footer class="footer">
  <p>This page was built using the Antora default UI.</p>
  <p>The source code for this UI is licensed under the terms of the MPL-2.0 license.</p>
</footer>
<script id="site-script" src="../../../../_/js/site.js" data-ui-root-path="../../../../_"></script>
<script async src="../../../../_/js/vendor/highlight.js"></script>
  </body>
</html>
