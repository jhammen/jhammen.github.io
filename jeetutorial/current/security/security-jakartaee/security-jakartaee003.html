<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>Untitled :: Jakarta EE Documentation</title>
    <meta name="generator" content="Antora 3.1.3">
    <link rel="stylesheet" href="../../../../_/css/site.css">
    <script>var uiRootPath = '../../../../_'</script>
    <script>!function (theme) {
        if (theme === 'dark') document.documentElement.classList.add('theme-dark')
      }(localStorage && localStorage.getItem('theme') || (matchMedia('(prefers-color-scheme: dark)') && 'dark'))
    </script>
      </head>
  <body class="article">
<header class="header">
  <nav class="navbar">
    <div class="navbar-brand">
      <a id="site-title" class="navbar-item" href="../../../..">Jakarta EE Documentation</a>
      <button class="navbar-burger" data-target="topbar-nav">
        <span></span>
        <span></span>
        <span></span>
      </button>
    </div>
    <div id="topbar-nav" class="navbar-menu">
      <div class="navbar-end">
<!--
        <a class="navbar-item" href="#">Home</a>
        <div class="navbar-item has-dropdown is-hoverable">
          <a class="navbar-link" href="#">Products</a>
          <div class="navbar-dropdown">
            <a class="navbar-item" href="#">Product A</a>
            <a class="navbar-item" href="#">Product B</a>
            <a class="navbar-item" href="#">Product C</a>
          </div>
        </div>
        <div class="navbar-item has-dropdown is-hoverable">
          <a class="navbar-link" href="#">Services</a>
          <div class="navbar-dropdown">
            <a class="navbar-item" href="#">Service A</a>
            <a class="navbar-item" href="#">Service B</a>
            <a class="navbar-item" href="#">Service C</a>
          </div>
        </div>
 -->
        <div class="navbar-item">
          <span class="control">
            <a class="button is-primary" href="../../../../jakartaee-tutorial/10/jakarta-ee-tutorial.pdf">Download</a>
          </span>
        </div>
      </div>
      <div class="navbar-theme-switcher">
        <span class="switch" title="Switch between Light and Dark Theme">
          <input id="theme-switcher-checkbox" type="checkbox" />
          <label for="theme-switcher-checkbox">Dark Theme</label>
        </span>
      </div>
    </div>
  </nav>
</header>
<div class="body">
<div class="nav-container" data-component="jakartaee-tutorial" data-version="10">
  <aside class="nav">
    <div class="panels">
<div class="nav-panel-menu is-active" data-panel="menu">
  <nav class="nav-menu">
    <h3 class="title"><a href="../../index.html">Jakarta EE Tutorial</a></h3>
<ul class="nav-list">
  <li class="nav-item" data-depth="0">
    <button class="nav-item-toggle"></button>
    <span class="nav-text">Introduction</span>
<ul class="nav-list">
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="../../index.html">Preface</a>
  </li>
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="../../intro/usingexamples/usingexamples.html">Using the Tutorial Examples</a>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="0">
    <button class="nav-item-toggle"></button>
    <span class="nav-text">Jakarta EE Core Profile</span>
<ul class="nav-list">
  <li class="nav-item" data-depth="1">
    <button class="nav-item-toggle"></button>
    <span class="nav-text">Jakarta CDI Lite</span>
<ul class="nav-list">
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../../cdi/cdi-basic/cdi-basic.html">Introduction to Jakarta Contexts and Dependency Injection</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../../cdi/cdi-basicexamples/cdi-basicexamples.html">Running the Basic Contexts and Dependency Injection Examples</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../../supporttechs/interceptors/interceptors.html">Using Jakarta EE Interceptors</a>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="1">
    <button class="nav-item-toggle"></button>
    <span class="nav-text">Jakarta REST</span>
<ul class="nav-list">
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../../websvcs/jaxrs/jaxrs.html">Building RESTful Web Services with Jakarta REST</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../../websvcs/jaxrs-client/jaxrs-client.html">Accessing REST Resources with the Jakarta REST Client API</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../../websvcs/jaxrs-advanced/jaxrs-advanced.html">Jakarta REST: Advanced Topics and an Example</a>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="1">
    <button class="nav-item-toggle"></button>
    <span class="nav-text">Jakarta JSON</span>
<ul class="nav-list">
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../../web/jsonb/jsonb.html">JSON Binding</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../../web/jsonp/jsonp.html">JSON Processing</a>
  </li>
</ul>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="0">
    <button class="nav-item-toggle"></button>
    <span class="nav-text">Jakarta EE Web Profile</span>
<ul class="nav-list">
  <li class="nav-item" data-depth="1">
    <button class="nav-item-toggle"></button>
    <span class="nav-text">Jakarta CDI Full</span>
<ul class="nav-list">
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../../cdi/cdi-adv/cdi-adv.html">Jakarta Contexts and Dependency Injection: Advanced Topics</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../../cdi/cdi-bootstrap-se8/cdi-bootstrap-se8.html">Bootstrapping a CDI Container in Java SE</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../../cdi/cdi-adv-examples/cdi-adv-examples.html">Running the Advanced Contexts and Dependency Injection Examples</a>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="1">
    <button class="nav-item-toggle"></button>
    <span class="nav-text">Jakarta Validation</span>
<ul class="nav-list">
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../../beanvalidation/bean-validation/bean-validation.html">Introduction to Jakarta Bean Validation</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../../beanvalidation/bean-validation-advanced/bean-validation-advanced.html">Bean Validation: Advanced Topics</a>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="../security.html">Jakarta Security</a>
  </li>
  <li class="nav-item" data-depth="1">
    <button class="nav-item-toggle"></button>
    <span class="nav-text">Jakarta Servlets</span>
<ul class="nav-list">
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../../web/webapp/webapp.html">Getting Started with Web Applications</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../../web/servlets/servlets.html">Jakarta Servlet Technology</a>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="1">
    <button class="nav-item-toggle"></button>
    <span class="nav-text">Jakarta Faces</span>
<ul class="nav-list">
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../../web/faces-intro/faces-intro.html">Jakarta Faces Technology</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../../web/faces-facelets/faces-facelets.html">Introduction to Facelets</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../../web/faces-page/faces-page.html">Using Jakarta Faces Technology in Web Pages</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../../web/faces-page-core/faces-page-core.html">Using Converters, Listeners, and Validators</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../../web/faces-develop/faces-develop.html">Developing with Jakarta Faces Technology</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../../web/faces-ajax/faces-ajax.html">Using Ajax with Jakarta Faces Technology</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../../web/faces-advanced-cc/faces-advanced-cc.html">Composite Components: Advanced Topics and an Example</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../../web/faces-custom/faces-custom.html">Creating Custom UI Components and Other Custom Objects</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../../web/faces-configure/faces-configure.html">Configuring Jakarta Faces Applications</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../../web/faces-ws/faces-ws.html">Using WebSockets with Jakarta Faces Technology</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../../web/webi18n/webi18n.html">Internationalizing and Localizing Web Applications</a>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="../../web/websocket/websocket.html">Jakarta WebSocket</a>
  </li>
  <li class="nav-item" data-depth="1">
    <button class="nav-item-toggle"></button>
    <span class="nav-text">Jakarta Persistence</span>
<ul class="nav-list">
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../../persist/persistence-intro/persistence-intro.html">Introduction to Jakarta Persistence</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../../persist/persistence-basicexamples/persistence-basicexamples.html">Running the Persistence Examples</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../../persist/persistence-querylanguage/persistence-querylanguage.html">The Jakarta Persistence Query Language</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../../persist/persistence-criteria/persistence-criteria.html">Using the Criteria API to Create Queries</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../../persist/persistence-string-queries/persistence-string-queries.html">Creating and Using String-Based Criteria Queries</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../../persist/persistence-locking/persistence-locking.html">Controlling Concurrent Access to Entity Data with Locking</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../../persist/persistence-entitygraphs/persistence-entitygraphs.html">Creating Fetch Plans with Entity Graphs</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../../persist/persistence-cache/persistence-cache.html">Using a Second-Level Cache with Jakarta Persistence Applications</a>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="1">
    <button class="nav-item-toggle"></button>
    <span class="nav-text">Jakarta Enterprise Beans Lite</span>
<ul class="nav-list">
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../../entbeans/ejb-intro/ejb-intro.html">Enterprise Beans</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../../entbeans/ejb-gettingstarted/ejb-gettingstarted.html">Getting Started with Enterprise Beans</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../../entbeans/ejb-basicexamples/ejb-basicexamples.html">Running the Enterprise Bean Examples</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../../entbeans/ejb-async/ejb-async.html">Using Asynchronous Method Invocation in Session Beans</a>
  </li>
</ul>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="0">
    <button class="nav-item-toggle"></button>
    <span class="nav-text">Jakarta EE Platform</span>
<ul class="nav-list">
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="../../messaging/mail-api/mail-api.html">Jakarta Mail</a>
  </li>
  <li class="nav-item" data-depth="1">
    <button class="nav-item-toggle"></button>
    <span class="nav-text">Jakarta Messaging</span>
<ul class="nav-list">
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../../messaging/jms-concepts/jms-concepts.html">Jakarta Messaging Concepts</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../../messaging/jms-examples/jms-examples.html">Jakarta Messaging Examples</a>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="../../supporttechs/batch-processing/batch-processing.html">Jakarta Batch</a>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="0">
    <button class="nav-item-toggle"></button>
    <span class="nav-text">Advanced</span>
<ul class="nav-list">
  <li class="nav-item" data-depth="1">
    <button class="nav-item-toggle"></button>
    <span class="nav-text">Web Profile</span>
<ul class="nav-list">
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../security-authentication/security-authentication.html">Jakarta Authentication</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../security-authorization/security-authorization.html">Jakarta Authorization</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../../supporttechs/transactions/transactions.html">Jakarta Transactions</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../../supporttechs/concurrency-utilities/concurrency-utilities.html">Jakarta Concurrency</a>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="1">
    <button class="nav-item-toggle"></button>
    <span class="nav-text">Jakarta EE Platform</span>
<ul class="nav-list">
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../../supporttechs/connectors/connectors.html">Jakarta Connectors</a>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="1">
    <button class="nav-item-toggle"></button>
    <span class="nav-text">Optional Components</span>
<ul class="nav-list">
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../../web/faces-el/faces-el.html">Jakarta Expression Language</a>
  </li>
  <li class="nav-item" data-depth="2">
    <span class="nav-text">Jakarta XML Binding</span>
  </li>
</ul>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="0">
    <button class="nav-item-toggle"></button>
    <span class="nav-text">Archived</span>
<ul class="nav-list">
  <li class="nav-item" data-depth="1">
    <button class="nav-item-toggle"></button>
    <span class="nav-text">Web Profile</span>
<ul class="nav-list">
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../../web/jakarta-pages/jakarta-pages.html">Jakarta Pages</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../../web/jakarta-tags/jakarta-tags.html">Jakarta Tags</a>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="1">
    <button class="nav-item-toggle"></button>
    <span class="nav-text">Jakarta EE Platform</span>
<ul class="nav-list">
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../../websvcs/xml-websvcs/xml-websvcs.html">XML Web Services</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../../entbeans/ejb-full/ejb-full.html">Jakarta Enterprise Beans Full</a>
  </li>
</ul>
  </li>
</ul>
  </li>
</ul>
  </nav>
</div>
<div class="nav-panel-explore" data-panel="explore">
  <div class="context">
    <span class="title">Jakarta EE Tutorial</span>
    <span class="version">10</span>
  </div>
  <ul class="components">
    <li class="component is-current">
      <a class="title" href="../../index.html">Jakarta EE Tutorial</a>
      <ul class="versions">
        <li class="version is-current is-latest">
          <a href="../../index.html">10</a>
        </li>
        <li class="version">
          <a href="../../../9.1/index.html">9.1</a>
        </li>
      </ul>
    </li>
  </ul>
</div>
    </div>
  </aside>
</div>
<main class="article">
<div class="toolbar" role="navigation">
<button class="nav-toggle"></button>
<nav class="breadcrumbs" aria-label="breadcrumbs">
</nav>
<div class="page-versions">
  <button class="version-menu-toggle" title="Show other versions of page">10</button>
  <div class="version-menu">
    <a class="version is-current" href="security-jakartaee003.html">10</a>
    <a class="version" href="../../../9.1/security/security-jakartaee/security-jakartaee003.html">9.1</a>
  </div>
</div>
  <div class="edit-this-page"><a href="file:///home/john/workspace/virtua/jakartaee-tutorial/src/main/antora/modules/security/pages/security-jakartaee/security-jakartaee003.adoc">Edit this Page</a></div>
</div>
  <div class="content">
<aside class="toc sidebar" data-title="Contents" data-levels="2">
  <div class="toc-menu"></div>
</aside>
<article class="doc">
<div class="sect1">
<h2 id="_examples_securing_enterprise_beans"><a class="anchor" href="#_examples_securing_enterprise_beans"></a>Examples: Securing Enterprise Beans</h2>
<div class="sectionbody">
<div class="paragraph">
<p>The following examples show how to secure enterprise beans using declarative and programmatic security.</p>
</div>
<div class="sect2">
<h3 id="_the_cart_secure_example_securing_an_enterprise_bean_with_declarative_security"><a class="anchor" href="#_the_cart_secure_example_securing_an_enterprise_bean_with_declarative_security"></a>The cart-secure Example: Securing an Enterprise Bean with Declarative Security</h3>
<div class="paragraph">
<p>This section discusses how to configure an enterprise bean for basic user name/password authentication.
When a bean that is constrained in this way is requested, the server requests a user name and password from the client and verifies that the user name and password are valid by comparing them against a database of authorized users in GlassFish Server.</p>
</div>
<div class="paragraph">
<p>If the topic of authentication is new to you, see <a href="../security-webtier/security-webtier.html#_specifying_authentication_mechanisms" class="xref page">Specifying Authentication Mechanisms</a>.</p>
</div>
<div class="paragraph">
<p>This example demonstrates security by starting with the unsecured enterprise bean application, <code>cart</code>, which is found in the <code><em>jakartaee-examples</em>/tutorial/ejb/cart/</code> directory and is discussed in <a href="../../entbeans/ejb-basicexamples/ejb-basicexamples.html#_the_cart_example" class="xref page">The cart Example</a>.</p>
</div>
<div class="paragraph">
<p>In general, the following steps are necessary to add user name/password authentication to an existing application that contains an enterprise bean.
In the example application included with this tutorial, these steps have been completed for you and are listed here simply to show what needs to be done should you wish to create a similar application.</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Create an application like the one in <a href="../../entbeans/ejb-basicexamples/ejb-basicexamples.html#<em>the_cart_example" class="xref page">The cart Example</a>.
The example in this tutorial starts with this example and demonstrates adding basic authentication of the client to this application.
The example application discussed in this section can be found at <code>_jakartaee-examples</em>/tutorial/security/cart-secure/</code>.</p>
</li>
<li>
<p>If you have not already done so, complete the steps in <a href="../security-webtier/security-webtier.html#_to_set_up_your_system_for_running_the_security_examples" class="xref page">To Set Up Your System for Running the Security Examples</a> to configure your system for running the tutorial applications.</p>
</li>
<li>
<p>Modify the source code for the enterprise bean, <code>CartBean.java</code>, to specify which roles are authorized to access which protected methods.
This step is discussed in <a href="#_annotating_the_bean">Annotating the Bean</a>.</p>
</li>
<li>
<p>Build, package, and deploy the enterprise bean; then build and run the client application by following the steps in <a href="#_to_run_the_cart_secure_example_using_netbeans_ide">To Run the cart-secure Example Using NetBeans IDE</a> or <a href="#_to_run_the_cart_secure_example_using_maven">To Run the cart-secure Example Using Maven</a>.</p>
</li>
</ol>
</div>
<div class="sect3">
<h4 id="_annotating_the_bean"><a class="anchor" href="#_annotating_the_bean"></a>Annotating the Bean</h4>
<div class="paragraph">
<p>The source code for the original <code>cart</code> application was modified as shown in the following code snippet (modifications in bold).
The resulting file can be found in the file <code><em>jakartaee-examples</em>/tutorial/security/cart-secure/cart-secure-ejb/src/main/java/jakarta/tutorial/cart/ejb/CartBean.java</code>.</p>
</div>
<div class="paragraph">
<p>The code snippet is as follows:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">package ee.jakarta.tutorial.cartsecure.ejb;

import java.io.Serializable;
import java.util.ArrayList;
import java.util.List;
import ee.jakarta.tutorial.cart.util.BookException;
import ee.jakarta.tutorial.cart.util.IdVerifier;
import jakarta.ejb.Remove;
import jakarta.ejb.Stateful;
import jakarta.annotation.security.DeclareRoles;
import jakarta.annotation.security.RolesAllowed;

@Stateful
@DeclareRoles("TutorialUser")
public class CartBean implements Cart, Serializable {
    List&lt;String&gt; contents;
    String customerId;
    String customerName;

    @Override
    public void initialize(String person) throws BookException {
        if (person == null) {
            throw new BookException("Null person not allowed.");
        } else {
            customerName = person;
        }

        customerId = "0";
        contents = new ArrayList&lt;&gt;();
    }

    @Override
    public void initialize(String person, String id) throws BookException {
        if (person == null) {
            throw new BookException("Null person not allowed.");
        } else {
            customerName = person;
        }

        IdVerifier idChecker = new IdVerifier();

        if (idChecker.validate(id)) {
            customerId = id;
        } else {
            throw new BookException("Invalid id: " + id);
        }

        contents = new ArrayList&lt;&gt;();
    }

    @Override
    @RolesAllowed("TutorialUser")
    public void addBook(String title) {
        contents.add(title);
    }

    @Override
    @RolesAllowed("TutorialUser")
    public void removeBook(String title) throws BookException {
        boolean result = contents.remove(title);

        if (result == false) {
            throw new BookException("\"" + title + "\" not in cart.");
        }
    }

    @Override
    @RolesAllowed("TutorialUser")
    public List&lt;String&gt; getContents() {
        return contents;
    }

    @Override
    @Remove()
    @RolesAllowed("TutorialUser")
    public void remove() {
        contents = null;
    }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>The <code>@RolesAllowed</code> annotation is specified on methods for which you want to restrict access.
In this example, only users in the role of <code>TutorialUser</code> will be allowed to add and remove books from the cart and to list the contents of the cart.
A <code>@RolesAllowed</code> annotation implicitly declares a role that will be referenced in the application; therefore, no <code>@DeclareRoles</code> annotation is required.
The presence of the <code>@RolesAllowed</code> annotation also implicitly declares that authentication will be required for a user to access these methods.
If no authentication method is specified in the deployment descriptor, the type of authentication will be user name/password authentication.</p>
</div>
</div>
<div class="sect3">
<h4 id="_to_run_the_cart_secure_example_using_netbeans_ide"><a class="anchor" href="#_to_run_the_cart_secure_example_using_netbeans_ide"></a>To Run the cart-secure Example Using NetBeans IDE</h4>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Follow the steps in <a href="../security-webtier/security-webtier.html#_to_set_up_your_system_for_running_the_security_examples" class="xref page">To Set Up Your System for Running the Security Examples</a>.</p>
</li>
<li>
<p>From the File menu, choose Open Project.</p>
</li>
<li>
<p>In the Open Project dialog box, navigate to:</p>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-asciidoc hljs" data-lang="asciidoc">jakartaee-examples/tutorial/security</code></pre>
</div>
</div>
</li>
<li>
<p>Select the <code>cart-secure</code> folder.</p>
</li>
<li>
<p>Select the Open Required Projects check box.</p>
</li>
<li>
<p>Click Open Project.</p>
</li>
<li>
<p>In the Projects tab, right-click the <code>cart-secure</code> project and select Build.</p>
<div class="paragraph">
<p>This step builds and packages the application into <code>cart-secure.ear</code>, located in the <code>cart-secure-ear/target/</code> directory, and deploys this EAR file to your GlassFish Server instance, retrieves the client stubs, and runs the client.</p>
</div>
</li>
<li>
<p>In the Login for user: dialog box, enter the user name and password of a <code>file</code> realm user created in GlassFish Server and assigned to the group <code>TutorialUser</code>; then click OK.</p>
<div class="paragraph">
<p>If the user name and password you enter are authenticated, the output of the application client appears in the Output tab:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-asciidoc hljs" data-lang="asciidoc">...
Retrieving book title from cart: Infinite Jest
Retrieving book title from cart: Bel Canto
Retrieving book title from cart: Kafka on the Shore
Removing "Gravity's Rainbow" from cart.
Caught a BookException: "Gravity's Rainbow" not in cart.
Java Result: 1
...</code></pre>
</div>
</div>
<div class="paragraph">
<p>If the user name and password are not authenticated, the dialog box reappears until you enter correct values.</p>
</div>
</li>
</ol>
</div>
</div>
<div class="sect3">
<h4 id="_to_run_the_cart_secure_example_using_maven"><a class="anchor" href="#_to_run_the_cart_secure_example_using_maven"></a>To Run the cart-secure Example Using Maven</h4>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Follow the steps in <a href="../security-webtier/security-webtier.html#_to_set_up_your_system_for_running_the_security_examples" class="xref page">To Set Up Your System for Running the Security Examples</a>.</p>
</li>
<li>
<p>In a terminal window, go to:</p>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-asciidoc hljs" data-lang="asciidoc">jakartaee-examples/tutorial/security/cart-secure/</code></pre>
</div>
</div>
</li>
<li>
<p>To build the application, package it into an EAR file in the <code>cart-secure-ear/target</code> subdirectory, deploy it, and run it, enter the following command at the terminal window or command prompt:</p>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-shell hljs" data-lang="shell">mvn install</code></pre>
</div>
</div>
</li>
<li>
<p>In the Login for user: dialog box, enter the user name and password of a <code>file</code> realm user created in GlassFish Server and assigned to the group <code>TutorialUser</code>; then click OK.</p>
<div class="paragraph">
<p>If the user name and password you enter are authenticated, the output of the application client appears in the Output tab:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-asciidoc hljs" data-lang="asciidoc">...
Retrieving book title from cart: Infinite Jest
Retrieving book title from cart: Bel Canto
Retrieving book title from cart: Kafka on the Shore
Removing "Gravity's Rainbow" from cart.
Caught a BookException: "Gravity's Rainbow" not in cart.
Java Result: 1
...</code></pre>
</div>
</div>
<div class="paragraph">
<p>If the user name and password are not authenticated, the dialog box reappears until you enter correct values.</p>
</div>
</li>
</ol>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_the_converter_secure_example_securing_an_enterprise_bean_with_programmatic_security"><a class="anchor" href="#_the_converter_secure_example_securing_an_enterprise_bean_with_programmatic_security"></a>The converter-secure Example: Securing an Enterprise Bean with Programmatic Security</h3>
<div class="paragraph">
<p>This example demonstrates how to use the <code>getCallerPrincipal</code> and <code>isCallerInRole</code> methods with an enterprise bean.
This example starts with a very simple enterprise bean application, <code>converter</code>, and modifies the methods of the <code>ConverterBean</code> so that currency conversion will occur only when the requester is in the role of <code>TutorialUser</code>.</p>
</div>
<div class="paragraph">
<p>This example can be found in the <code><em>jakartaee-examples</em>/tutorial/security/converter-secure</code> directory.
This example is based on the unsecured enterprise bean application, <code>converter</code>, which is discussed in <a href="../../entbeans/ejb-gettingstarted/ejb-gettingstarted.html#<em>getting_started_with_enterprise_beans" class="xref page">Getting Started with Enterprise Beans</a> and is found in the <code>_jakartaee-examples</em>/tutorial/ejb/converter/</code> directory.
This section builds on the example by adding the necessary elements to secure the application by using the <code>getCallerPrincipal</code> and <code>isCallerInRole</code> methods, which are discussed in more detail in <a href="security-jakartaee.html#_securing_an_enterprise_bean_programmatically" class="xref page">Securing an Enterprise Bean Programmatically</a>.</p>
</div>
<div class="paragraph">
<p>In general, the following steps are necessary when using the <code>getCallerPrincipal</code> and <code>isCallerInRole</code> methods with an enterprise bean.
In the example application included with this tutorial, many of these steps have been completed for you and are listed here simply to show what needs to be done should you wish to create a similar application.</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Create a simple enterprise bean application.</p>
</li>
<li>
<p>Set up a user on GlassFish Server in the <code>file</code> realm, in the group <code>TutorialUser</code>, and set up default principal to role mapping.
To do this, follow the steps in <a href="../security-webtier/security-webtier.html#_to_set_up_your_system_for_running_the_security_examples" class="xref page">To Set Up Your System for Running the Security Examples</a>.</p>
</li>
<li>
<p>Modify the bean to add the <code>getCallerPrincipal</code> and <code>isCallerInRole</code> methods.</p>
</li>
<li>
<p>If the application contains a web client that is a servlet, specify security for the servlet, as described in <a href="../security-webtier/security-webtier.html#_specifying_security_for_basic_authentication_using_annotations" class="xref page">Specifying Security for Basic Authentication Using Annotations</a>.</p>
</li>
<li>
<p>Build, package, deploy, and run the application.</p>
</li>
</ol>
</div>
<div class="sect3">
<h4 id="_modifying_converterbean"><a class="anchor" href="#_modifying_converterbean"></a>Modifying ConverterBean</h4>
<div class="paragraph">
<p>The source code for the original <code>ConverterBean</code> class was modified to add the <code>if..else</code> clause that tests whether the caller is in the role of <code>TutorialUser</code>.
If the user is in the correct role, the currency conversion is computed and displayed.
If the user is not in the correct role, the computation is not performed, and the application displays the result as <code>0</code>.
The code example can be found in <code><em>jakartaee-examples</em>/tutorial/security/converter-secure/converter-secure-ejb/src/main/java/jakarta/tutorial/converter/ejb/ConverterBean.java</code>.</p>
</div>
<div class="paragraph">
<p>The code snippet (with modifications shown in <strong>bold</strong>) is as follows:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">package ee.jakarta.tutorial.convertersecure.ejb;

import java.math.BigDecimal;
<strong>import java.security.Principal;</strong>

<strong>import jakarta.annotation.Resource;
import jakarta.annotation.security.DeclareRoles;
import jakarta.annotation.security.RolesAllowed;
import jakarta.ejb.SessionContext;</strong>
import jakarta.ejb.Stateless;

@Stateless()
<strong>@DeclareRoles("TutorialUser")</strong>
public class ConverterBean{

    <strong>@Resource SessionContext ctx;</strong>
    private final BigDecimal yenRate = new BigDecimal("104.34");
    private final BigDecimal euroRate = new BigDecimal("0.007");

    <strong>@RolesAllowed("TutorialUser")</strong>
     public BigDecimal dollarToYen(BigDecimal dollars) {
        <strong>BigDecimal result = new BigDecimal("0.0");
        Principal callerPrincipal = ctx.getCallerPrincipal();
        if (ctx.isCallerInRole("TutorialUser")) {</strong>
            result = dollars.multiply(yenRate);
            return result.setScale(2, BigDecimal.ROUND_UP);
        <strong>} else {
            return result.setScale(2, BigDecimal.ROUND_UP);
        }</strong>
    }

    <strong>@RolesAllowed("TutorialUser")</strong>
    public BigDecimal yenToEuro(BigDecimal yen) {
        <strong>BigDecimal result = new BigDecimal("0.0");
        Principal callerPrincipal = ctx.getCallerPrincipal();
        if (ctx.isCallerInRole("TutorialUser")) {</strong>
             result = yen.multiply(euroRate);
             return result.setScale(2, BigDecimal.ROUND_UP);
        <strong>} else {
             return result.setScale(2, BigDecimal.ROUND_UP);
        }</strong>
    }
}</code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_modifying_converterservlet"><a class="anchor" href="#_modifying_converterservlet"></a>Modifying ConverterServlet</h4>
<div class="paragraph">
<p>The following annotations specify security for the <code>converter</code> web client, <code>ConverterServlet</code>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">@WebServlet(urlPatterns = {"/"})
@ServletSecurity(
@HttpConstraint(transportGuarantee = TransportGuarantee.CONFIDENTIAL,
    rolesAllowed = {"TutorialUser"}))</code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_to_run_the_converter_secure_example_using_netbeans_ide"><a class="anchor" href="#_to_run_the_converter_secure_example_using_netbeans_ide"></a>To Run the converter-secure Example Using NetBeans IDE</h4>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Follow the steps in <a href="../security-webtier/security-webtier.html#_to_set_up_your_system_for_running_the_security_examples" class="xref page">To Set Up Your System for Running the Security Examples</a>.</p>
</li>
<li>
<p>From the File menu, choose Open Project.</p>
</li>
<li>
<p>In the Open Project dialog box, navigate to:</p>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-asciidoc hljs" data-lang="asciidoc">jakartaee-examples/tutorial/security</code></pre>
</div>
</div>
</li>
<li>
<p>Select the <code>converter-secure</code> folder.</p>
</li>
<li>
<p>Click Open Project.</p>
</li>
<li>
<p>Right-click the <code>converter-secure</code> project and select Build.</p>
<div class="paragraph">
<p>This command builds and deploys the example application to your GlassFish Server instance.</p>
</div>
</li>
</ol>
</div>
</div>
<div class="sect3">
<h4 id="_to_run_the_converter_secure_example_using_maven"><a class="anchor" href="#_to_run_the_converter_secure_example_using_maven"></a>To Run the converter-secure Example Using Maven</h4>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Follow the steps in <a href="../security-webtier/security-webtier.html#_to_set_up_your_system_for_running_the_security_examples" class="xref page">To Set Up Your System for Running the Security Examples</a>.</p>
</li>
<li>
<p>In a terminal window, go to:</p>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-asciidoc hljs" data-lang="asciidoc">jakartaee-examples/tutorial/security/converter-secure/</code></pre>
</div>
</div>
</li>
<li>
<p>Enter the following command:</p>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-shell hljs" data-lang="shell">mvn install</code></pre>
</div>
</div>
<div class="paragraph">
<p>This command builds and packages the application into a WAR file, <code>converter-secure.war</code>, that is located in the <code>target</code> directory, and deploys the WAR file.</p>
</div>
</li>
</ol>
</div>
</div>
<div class="sect3">
<h4 id="_to_run_the_converter_secure_example"><a class="anchor" href="#_to_run_the_converter_secure_example"></a>To Run the converter-secure Example</h4>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Open a web browser to the following URL:</p>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-asciidoc hljs" data-lang="asciidoc">http://localhost:8080/converter-secure</code></pre>
</div>
</div>
<div class="paragraph">
<p>An Authentication Required dialog box appears.</p>
</div>
</li>
<li>
<p>Enter a user name and password combination that corresponds to a user who has already been created in the <code>file</code> realm of GlassFish Server and has been assigned to the group <code>TutorialUser</code>; then click OK.</p>
</li>
<li>
<p>Enter <code>100</code> in the input field and click Submit.</p>
<div class="paragraph">
<p>A second page appears, showing the converted values.</p>
</div>
</li>
</ol>
</div>
</div>
</div>
</div>
</div>
</article>
  </div>
</main>
</div>
<footer class="footer">
  <p>This page was built using the Antora default UI.</p>
  <p>The source code for this UI is licensed under the terms of the MPL-2.0 license.</p>
</footer>
<script id="site-script" src="../../../../_/js/site.js" data-ui-root-path="../../../../_"></script>
<script async src="../../../../_/js/vendor/highlight.js"></script>
  </body>
</html>
