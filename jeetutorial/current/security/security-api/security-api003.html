<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>Untitled :: Jakarta EE Documentation</title>
    <meta name="generator" content="Antora 3.1.3">
    <link rel="stylesheet" href="../../../../_/css/site.css">
    <script>var uiRootPath = '../../../../_'</script>
    <script>!function (theme) {
        if (theme === 'dark') document.documentElement.classList.add('theme-dark')
      }(localStorage && localStorage.getItem('theme') || (matchMedia('(prefers-color-scheme: dark)') && 'dark'))
    </script>
      </head>
  <body class="article">
<header class="header">
  <nav class="navbar">
    <div class="navbar-brand">
      <a id="site-title" class="navbar-item" href="../../../..">Jakarta EE Documentation</a>
      <button class="navbar-burger" data-target="topbar-nav">
        <span></span>
        <span></span>
        <span></span>
      </button>
    </div>
    <div id="topbar-nav" class="navbar-menu">
      <div class="navbar-end">
<!--
        <a class="navbar-item" href="#">Home</a>
        <div class="navbar-item has-dropdown is-hoverable">
          <a class="navbar-link" href="#">Products</a>
          <div class="navbar-dropdown">
            <a class="navbar-item" href="#">Product A</a>
            <a class="navbar-item" href="#">Product B</a>
            <a class="navbar-item" href="#">Product C</a>
          </div>
        </div>
        <div class="navbar-item has-dropdown is-hoverable">
          <a class="navbar-link" href="#">Services</a>
          <div class="navbar-dropdown">
            <a class="navbar-item" href="#">Service A</a>
            <a class="navbar-item" href="#">Service B</a>
            <a class="navbar-item" href="#">Service C</a>
          </div>
        </div>
 -->
        <div class="navbar-item">
          <span class="control">
            <a class="button is-primary" href="../../../../jakartaee-tutorial/10/jakarta-ee-tutorial.pdf">Download</a>
          </span>
        </div>
      </div>
      <div class="navbar-theme-switcher">
        <span class="switch" title="Switch between Light and Dark Theme">
          <input id="theme-switcher-checkbox" type="checkbox" />
          <label for="theme-switcher-checkbox">Dark Theme</label>
        </span>
      </div>
    </div>
  </nav>
</header>
<div class="body">
<div class="nav-container" data-component="jakartaee-tutorial" data-version="10">
  <div class="toolbar"></div>
  <aside class="nav">
    <div class="panels">
<div class="nav-panel-menu is-active" data-panel="menu">
  <nav class="nav-menu">
    <h3 class="title"><a href="../../index.html">Jakarta EE Tutorial</a></h3>
<ul class="nav-list">
  <li class="nav-item" data-depth="0">
    <button class="nav-item-toggle"></button>
    <span class="nav-text">Introduction</span>
<ul class="nav-list">
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="../../index.html">Preface</a>
  </li>
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="../../intro/overview/overview.html">Overview</a>
  </li>
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="../../intro/usingexamples/usingexamples.html">Using the Tutorial Examples</a>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="0">
    <button class="nav-item-toggle"></button>
    <span class="nav-text">Jakarta EE Core Profile</span>
<ul class="nav-list">
  <li class="nav-item" data-depth="1">
    <button class="nav-item-toggle"></button>
    <span class="nav-text">Jakarta CDI Lite</span>
<ul class="nav-list">
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../../cdi/cdi-basic/cdi-basic.html">Introduction to Jakarta Contexts and Dependency Injection</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../../cdi/cdi-basicexamples/cdi-basicexamples.html">Running the Basic Contexts and Dependency Injection Examples</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../../supporttechs/interceptors/interceptors.html">Using Jakarta EE Interceptors</a>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="1">
    <button class="nav-item-toggle"></button>
    <span class="nav-text">Jakarta REST</span>
<ul class="nav-list">
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../../websvcs/jaxrs/jaxrs.html">Building RESTful Web Services with Jakarta REST</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../../websvcs/jaxrs-client/jaxrs-client.html">Accessing REST Resources with the Jakarta REST Client API</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../../websvcs/jaxrs-advanced/jaxrs-advanced.html">Jakarta REST: Advanced Topics and an Example</a>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="1">
    <button class="nav-item-toggle"></button>
    <span class="nav-text">Jakarta JSON</span>
<ul class="nav-list">
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../../web/jsonb/jsonb.html">JSON Binding</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../../web/jsonp/jsonp.html">JSON Processing</a>
  </li>
</ul>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="0">
    <button class="nav-item-toggle"></button>
    <span class="nav-text">Jakarta EE Web Profile</span>
<ul class="nav-list">
  <li class="nav-item" data-depth="1">
    <button class="nav-item-toggle"></button>
    <span class="nav-text">Jakarta CDI Full</span>
<ul class="nav-list">
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../../cdi/cdi-adv/cdi-adv.html">Jakarta Contexts and Dependency Injection: Advanced Topics</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../../cdi/cdi-bootstrap-se8/cdi-bootstrap-se8.html">Bootstrapping a CDI Container in Java SE</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../../cdi/cdi-adv-examples/cdi-adv-examples.html">Running the Advanced Contexts and Dependency Injection Examples</a>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="1">
    <button class="nav-item-toggle"></button>
    <span class="nav-text">Jakarta Validation</span>
<ul class="nav-list">
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../../beanvalidation/bean-validation/bean-validation.html">Introduction to Jakarta Bean Validation</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../../beanvalidation/bean-validation-advanced/bean-validation-advanced.html">Bean Validation: Advanced Topics</a>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="../security.html">Jakarta Security</a>
  </li>
  <li class="nav-item" data-depth="1">
    <button class="nav-item-toggle"></button>
    <span class="nav-text">Jakarta Servlets</span>
<ul class="nav-list">
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../../web/webapp/webapp.html">Getting Started with Web Applications</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../../web/servlets/servlets.html">Jakarta Servlet Technology</a>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="1">
    <button class="nav-item-toggle"></button>
    <span class="nav-text">Jakarta Faces</span>
<ul class="nav-list">
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../../web/faces-intro/faces-intro.html">Jakarta Faces Technology</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../../web/faces-facelets/faces-facelets.html">Introduction to Facelets</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../../web/faces-page/faces-page.html">Using Jakarta Faces Technology in Web Pages</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../../web/faces-page-core/faces-page-core.html">Using Converters, Listeners, and Validators</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../../web/faces-develop/faces-develop.html">Developing with Jakarta Faces Technology</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../../web/faces-ajax/faces-ajax.html">Using Ajax with Jakarta Faces Technology</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../../web/faces-advanced-cc/faces-advanced-cc.html">Composite Components: Advanced Topics and an Example</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../../web/faces-custom/faces-custom.html">Creating Custom UI Components and Other Custom Objects</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../../web/faces-configure/faces-configure.html">Configuring Jakarta Faces Applications</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../../web/faces-ws/faces-ws.html">Using WebSockets with Jakarta Faces Technology</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../../web/webi18n/webi18n.html">Internationalizing and Localizing Web Applications</a>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="../../web/websocket/websocket.html">Jakarta WebSocket</a>
  </li>
  <li class="nav-item" data-depth="1">
    <button class="nav-item-toggle"></button>
    <span class="nav-text">Jakarta Persistence</span>
<ul class="nav-list">
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../../persist/persistence-intro/persistence-intro.html">Introduction to Jakarta Persistence</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../../persist/persistence-basicexamples/persistence-basicexamples.html">Running the Persistence Examples</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../../persist/persistence-querylanguage/persistence-querylanguage.html">The Jakarta Persistence Query Language</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../../persist/persistence-criteria/persistence-criteria.html">Using the Criteria API to Create Queries</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../../persist/persistence-string-queries/persistence-string-queries.html">Creating and Using String-Based Criteria Queries</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../../persist/persistence-locking/persistence-locking.html">Controlling Concurrent Access to Entity Data with Locking</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../../persist/persistence-entitygraphs/persistence-entitygraphs.html">Creating Fetch Plans with Entity Graphs</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../../persist/persistence-cache/persistence-cache.html">Using a Second-Level Cache with Jakarta Persistence Applications</a>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="1">
    <button class="nav-item-toggle"></button>
    <span class="nav-text">Jakarta Enterprise Beans Lite</span>
<ul class="nav-list">
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../../entbeans/ejb-intro/ejb-intro.html">Enterprise Beans</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../../entbeans/ejb-gettingstarted/ejb-gettingstarted.html">Getting Started with Enterprise Beans</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../../entbeans/ejb-basicexamples/ejb-basicexamples.html">Running the Enterprise Bean Examples</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../../entbeans/ejb-async/ejb-async.html">Using Asynchronous Method Invocation in Session Beans</a>
  </li>
</ul>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="0">
    <button class="nav-item-toggle"></button>
    <span class="nav-text">Jakarta EE Platform</span>
<ul class="nav-list">
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="../../messaging/mail-api/mail-api.html">Jakarta Mail</a>
  </li>
  <li class="nav-item" data-depth="1">
    <button class="nav-item-toggle"></button>
    <span class="nav-text">Jakarta Messaging</span>
<ul class="nav-list">
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../../messaging/jms-concepts/jms-concepts.html">Jakarta Messaging Concepts</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../../messaging/jms-examples/jms-examples.html">Jakarta Messaging Examples</a>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="../../supporttechs/batch-processing/batch-processing.html">Jakarta Batch</a>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="0">
    <button class="nav-item-toggle"></button>
    <span class="nav-text">Advanced</span>
<ul class="nav-list">
  <li class="nav-item" data-depth="1">
    <button class="nav-item-toggle"></button>
    <span class="nav-text">Web Profile</span>
<ul class="nav-list">
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../security-authentication/security-authentication.html">Jakarta Authentication</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../security-authorization/security-authorization.html">Jakarta Authorization</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../../supporttechs/transactions/transactions.html">Jakarta Transactions</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../../supporttechs/concurrency-utilities/concurrency-utilities.html">Jakarta Concurrency</a>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="1">
    <button class="nav-item-toggle"></button>
    <span class="nav-text">Jakarta EE Platform</span>
<ul class="nav-list">
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../../supporttechs/connectors/connectors.html">Jakarta Connectors</a>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="1">
    <button class="nav-item-toggle"></button>
    <span class="nav-text">Optional Components</span>
<ul class="nav-list">
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../../web/faces-el/faces-el.html">Jakarta Expression Language</a>
  </li>
  <li class="nav-item" data-depth="2">
    <span class="nav-text">Jakarta XML Binding</span>
  </li>
</ul>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="0">
    <button class="nav-item-toggle"></button>
    <span class="nav-text">Archived</span>
<ul class="nav-list">
  <li class="nav-item" data-depth="1">
    <button class="nav-item-toggle"></button>
    <span class="nav-text">Web Profile</span>
<ul class="nav-list">
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../../web/jakarta-pages/jakarta-pages.html">Jakarta Pages</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../../web/jakarta-tags/jakarta-tags.html">Jakarta Tags</a>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="1">
    <button class="nav-item-toggle"></button>
    <span class="nav-text">Jakarta EE Platform</span>
<ul class="nav-list">
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../../websvcs/xml-websvcs/xml-websvcs.html">XML Web Services</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../../entbeans/ejb-full/ejb-full.html">Jakarta Enterprise Beans Full</a>
  </li>
</ul>
  </li>
</ul>
  </li>
</ul>
  </nav>
</div>
<div class="nav-panel-explore" data-panel="explore">
  <div class="context">
    <span class="title">Jakarta EE Tutorial</span>
    <span class="version">10</span>
  </div>
  <ul class="components">
    <li class="component is-current">
      <a class="title" href="../../index.html">Jakarta EE Tutorial</a>
      <ul class="versions">
        <li class="version is-current is-latest">
          <a href="../../index.html">10</a>
        </li>
        <li class="version">
          <a href="../../../9.1/index.html">9.1</a>
        </li>
      </ul>
    </li>
  </ul>
</div>
    </div>
  </aside>
</div>
<main class="article">
<div class="toolbar" role="navigation">
<button class="nav-toggle"></button>
  <a href="../../index.html" class="home-link"></a>
<nav class="breadcrumbs" aria-label="breadcrumbs">
</nav>
<div class="page-versions">
  <button class="version-menu-toggle" title="Show other versions of page">10</button>
  <div class="version-menu">
    <a class="version is-current" href="security-api003.html">10</a>
    <a class="version" href="../../../9.1/security/security-api/security-api003.html">9.1</a>
  </div>
</div>
  <div class="edit-this-page"><a href="file:///home/john/workspace/virtua/jakartaee-tutorial/src/main/antora/modules/security/pages/security-api/security-api003.adoc">Edit this Page</a></div>
</div>
  <div class="content">
<aside class="toc sidebar" data-title="Contents" data-levels="2">
  <div class="toc-menu"></div>
</aside>
<article class="doc">
<div class="sect1">
<h2 id="_overview_of_the_identity_store_interfaces"><a class="anchor" href="#_overview_of_the_identity_store_interfaces"></a>Overview of the Identity Store Interfaces</h2>
<div class="sectionbody">
<div class="paragraph">
<p>The Identity Store Interfaces are described in the following sections:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><a href="#_the_identitystore_interface">The IdentityStore Interface</a></p>
</li>
<li>
<p><a href="#_the_remembermeidentitystore_interface">The RememberMeIdentityStore Interface</a></p>
</li>
</ul>
</div>
<div class="sect2">
<h3 id="_the_identitystore_interface"><a class="anchor" href="#_the_identitystore_interface"></a>The IdentityStore Interface</h3>
<div class="paragraph">
<p>The <code>IdentityStore</code> interface defines an SPI for interacting with identity stores, which are directories or databases containing user account information.
An implementation of the <code>IdentityStore</code> interface can validate users' credentials, provide information about the groups they belong to, or both.
Most often, an <code>IdentityStore</code> implementation will interact with an external identity store&#8201;&#8212;&#8201;an LDAP server, for example&#8201;&#8212;&#8201;to perform the actual credential validation and group lookups, but an <code>IdentityStore</code> may also manage user account data itself.</p>
</div>
<div class="paragraph">
<p>There are two built-in implementations of <code>IdentityStore</code>: an LDAP identity store, and a Database identity store.
These identity stores delegate to external stores that must already exist; the IdentityStore implementations do not provide or manage the external store.
They are configured with the parameters necessary to communicate with an external store using the following annotations:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>LdapIdentityStoreDefinition</code>&#8201;&#8212;&#8201;configures an identity store with the parameters necessary to communicate with an external LDAP server, validate user credentials, and/or lookup user groups.</p>
</li>
<li>
<p><code>DatabaseIdentityStoreDefinition</code>&#8201;&#8212;&#8201;configures an identity store with the parameters necessary to connect to an external database, validate user credentials, and/or lookup user groups.
You must supply a PasswordHash implementation when configuring a Database Identity Store.
See <a href="#_the_passwordhash_interface">The PasswordHash Interface</a>.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>An application can provide its own custom identity store, or use the built-in LDAP or database identity stores.
For examples of both types, see:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><a href="security-api.html#_running_the_built_in_database_identity_store_example" class="xref page">Running the Built-In Database Identity Store Example</a></p>
</li>
<li>
<p><a href="security-api.html#_running_the_custom_identity_store_example" class="xref page">Running the Custom Identity Store Example</a></p>
</li>
</ul>
</div>
<div class="paragraph">
<p>An implementation of <code>IdentityStore</code> must be a CDI bean to be recognized and deployed at runtime, and is assumed to be normal scoped.
IdentityStores are primarily intended for use by implementations of <code>HttpAuthenticationMechanisms</code>, but this is not a requirement.
They can be used by other types of authentication mechanisms as well, or by containers.</p>
</div>
<div class="paragraph">
<p>Multiple implementations of <code>IdentityStore</code> may be present.
If so, they are invoked under the control of an <code>IdentityStoreHandler</code>.</p>
</div>
<div class="sect3">
<h4 id="_identitystorehandler"><a class="anchor" href="#_identitystorehandler"></a>IdentityStoreHandler</h4>
<div class="paragraph">
<p>Authentication mechanisms do not interact with <code>IdentityStore</code> directly; instead, they call an <code>IdentityStoreHandler</code>.
An implementation of the <code>IdentityStoreHandler</code> interface provides a single method, <code>validate(Credential)</code>, which, when invoked, iterates over the available IdentityStores and returns an aggregated result.
An <code>IdentityStoreHandler</code> must also be a CDI bean, and is assumed to be normal scoped.
At runtime, an authentication mechanism injects the <code>IdentityStoreHandler</code> and invokes on it.
The <code>IdentityStoreHandler</code>, in turn, looks up the available IdentityStores and invokes on them to determine the aggregate result.</p>
</div>
<div class="paragraph">
<p>There is a built-in <code>IdentityStoreHandler</code> that implements a standard algorithm defined by Jakarta Security.
The Jakarta Security specification provides a full description of the algorithm, but it can be roughly summarized as follows:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Iterate over the available validating IdentityStores, in priority order, until the provided Credential is validated or there are no more IdentityStores.</p>
</li>
<li>
<p>If the Credential was validated, iterate over the available group-providing IdentityStores, in priority order, aggregating the groups returned by each store.</p>
</li>
<li>
<p>Return the validated caller and group information.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>An application may also supply its own <code>IdentityStoreHandler</code>, which can use any desired algorithm to select and invoke on IdentityStores, and return an aggregated (or non-aggregated) result.</p>
</div>
</div>
<div class="sect3">
<h4 id="_identitystore_interface_methods"><a class="anchor" href="#_identitystore_interface_methods"></a>IdentityStore Interface Methods</h4>
<div class="paragraph">
<p>The IdentityStore interface itself has four methods:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>validate(Credential)</code>&#8201;&#8212;&#8201;validate a Credential, and return the result of that validation.</p>
</li>
<li>
<p><code>getCallerGroups(CredentialValidationResult)</code>&#8201;&#8212;&#8201;return the groups associated with the caller indicated by the supplied <code>CredentialValidationResult</code>, which represents the result of a previous, successful validation.</p>
</li>
<li>
<p><code>validationTypes()</code>&#8201;&#8212;&#8201;returns a Set of validation types (one or more of <code>VALIDATE</code>, <code>PROVIDE_GROUPS</code>) that indicate the operations supported by this instance of the <code>IdentityStore</code>.</p>
</li>
<li>
<p><code>priority()</code>&#8201;&#8212;&#8201;returns a positive integer representing the self-declared priority of this IdentityStore.
Lower values represent higher priority.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Because <code>getCallerGroups()</code> is a sensitive operation&#8201;&#8212;&#8201;it can return information about arbitrary users, and does not require that the caller provide the user&#8217;s credential or proof of identity&#8201;&#8212;&#8201;the caller should have the <code>IdentityStorePermission("getGroups")</code> permission.
Enforcement of this check is incumbent on the implementation of the <code>getCallerGroups()</code> method; the built-in IdentityStores do check for this permission, if a SecurityManager is configured, and the built-in IdentityStoreHandler invokes the <code>getCallerGroups()</code> method in the context of a <code>PrivilegedAction</code> block.</p>
</div>
</div>
<div class="sect3">
<h4 id="_the_passwordhash_interface"><a class="anchor" href="#_the_passwordhash_interface"></a>The PasswordHash Interface</h4>
<div class="paragraph">
<p>Unlike some types of identity stores, for example LDAP directories, databases can store and retrieve user passwords, but can&#8217;t verify them natively.
Therefore, the built-in Database identity store must verify user passwords itself.
Most often, this involves generating a hash of the user&#8217;s password for comparison with a hash value stored in the database.</p>
</div>
<div class="paragraph">
<p>In order to provide maximum flexibility and interoperability, the Database identity store does not implement any specific password hashing algorithms.
Instead, it defines the <code>PasswordHash</code> interface, and expects the application to provide an implementation of <code>PasswordHash</code> that can verify passwords from the specific store the application will use.
The <code>PasswordHash</code> implementation must be made available as a dependent-scoped bean, and is configured by providing the fully-qualified name of the desired type as the <code>hashAlgorithm</code> value on a <code>DatabaseIdentityStoreDefinition</code>.</p>
</div>
<div class="paragraph">
<p>The <code>PasswordHash</code> algorithm defines three methods:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>initialize(Map&lt;String,String&gt; parameters)</code>&#8201;&#8212;&#8201;initialize the PasswordHash with the supplied Map of parameters.
The Database identity store calls this method when initializing, passing the <code>hashAlgorithmParameters</code> value of the <code>DatabaseIdentityStoreDefinition</code> annotation (after conversion to a Map).</p>
</li>
<li>
<p><code>verify(char[] password, String hashedPassword)</code>&#8201;&#8212;&#8201;verify a caller-supplied password against the caller&#8217;s stored password hash as retrieved from the database.
The <code>hashedPassword</code> value should be provided exactly as it was returned from the database.</p>
</li>
<li>
<p><code>generate(char[] password)</code>&#8201;&#8212;&#8201;generate a password hash from the supplied password.
The value returned should be formatted and encoded exactly it would be stored in the database.
While it is useful to generate the hash of a caller-supplied password during <code>verify()</code>, this method is intended primarily for use by applications or <code>IdentityStore</code> implementations that want to support password management/reset capability without having to duplicate the code used to verify passwords.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Note that, while the interface is oriented toward hashing passwords, it can also support alternative approaches, such as two-way encryption of stored passwords.</p>
</div>
<div class="paragraph">
<p>There is a built-in <code>Pbkdf2PasswordHash</code> implementation that supports, as it&#8217;s name suggests, PBKDF2 password hashing.
It supports several parameters that control the generation of hash values (key size, iterations, and so on&#8201;&#8212;&#8201;see the Javadoc), and those parameters are encoded into the resulting hash value, so that hashes can be verified even if the currently configured parameters are different from the parameters in effect when a stored hash was generated.</p>
</div>
<div class="paragraph">
<p>While it is necessary to write a custom <code>PasswordHash</code> to enable interoperability with a legacy identity store that stores password hashes in a format other than the <code>Pbkdf2PasswordHash</code> format, developers should consider carefully whether <code>Pbkdf2PasswordHash</code> is sufficient for new identity stores, and avoid writing a new PasswordHash implementation without a solid understanding of the cryptographic and other security considerations involved.
Some of the considerations specific to password hashing are:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>The requirements for hashing passwords differ considerably from the requirements for hashing in other contexts.
In particular, speed is normally a virtue when generating hashes, but when generating password hashes, slower is better&#8201;&#8212;&#8201;to slow down brute force attacks against hashed values.</p>
</li>
<li>
<p>The comparison of a generated hash with a stored hash should take constant time, whether it succeeds or fails, in order to avoid giving an attacker clues about the password value based on the timing of failed attempts.</p>
</li>
<li>
<p>A new random salt should be used each time a new password hash value is generated.</p>
</li>
</ul>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_the_remembermeidentitystore_interface"><a class="anchor" href="#_the_remembermeidentitystore_interface"></a>The RememberMeIdentityStore Interface</h3>
<div class="paragraph">
<p>The <code>RememberMeIdentityStore</code> interface represents a special type of identity store.
It is not directly related to the <code>IdentityStore</code> interface; that is, it does not implement or extend it.
It does, however, perform a similar, albeit specialized, function.</p>
</div>
<div class="paragraph">
<p>In some cases, an application wants to "remember" a user&#8217;s authenticated session for an extended period.
For example, a web site may remember you when you visit, and prompt for your password only periodically, perhaps once every two weeks, as long as you don&#8217;t explicitly log out.</p>
</div>
<div class="paragraph">
<p>RememberMe works as follows:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>When a request from an unauthenicated user is received, the user is authenticated using an <code>HttpAuthenticationMechanism</code> that is provided by the application (this is required&#8201;&#8212;&#8201;<code>RememberMeIdentityStore</code> can only be used in conjunction with an application-supplied <code>HttpAuthenticationMechanism</code>).</p>
</li>
<li>
<p>After authentication, the configured <code>RememberMeIdentityStore</code> saves information about the user&#8217;s authenticated identity, so that it be restored later, and generates a long-lived "remember me" login token that is sent back to the client, perhaps as a cookie.</p>
</li>
<li>
<p>On a subsequent visit to the application, the client presents the login token.
The <code>RememberMeIdentityStore</code> then validates the token and returns the stored user identity, which is then established as the user&#8217;s authenticated identity.
If the token is invalid or expired, it is discarded, the user is authenticated normally again, and a new login token is generated.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>The <code>RememberMeIdentityStore</code> interface defines the following methods:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>generateLoginToken(CallerPrincipal caller, Set&lt;String&gt; groups)</code>&#8201;&#8212;&#8201;generate a login token for a newly authenticated user, and associate it with the provided caller/group information.</p>
</li>
<li>
<p><code>removeLoginToken(String token)</code>&#8201;&#8212;&#8201;remove the (presumably expired or invalid) login token and any associated caller/group information.</p>
</li>
<li>
<p><code>validate(RememberMeCredential credential)</code>&#8201;&#8212;&#8201;validate the supplied credential, and, if valid, return the associated caller/group information.
(<code>RememberMeCredential</code> is essentially just a holder for a login token).</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>An implementation of <code>RememberMeIdentityStore</code> must be a CDI bean, and is assumed to be normal scoped.
It is configured by adding a <code>RememberMe</code> annotation to an application&#8217;s <code>HttpAuthenticationMechanism</code>, which indicates that a <code>RememberMeIdentityStore</code> is in use, and provides related configuration parameters.
A container-supplied interceptor then intercepts calls to the <code>HttpAuthenticationMechanism</code>, invokes the <code>RememberMeIdentityStore</code> as necessary before and after calls to the authentication mechanism, and ensures that the user&#8217;s identity is correctly set for the session.
The Jakarta Security specification provides a detailed description of the required interceptor behavior.</p>
</div>
<div class="paragraph">
<p>Implementations of <code>RememberMeIdentityStore</code> should take care to manage tokens and user identity information securely.
For example, login tokens should not contain sensitive user information, like credentials or sensitive attributes, to avoid exposing that information if an attacker were able to gain access to the token&#8201;&#8212;&#8201;even an encrypted token is potentially vulnerable to an attacker with sufficient time/resources.
Similarly, tokens should be encrypted/signed wherever possible, and sent only over secure channels (HTTPS).
User identity information managed by a <code>RememberMeIdentityStore</code> should be stored as securely as possible (but does not necessarily need to be reliably persisted&#8201;&#8212;&#8201;the only impact of a "forgotten" session is that the user will be prompted to log in again).</p>
</div>
</div>
</div>
</div>
</article>
  </div>
</main>
</div>
<footer class="footer">
  <p>This page was built using the Antora default UI.</p>
  <p>The source code for this UI is licensed under the terms of the MPL-2.0 license.</p>
</footer>
<script id="site-script" src="../../../../_/js/site.js" data-ui-root-path="../../../../_"></script>
<script async src="../../../../_/js/vendor/highlight.js"></script>
  </body>
</html>
